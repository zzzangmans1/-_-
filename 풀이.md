
### 브로드캐스트 주소 구하는 방법
* MAC은 ```FF:FF:FF:FF:FF:FF```
* IP는 예를 들어 161.134.4.0/22 의 브로드캐스트 주소를 구하면
  1) 서브넷 마스크 11111111 11111111 11111100 00000000 2진수를 구한다
  2) 호스트 주소 00000000 00000000 00000011 11111111 2진수를 구한다.
  3) 161.134.4.0 OR 호스트 주소를 한다.
  4) 161.134.7.255 가 브로드캐스트 주소이다.
 
### OSI 7계층 PDU (Protocol Data Unit)
1. 응용프로그램 계층
2. 표현 계층
3. 세션 계층        - 응용까지 데이터
4. 전송 계층        - 세그먼트
5. 네트워크 계층    - 패킷
6. 데이터 링크 계층 - 프레임
7. 물리 계층        - 비트

### 물리 계층 1계층
* 물리적 장치의 전기적, 전자적 연결에 대한 명세
* 장비 더미 허브, 리피터

### 허브 
* 한 포트에서 수신한 신호를 모든 포트로 전달할 뿐 트래픽을 조작하거나 검사하지 않는다.

### 데이터 링크 계층 2계층
* 데이터 링크 계층은 두 개의 서브 계층으로 구분한다. 하위 MAC(Media Access Control) 계층과 상위 LLC(Logical Link Control) 계층이 위치한다.
  * 하위 MAC 계층 : 장비 간 공유 매체에 대한 다중 접근 제어를 담당(CSMA/CD)
  * 하위 LLC 계층 : 장비 간 논리적 연결을 수립하고 제어하는 역할 담당(회선제어, 흐름제어, 오류제어 등)
* 단위는 프레임을 사용하고, 대표적인 장비로 스위치, 브릿지 등이 있으며 보안 프로토콜로 PPTP, L2F, L2TP 등이 있다.
* MAC 주소는 48bit, 6byte로 이루어지며, IP주소를 ARP 프로토콜을 사용하면 MAC 주소를 알 수 있다.
* **PPTP (Point to Point Tunnel Protocol)**
  * MS사에서 개발한 프로토콜
  * 하나의 터널에 하나의 연결만을 지원하여 일대일 통신만 가능하다.
* **L2F (Layer 2 Forwarding)**
  * 시스코사에서 개발한 프로토콜
  * 하나의 터널에 여러 개의 연결을 지원하여 다자간 통신이 가능하다.
* **L2TP (Layer 2 Tunneling Protocol)**
  * MS사와 시스코사에서 개발한 프로토콜
  * L2F에 기반을 두고 PPTP와의 호환성을 고려하여 만들어진 터널링 프로토콜   
* 스위치, 허브는 단일 Network 구간에서 사용된다.

### 스위치(L2-Switch)
* 필터링 기능 : 목적지 포트 외에는 프레임을 전송하지 않는다.
* 학습 기능 : 특정 포트로 유입된 프레임의 출발지 MAC 주소를 기반으로 MAC Address Table을 생성하여 포트별 연결된 장비의 MAC 주소를 식별한다.
* 플러딩 기능 : MAC Address Table에 등록되지 않은 목적지 MAC 주소의 프레임은 더미 허브와 동일하게 모든 포트로 프레임을 전송한다.
* 전달 기능 : 생성된 MAC Address Table을 참조하여 전송할 프레임의 MAC 주소의 포트로 프레임을 전달한다.
* 스위치 환경에서 스니핑 방법
  * **Switch Jamming / MAC Flooding** : Switch의 MAC Address Table을 모두 채워서 스위치가 허브처럼 동작하게 강제적으로 만들어 패킷을 스니핑 하는 기법. MAC Address Table을 채우기 위해 ARP Reply 패킷을 계속 전송한다.
  * **ARP Spoofing / ARP Cache Poisoning** : 공격자가 특정 호스트의 MAC 주소를 자신의 MAC 주소로 위조한 ARP Reply 패킷을 만들어 희생자에게 지속해서 전송하면 희생자의 ARP Cache table에 특정 호스트의 MAC 주소가 공격자의 MAC 주소로 변조된다. 이를 통해서 희생자로부터 특정 호스트로 나가는 패킷을 공격자가 스니핑하는 기법이다.
  * **ARP Spoofing / ARP Cache Poisoning** 대응 방안 : ARP Cache Table 을 정적으로 설정한다. ```arp -s IP MAC```
  * **ARP Redirect** : 공격자가 자신이 라우터인 것처럼 MAC 주소를 위조한 ARP Reply 패킷을 해당 네트워크에 브로드캐스트하면 해당 네트워크에 연결된 모든 호스트의 ARP Cache table에 라우터의 MAC 주소가 공격자의 MAC 주소로 변조도니다. 이를 통해서 희생자로부터 외부 네트워크로 나가는 패킷을 공격자가 스니핑하는 기법이다.
  * **ICMP Redirect** : ICMP Redirect 메시지는 라우터에서 호스트 또는 라우터 간에 라우팅 경로를 재설정하기 위해 전송하는 메시지이다. 공격자는 이를 악용하여 특정 IP 또는 대역으로 나가는 라우팅 경로를 자기 주소로 위조한 ICMP Redirect 메시지를 생성하여 희생자에게 전송함으로써 희생자의 라우팅 테이블에 공격자로 향하는 경로를 생성한다. 이를 통해서 특정 IP 또는 대역으로 나가는 패킷을 공격자가 스니핑하는 기법이다.
  * **ICMP Redirect 대응 방안** : 호스트의 라우팅 테이블 정보가 ICMP Redirect 메시지에 의해 변경되지 않도록 호스트의 ICMP Redirect 옵션을 해제한다.
  * **Switch의 Span/Monitor Port를 이용** : 원래 Monitor Port란 스위치를 통과하는 모든 트래픽을 볼 수 있는 포트로 네트워크 관리 목적이지만 공격자가 트래픽들을 스니핑하는 좋은 장소를 제공한다.
* 한 포트에서 수신한 신호를 목적지 포트로만 전달한다. 확장 제한이 없으며, 이중화시 **스패닝 트리 프로토콜**을 이용하여 무한 루핑을 방지할 수 있다.
  1. Store-and-Forward 방식 : 수신된 전체 프레임을 버퍼에 저장하고 CRC 등의 오류 검사 수행 후 목적지 전송
  2. Fragment-Free 방식 : 수신된 프레임의 첫 64byte를 버퍼에 저장하고 충돌 등의 오류 검사 수행 후 목적지 전송
  3. Cut-Throuth 방식 : 수신된 프레임의 첫 6byte를 읽어 도착 MAC 주소를 검사 수행 후 목적지 전송
* 허브와의 차이점은 스위치는 MAC Address Table을 참조해 목적지 MAC 주소에만 전달하기 때문에 허브보다 상대적으로 스니핑에 안전하다.

### 포트 미러링
* 스위치 환경에서 모니터링과 트래픽 분석을 위해 특정 포트로 전달되는 패킷 또는 VLAN의 모든 패킷을 다른 모니터링 포트로 복제하여 전달

### 네트워크 계층 3계층
* 송신 측으로부터 수신 측까지 데이터를 안전하게 전달하기 위해 논리적 링크를 설정하고 상위 계층 데이터를 작은 크기의 패킷으로 분할하여 전송하는 역할
* 단위로 패킷을 사용하고, 경로 설정에 사용할 논리적 주소를 제공하며 대표적인 장비로는 라우터가 있고 대표적인 보안 프로토콜로 IPsec이 있다.
* **IPSEC**
  * 터널링 : 송신자와 수신자 사이의 전송로에 외부로부터의 침입을 막기 위한 일종의 파이프를 구성하는 기술
  * IKE : IPsec의 보안연관(SA) 생성을 위한 협상에 사용되는 키 교환 프로토콜로 500/udp 포트를 사용한다.
  * 전송모드 : 종단 호스트 사이에서 터널이 생성되는 것으로 IP 헤더를 제외한 부분에 대해서 보안 서비스를 제공하고 트래픽 흐름 분석에 취약할 수 있다.
  * 터널모드 : 터널 게이트웨이 사이에서 터널이 생성되는 것으로 IP 헤더를 포함한 패킷 전체에 대해서 보호 서비스를 제공한다.
  * 보안 서비스 제공 6가지
    * 기밀성 : 전달된 메시지가 도중에 도청되어도 그 내용을 알 수 없음을 보장해준다.
    * 비연결형 무결성 : 전달된 메시지가 도중에 위변조되지 않았음을 보장해준다.
    * 데이터 원천 인증 : 전달된 메시지가 올바른 발신지로부터 온 메시지임을 보장해준다.
    * 재전송 공격 방지 : 전달도 메시지가 재전송된 것이 아니고 현재 발신지로부터 송신된 실제 메시지임을 보장해준다.
    * 접근제어 : 중요한 정보 및 시스템에 대하여 접근권한을 달리 부여하여 제어해준다.
    * 제한적 트래픽 흐름의 기밀성 : 제한적으로 네트워크상 트래픽 흐름에 대한 정보의 기밀성을 보장해준다. 
  * **AH (Authentication Header)**
    * 메시지 인증 코드(MAC)를 이용하여 '비연결성 무결성'과 '데이터 원천 인증' 서비스를 제공하고, 기밀성 서비스 제공하지 않는다.
    * 순서번호를 통해 재전송 공격 방지한다.
    * 51번 포트를 사용한다.
  * **ESP (Encapsulating Security Payload)
    * 메시지 인증 코드(MAC)를 이용하여 '비연결성 무결성' 과 '데이터 원천 인증' 서비스를 제공하고, 대칭키 암호화를 통해 기밀성 서비스 제공한다.
    * 순서번호를 통해 재전송 공격 방지한다.
    * 50번 포트를 사용한다.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
### 라우터
* 가장 핵심적인 기능은 패킷의 경로를 결정하는 것과 결정된 경로에 따라 패킷을 전송하는 기능이다.
* VLAN 간에 통신을 가능하게 하고, 기본적인 보안 기능과 QoS 관련 기능 지원

### 전송 계층 4계층
* 종단 노드 간의 신뢰성 있는 데이터 전송을 담당한다.
* 단위로 세그먼트를 사방

### IGMP (Internet Group Management Protocol) 프로토콜
* 멀티캐스트를 지원하는 라우터가 멀티캐스트 그룹에 가입한 네트워크 내의 호스트를 관리하기 위해 사용하는 프로토콜이다.
* IGMP는 ICMP와 마찬가지로 IP 상위 계층에 존재하며 IP 패킷으로 캡슐화되어 전송된다.

### IP 단편화 
* ```flag id:size@offset[+] 단편ID:IP 헤더를 제외한 단편 크기(byte)@단편의 상대위치이고 추가 단편이 있음(+)을 의미한다.```
* 예를 들어 MTU가 1500바이트로 설정된 Ethernet을 통해 4,000 바이트의 ping 패킷을 보내려고 한다. 실제 크기는 20byte를 뺀 1480 바이트가 크기가 된다.

### IPv6
* **듀얼스택** : IPv4와 IPv6 프로토콜을 동시에 설정하여 통신 상태에 따라 선택적으로 사용할 수 있도록 하는 방식
* **터널링** : IPv4 네트워크를 경유하여 IPv6 네트워크 간 통신을 위한 방식으로 IPv4 네트워크를 통과하는 가상의 경로(터널)를 만들어 통신하는 방식
* **주소/헤더 변환** : 변환 헤더를 추가하여 IPv4 -> IPv6, IPv6 -> IPv4

### 소켓
* 호스트/프로세스 간에 통신을 위한 소프트웨어 모듈을 의미한다.
* 특정 IP 주소와 포트 번호의 조합으로서 같은 IP의 동일한 시스템이 동시에 특정 클라이언트의 복수 개의 응용 프로그램에 정확하게 통신할 수 있게 해준다.

### 포트
* 상위 애플리케이션/서비스/소켓을 식별하기 위한 식별자로 IANA 기구를 통해 관리되고 있다.
  1. well-known port(0~1023)
     |프로토콜|포트번호|설명|
     |:-:|:-:|:-|
     |FTP, Data|20|파일 전송 프로토콜의 데이터채널|
     |FTP, Control|21|파일 전송 프로토콜의 제어채널|
     |TELNET|23|터미널 네트워크|
     |SMTP|25|간단한 메일 전송 프로토콜|
     |DNS|53|도메인 네임 시스템|
     |BOOTP|67|부트스트랩 프로토콜|
     |HTTP|80|하이퍼텍스트 전송 프로토콜|
  2. Regstered Port(1024~49151)
      * 제조사가 IANA에 용도를 등록해서 사용하는 포트로 일반 사용자가 서버 프로세스를 실행하기 위해 사용하는 포트이다.
  3. Dynamic Port(49152~65535)
      * 서버/클라이언트 환경에서 클라이언트 접속 시 사용하는 임시 포트

### 세션 하이재킹
* 공격자가 인증이 완료된 정상적인 사용자 세션을 중간에 가로채서 별도의 인증작업 없이 정상적인 사용자로 위장하여 가로챈 세션으로 통신하는 행위이다.
  * **TCP 세션 하이재킹** : TCP의 세션 관리 정보(출발지 IP/Port, Sequence Number 등)를 위조하여 TCP 세션을 가로채는 행위
    * TCP 세션 하이재킹은 케빈 미트닉이 시모무라 쓰토무의 컴퓨터 시스템을 공격할 때 사용했던 공격 방식으로 TCP 사용자 정보(IP/Port, Sequence Number)로 위조하여 IP 스푸핑으로 세션 취 
  * **HTTP 세션 하이재킹** : 사용자의 HTTP 세션 ID를 탈취하여 정상 사용자로 위장하여 서버에 접근하는 공격

### netbios (Network Basic Input/Output System) 
* IBM PC를 위한 네트워크 인터페이스 체계로 네임, 세션, 데이터그램의 세 가지 서비스를 제공하고 있다.
* 차단하려면 tcp/udp 135~139 포트 차단

### SMB (Server Message Block)
* 윈도우 운영체제 환경에서 사용되는 파일, 프린터, 직렬 포트 등에 대한 공유 프로토콜로 유닉스/리눅스 운영체제에서는 삼바 소프트웨어를 설치하면 SMB를 이용한 유닉스/리눅스와 윈도우 컴퓨터 간 공유가 가능하다.
* 초기 SMB는 NetBios API에서 동작했으며 TCP 139번 포트를 사용
* 윈도우 2000 이후 SMB 기능을 확장하여 **CIFS(Common Internt FIle System)라는 이름으로 변경, TCP 445번 포트 사용
* 여러 보안 취약점으로 인해 컨피커 웜 바이러스, 워너크라이 랜섬웨어, 워너마인 암호화폐 채굴 악성코드 등에 악용
* tcp 445 포트 차단

### PING
* ICMP Echo Request 메시지를 특정 호스트에 송신하여, 이에 대한 ICMP Echo reply를 수신함으로써 호스트의 활성화 여부를 검사하고 요청과 응답에 대한 경과 시간 RTT(Round Trip Time)를 알아볼 때 사용한다.

### netstat
* 시스템의 네트워크 관련 다양한 상태정보를 확인할 수 있는 유닉스/리눅스/윈도우 시스템의 내장 명령어이다. 네트워크 인터페이스에 대한 정보, 라우팅 테이블 정보, 소켓 상태정보, 프로토콜별 통계 정보 등 지정 옵션에 따라서 다양한 네트워크 관려 정보 제공
* 현재 시스템과 통신하고 있는 네트워크 상태 출력
* -a : 모든 상태의 소켓 정보 출력
* -n : 네트워크 주소(IP, Port)를 숫자 형식으로 출력
* -t 또는 -u : TCP, UDP 소켓 정보만 출력
* -p : 해당 소켓의 PID/프로세스명 정보 출력
* -o : 연결의 소유자 프로세스 ID 출력
* -r : 라우팅 정보 출력
* -i : 네트워크 인터페이스 정보 출력
* -s : 네트워크 프로토콜에 대한 통계 출력

### tcpdump
* 네트워크 인터페이스를 거치는 패킷을 캡처해주는 도구이다. 일반적으로 패킷 캡처용 도구를 패킷 스니퍼라고 한다.
* 자신의 컴퓨터로 들어오는 모든 패킷의 내용을 도청할 수 있으며, 공격자를 추적 및 공격 유형 분석을 위한 패킷 분석 시에 활용할 수 있는 도구이다.
* tcpdump는 유닉스 계열에서 설치, 활용이 가능하며 윈도우 용으로는 windump가 있으며 활용 방법은 유사하다.
* tcpdump 옵션 [BPF]
  * -i : 인터페이스 정보 명시 ex) -i eth0
  * -nn : 출력 시 reverse lookup 수행하지 않는다. 즉, 출력 시 호스트명과 서비스명으로 변환하지 않고 IP와 Port 번호 형식으로 출력하라는 의미이다.
  * -v, -vv, -vvv : 패킷 헤더부까지 상세하게 출력한다.
  * -X, -XX : 패킷의 헤더부 출력과 함께 패킷데이터를 HEX-ASCII 포맷으로 출력한다.
  * -w : 출력할 파일명. 일반적으로 pcap 확장자 사용
  * -r : 읽어올 파일명
  * BPF는 Berkely Packet Filter를 말한다. 이는 대부분의 패킷 스니퍼 프로그램에서 지원하는 방식으로 원하는 패킷만을 스니핑하기 위한 룰을 지정하는 부분이다.
  * BPF 사용 예제
    * ```tcpdump -i eth1 -nn "tcp port 80"```
      * 80번 포트를 출바지 또는 목적지로 하는 tcp 패킷을 캡처한다.
      * 방향성을 지정하려면 src port, dst port와 같이 설정한다.
    * ```tcpdump -i eth1 -nn "tcp and host 192.168.197.1"```
      * 192.168.197.1 주소를 출발지 또는 목적지로 하는 tcp 패킷을 캡처한다. 
      * 방향성을 지정하려면 src host, dst host와 같이 설정한다.
    * ```tcpdump -i eth1 -nn "tcp and net 192.168.197.0 mask 255.255.255.0"```
      * 192.168.7.0/24 대역의 모든 패킷을 캡쳐한다. net 192.168.197.0/24와 같이 CIDR 표기법으로 명시해도 된다.
    * ```tcpdump -i eth1 -nn "tcp port 80 and host 192.168.197.1"```
      * 출발지 또는 목적지 주소가 192.168.197.1이고, 출발지 또는 목적지 포트가 80인 tcp 패킷을 캡처한다.
      * 논리연산을 위해 and, or, and not 등을 지원한다.
    * ```tcpdump -i eth0 -nn "tcp port 80 and not host 192.168.197.1"```
      * 출발지 또는 목적지 포트가 80이고 출발지 또는 목적지 주소가 192.168.197.1 이 아닌 패킷을 캡처한다.

      
        

### tracerout
* 종단 노드 사이에 있는 여러 중계 노드(L3장비/라우터) 각 구간에 대한 네트워크 상태를 관리하기 위한 명령어로 최종 목적지 노드에 도달하는데 경유하는 중계 노드(라우터)의 개수, IP 주소, 응답시간 등을 파악할 수 있다.
* 최초 IP 패킷의 TTL 필드값이 1인 UDP 패킷은 첫 번째 라우터에서 TTL이 감소하여 0으로 되고 해당 패킷이 폐기되었음을 알리는 ICMP Time Exceeded 메시지가 최초 출발지로 전송된다. 두 번째 TTL 필드값이 2인 .....

### 포트 스캐닝
* 공격자가 침입 전 대상 시스템에 어떤 포트(서비스)가 열려있는지 확인하는 작업으로 대상 서버의 동작 여부와 제공하는 서비스 등을 확인할 수 있다.
* TCP Half SCAN이 응답이 없으면 필터링되거나 방화벽으로 차단되는 것으로 판단한다.
* SYN Connect 스캔 (nmap -sT) : SYN 보냄. 포트가 닫혔을 때 RST/ACK 응답, 포트가 열린 경우 SYN/ACK 응답
* Decoy Scan(유인 스캔) : 스캔을 당하는 타겟 호스트에서 스캐너 주소를 식별하기 어렵게 하려고 실제 스캐너 주소 외에도 다양한 위조된 주소로 스캐하는 방식
* FIN SCAN (nmap -sF) : FIN 보냄. 포트가 열을 때 응답 X, 포트가 닫힌 경우 RST/ACK 응답
* XMAS SCAN (nmap -sX) : FIN, PSH, URG 보냄. 포트가 열렸을 때 응답 X, 포트가 닫힌 경우 RST/ACK 응답
* NULL SCAN (nmap -sN) : NULL 보냄. 포트가 열렸을 떄 응답 X, 포트가 닫힌 경우 RST/ACK 응답
* TCP Half SCAN (nmap -sS) : SYN 보냄. 포트가 열렸을 떄 SYN/ACK 패킷이 오면 수신하고 즉시 RST 패킷 보내어 연결 종료, 포트가 닫힌 경우 RST/ACK 응답
* TCP ACK SCAN (nmap -sA) : ACK 보냄. 방화벽 필터링 정책을 테스트하기 위한 스캔이다. RST 응답이 오면 방화벽 정책에 의해 허용되고, 응답이 없으면 방화벽 정책에 의해 차단되고 있는 것으로 판단한다/

### 스니핑
* 랜카드를 무차별 모드(Promiscuous Mode)로 설정한 후 연결된 회신에 흐르는 모든 IP 패킷을 가로채는 공격을 말한다.
* 대표적으로 **스위치 재밍**, **SPAN 포트 태핑 등이 있다.

### 스푸핑
* 포트 주소, IP 주소, MAC 주소 등을 조작하여 네트워크 트래픽 흐름을 왜곡하고 시스템 권한 탈취 등의 행위를 수행하는 공격을 말한다.
* **ARP Spoofing**, **IP Spoofing**, **DNS SPoofing** 공격이 있다.

### 스누핑 
* 네트워크 트래픽상의 정보를 획득하는 공격 행위를 말한다.

### 도스/디도스
* 네트워크 대역을 고갈시키는 등의 공격을 말한다. 대표적으로 TCP SYN Flooding, HTTP Flooding, HTTP CC 등의 공격기법이 있다. 해당 공격이 발생하면 공격 대상 사이트의 서비스 가용성에 심각한 영향을 미친다.

### LAND Attack
* 출발지 IP와 목적지 IP가 동일한 공격이다.

### Fragment Overlap
* 공격자는 공격용 IP 패킷을 위해 두 개의 단편(Fragment)을 생성한다. 첫 번째 단편에서는 패킷 필터링 장비에서 허용하는 HTTP와 같은 포트 번호를 설정한다. 그리고 두 번째 포트 단편에서는 offset을 조작해서 재조합될 때 첫 번째 단편의 일부분을 덮어쓰여 공격자가 원하는 포트로 연결이 된다.

### Tiny Fragment
* 패킷 필터링 장비나 IDS는 필터링을 결정하기 위해 포트 번호를 확인하는데, 포트 번호가 포함되지 않을 정도로 아주 작게(Tiny) 쪼개진 첫 번째 단편을 그냥 통과시킨다. 실제 포트 번호가 포함된 두 번째 단편은 첫 번째 단편이 허용되었으므로 통과하여 공격자가 원하는 포트로 연결이 된다.

### Teardrop
* 공격자가 헤더가 조작된 일련의 IP 패킷 조각들을 전송함으로써 패킷을 재조합하는 과정에서 부하가 걸리게 하는 공격 방법이다.

### Ping Of Death
* 아주 크게 만든 ICMP 패킷을 전송함으로써 공격 네트워크에 도달하는 동안 아주 작은 조각이 되어 공격 대상 시스템이 조각화된 패킷을 모두 처리해야 함으로써 성능을 떨어뜨리는 공격이다.

### Smurf 
* 출발지 IP 주소를 공격대상의 IP 주소로 위조한 ICMP Echo Request 를 브로드캐스트하여 다수의 ICMP Echo Reply 패킷을 공격대상에게 전달되어 서비스 거부 상태 유발 공격
* **대응방법** : 자신의 네트워크로 들어오는 Directed Broadcast 패킷을 막도록 라우터 설정, IP Broadcast Address로 온 ICMP Request 패킷 응답 X

### DRDoS 공격
* 공격자가 출발지 IP를 공격 대상 IP로 위조하여 다수의 반사 서버(Reflector)로 요청정보를 전송하면 공격 대상은 반사 서버로부터 대량의 응답을 받아 서비스 거부 상태가 되는 공격 형태이다.

## DDoS 공격
* Attack : C&C 서버에 공격 명령을 실행하는 공격자 컴퓨터
* Target : 공격 대상 되는 피해 시스템
* C&C 서버(Master) : 공격자로부터 직접 공격 명령을 전달받는 시스템을 말하며 전달받은 명령은 관리하는 다수의 좀비 PC/Device에 전달
* 좀비 PC/Device(Slave) : C&C 서버로부터 전달받은 명려을 실행하여 공격 대상에 실제 공격을 수행하는 시템
### 트리누 (Trinoo)
* 미네소타 대학, 솔라리스 2.x에서 최초 발견
* UDP Flooding DDoS 공격을 유발하는 데 사용되었으며 Attacker, Master, Zombie로 공격 네트워크를 구성
* rpc.statd, rpc.cmds, rpc.ttdserverd 데몬의 취약점을 이용
* 접속 포트
  * Attack -> Master : 27665/tcp
  * Master -> Zombie : 27444/udp
  * Zombie -> Master : 31335/udp
  * Zombie -> Victim : udp 공격
#### Trino 공격 실습
* Master 데몬을 통한 공격
  1. telnet을 통한 Master 데몬 접속(27665/udp)
     * 원격 접속 시 패스워드 사용(password : betaalmostdone)
  2. bcast 명령 : Zombie PC 리스트 확인
  3. doc 공격 대상 IP 명령 : 공격 대상 IP로 공격 개시(192.168.8.11)
     * dos 192.168.8.11
  4. mdie killme : 공격 중지
   
### TFN (Tribe Flood Network)
* Trinoo처럼 rpc.statd, rpc.cmds, rpc.ttdserverd 데몬의 취약점을 이용
* Attacker가 Master에 명령 시 패스워드를 쓰지 않고 ICMP echo request 패킷에 명령어를 전송
* TCP, UDP, ICMP 등을 복합적으로 사용하여 TCP Syn Flooding, UDP Flooding, ICMP Flooding, Smurf 공격 수행

### Stacheldracht
* Trinoo와 TFN의 발전된 형태로 TCP Syn Flooding, UDP Flooding, ICMP Flooding, Smurf 공격 등을 수행
* Master에 새로운 Agent가 자동으로 갱신되는 특징이 있다.
* 접속 포트
  * Attack -> Master : 16660/tcp
  * Master -> Zombie : 65000/tcp
  * Zombie -> Master : ICMP Echo Reply
  * Zombie -> Victim : TCP Syn, UDP Flooding, ICMP Flooding, Smurf

### TFN2K
* TFN의 발전된 형태로 통신에 특정 포트가 사용되지 않고 암호화되어 있음
* TCP, UDP, ICMP 등을 복합적으로 사용하여 TCP Syn Flooding, UDP Flooding, ICMP Flooding, Smurf 공격 등을 수행
* UDP 패킷의 헤더는 정상적인 UDP 패킷보다 3byte 크고 TCP 패킷의 헤더 길이는 항상 0이다.

### P2P 봇넷
* 분산형 명령/제어 방식
* 참여 멤버(좀비/봇) 모두 C&C 역할을 하므로 별도의 도메인과 C&C 서버가 불필요하다.
* 대표적인 봇넷으로 Strom, Peacomm 등이 있다.

### DGA (Domain Generation Algorithm) 기법
* 새로운 C&C서버 도메인을 동적으로 다수 생성해 C&C 서버가 노출되는 것을 숨기는 기법으로 도메인 기반으로 탐지하는 보안장비를 우회하기 위한 목적
* 약속된 규칙 도메인명을 생성하기 때문에 C&C 서버를 운영하는 공격자는 해당 규칙에 따라 생성될 수 있는 도메인명 중 하나를 DNS 서버에 새롭게 등록하는 방식으로 운영

### HTTP Get Flooding
* 공격자가 동일한 동적 컨텐츠(/index.php)에 대한 HTTP GET 요청을 대량으로 발생시켜 공격 대상 웹서버가 해당 요청을 처리하기 위해 서버 자원을 과도하게 사용하도록 하여 정상적인 요청을 처리하지 못하도록 하는 서비스 거부 공격이다.

### Slow HTTP Header Dos 
* HTTP 프로토콜을 이용한 서비스 거부 공격으로 정상적인 HTTP 패킷의 헤더는 Carriage Return & Line Feed(개행문자)가 두 번 나타나지만, 해당 공격이 발생하면 헤더의 마지막에 개행문자를 하나만 전송하여 웹서버와의 다수 연결 상태를 장시간 지속시킴으로써 웹서버의 자원을 잠식하게 되는 공격

### Slow HTTP POST DoS(RUDY)
* 다수의 HTTP POST 요청 시 Content-Length 헤더를 매우 크게 설정한 후 매우 작은 데이터를 천천히 지속해서 전송함으로써 웹서버와의 연결을 장시간 지속시켜 연결 자원을 모두 소진시키는 DoS 공격을 말한다.

### Slow HTTP Read DoS
* 다수의 HTTP 요청에 대한 서버 응답에 대해 조작된 'TCP Zero Window 패킷'을 천천히 지속해서 전송하여 HTTP 응답 데이터 수신을 지연시킴으로써 웹서버와의 연결을 장시간 지속시켜 연결자원을 모두 소진시키는 형태의 DOS 공격을 말한다.

### TCP SYN Flooding
* 정상적인 TCP 연결이라면 클라이언트로부터 SYN+ACK에 대한 ACK 응답을 받아 연결 설정이 완료되지만 'TCP SYN Flooding 공격'의 경우 공격자가 출발지 IP를 위조하여 다수의 요청을 발생시키고 위조된 출발지 주소이기 떄문에 SYN+ACK에 대한 정상 ACK 응답이 발생하지 않는다.
* 공격 대상 서버의 제한된 **Backlog Queue(연결요청대기큐)** 를 모두 소진시키는 형태의 공격이다.
* 따라서 netstat -an 명령을 수행하여 서버 측에서 다수의 SYN_RECV의 연결 설정 중인 소켓을 확인할 수 있다.
* TCP SYN Flooding 대응방안
  1. Backlog Queue(연결요청대기큐) 의 크기를 늘린다.
  2. 보안장비를 이용해 임계치 기반의 차단을 수행한다.
  3. TCP SYN Cookie 설정한다. -> ```sysctl -w net.ipv4.tcp_syncookies=1```

### ngrep 
* tcpdump/wirewhark 와 같이 패킷을 캡처하고 분석할 수 있는 도구이다. 일반적으로 Ascii 형식으로 패킷의 데이터를 보고자 할 때 유용하게 사용할 수 있다.
* -I : pcap 파일을 read
* -t : 타임스탬프를 출력
* -W byline : 패킷을 라인 단위로 출력한다.

### DNS 증폭 공격
* 악용하는 질의 방식으로 DNS Record 질의 타입을 ANY, TXT로 지정하면 요청한 도메인에 대한 모든 레코드 타입의 응답이 반환되기 때문에 응답이 증폭되는 효과가 있다.
* tcpdump 패킷을 보면 ID+ 형태는 질의 ID* 형태는 응답을 의미한다.

### 멤캐시드 (Memcached)
* 오픈소스 메모리 캐싱 시스템(메모리를 사용해 캐시 서비스를 제공해주는 데몬)으로 11211/tcp 와 11211/udp 포트를 기본 포트로 사용한다.
* 별도의 인증과정 없이 접근을 허용해주기 때문에 공격자가 멤캐시드 서버 IP 주소의 기본 포트인 11211번 포트로 희생자의 IP 주소로 위조한 특정 명령(state, set/get 명령 등)의 UDP 패킷을 전송하면 멤캐시드 서버가 희생자 IP로 패킷보다 증폭된 패킷을 반사하게 된다.

### WSD (또는 WS-Discovery)
* 웹 서비스 디스커버리의 준말로 자동으로 장비를 검색해주는 기술이다.
* UDP 3702번 포트를 기반으로 한 멀티캐스트 통신을 사용한다.
* 윈도우 기반 기기들이 네트워크 프린터 등을 자동으로 찾아서 연결 설정을 완료하는데 사용되는 서비스로 내부 네트워크망에서 사용되지만, 인터넷망에 노출되면 디도스 공격으로 악용될 수 있다.
* **WSD 증폭/반사** 공격은 요청 시 악의적으로 XML 오류 응답 메시지를 반복적으로 유발하는 명령을 요청하고 위조된 피해자의 IP로 대규모의 증폭된 응답이 가게 만드는 공격기법이다.

### ARMS (Apple Remote Management Service)
* 애플 기기들의 원격제어 기능을 활성화할 때 사용되는 데스크톱 원격제어 프로토콜이다.
* TCP/UDP 3283번 포트를 사용한다.
* **ARMS 증폭/반사** 공격은 피해자 IP로 출발지 IP를 위조한 후 취약한 애플 MAC 컴퓨터를 대상으로 원격 접속 요청을 보내 증폭된 응답이 가게 만드는 공격기법이다.

### CoAP (Constrained Application Protocol)
* 불안정한 네트워크상의 저전력 IoT 기기들을 위한 일종의 애플리케이션 프로토콜로 주로 중국의 모바일 폰과 사물인터넷 장비들 사이에서 사용된다.
* uDP 5683번 포트를 사용한다.
* 피해자 IP로 스푸핑한 출발지 IP에서 외부 노출된 IoT 기기 및 모바일 장치들을 대상으로 변조된 Get Request를 보내 증폭된 응답이 가게 만드는 공격기법이다.

### WEP (Wired Equivalent Privacy)
* 랜덤하게 생성되는 24bit 초기벡터(IV)와 고정된 40Bit(WEP-40) 또는 104Bit(WEP-104)의 WEP 공유키를 조합하여 WEP 암호키를 생성한 후 RC4 암호 알고리즘을 기반으로 한 난수발생기에 입력하여 스트림 암호를 위한 키스트림을 생성한다.
* 평문의 무결성을 보장하기 위해 CRC-32 알고리즘을 이용하여 무결성 체크값(ICV)을 생성한 후 평문과 조합하여 키스트림과 XOR 연산을 수행, 암호문을 생성한다.
* 무선 AP와 무선 단말기 사이에 사전에 서로 동일하게 설정된 공유키를 이용하여 인증과 데이터 암호화 기능을 제공하지만, 해당 무선랜을 사용하는 모든 장비(무선 AP와 무선 단말기)가 하나의 고정된 공유키를 사용하기 때문에 외부에 노출될 가능성이 크며 이를 통해 많은 보안 문제가 발생할 수 있다.
*  암호 알고리즘 : RC4

### WPA
* WEP와 동일한 RC4 알고리즘을 기반으로 하며 48bit 확장된 IV를 사용하는 TKIP 암호화 방식을 사용한다.
* 암호 알고리즘 : RC4-TKIP

### WPA 2
* WPA와 키 관리의 유사성을 가지고 있지만 AES 기반의 128bit 대칭키를 사용하고 블록암호모드로 CCM 모드를 사용하는 CCMP 암호화 방식을 사용한다.
* EAP (Extensible Authentication Protocol) : 다양한 종류의 인증방식을 캡슐화해서 전송하는 역할을 하는 인증 프로토콜이다.
* 암호 알고리즘 : AES-CCMP

### SSID (Service Set Identifier)
* 무선랜을 구분하기 위한 32byte 이름으로 서로 다른 무선랜을 식별하기 위한 용도로 사용한다.
* 무선 장비에서 Wi-Fi를 활성화했을 때 나오는 무선랜 목록이 바로 SSID를 의미한다.
* 보안상의 목적으로 무선랜 접속을 제한하기 위해 와이파이 공유기에 설정하는 옵션으로 "SSID 브로드캐스트를 사용하지 않도록(disable)" 설정한다.

### NAT (Network Address Translation)
* 내부 네트워크에서 사용하는 사설IP(Private IP)와 인터넷에서 사용하는 공인 IP(Public IP) 간의 변환 기술을 말한다.
* 부족한 공인 IP를 절약할 수 있고, 외부에서 사설 IP를 사용하는 내부 호스트로 직접 접근이 불가능하므로 내부 네트워크(사설망)를 보호할 수 있는 보안상의 장점이 있다.
### 워 드라이빙
* 무선랜 해킹과 관련하여 해커가 무선 네트워크를 찾기 위해 무선 장치를 가지고 주위의 AP를 찾는 것
* 임의의 번호를 추출해 원하는 모뎀을 찾아냄으로써 컴퓨터에 대한 해킹을 시도하는 것이다.

### SSL / TLS
* 넷스케이프사가 처음으로 만들었으며 이 프로토콜은 신뢰할 수 있는 종단-대-종단의 안전한 서비스를 제공하기 위해 TCP를 이용하도록 설계하였으며, 인증 및 암호화 기능을 제공한다. 웹 브라우저와 웹서버 간에 서로 상대의 신원을 확인하는 기능이 있다.
* 443/tcp 포트를 사용한다.
* 인터펫기술표준화기구(IETF)에서 SSL을 기반으로 표준화한 TLS가 있으며, 무선환경에서는 WTLS가 사용된다.
* TLS 1.3 버전에서 강화된 보안과 빨라진 성능을 특징으로 하고 있다.
  * TLS 1.2 이하 버전에서는 최초 세션 연결 시 2-RTT를 거쳐야 했으나 TLS 1.3에서는 이과정을 1-RTT로 단축하여 성능 향상
  * 세션 재연결 시에도 TLS 1.2 이하 버전에서는 1-RTT을 거쳐야 했으나 TLS 1.3에서는 공유된 암호키를 로컬에 저장하여 바로 요청 메시지에 해당 키를 사용하는 방식의 0-RTT를 지원한다.
* SSL/TLS 취약성 이용한 공격
  * BEAST (Browser Exploit Against SSL?TLS) 공격 : 사용자 브라우저의 취약점을 이용하여 HTTPS 쿠키를 훔쳐서 HTTPS 세션을 가로챌 수 있는 공격
  * CRIME (Compression Ration Info-Mass Exploitation) 공격 : HTTPS의 압축에 따른 취약점을 이용하여 HTTPS 쿠키를 훔쳐서 HTTPS 세션을 가로챌 수 있는 공격
* Handshake 프로토콜 : 종단 간에 보안 파라미터를 협상하기 위한 프로토콜
  1. 협상 단계
  2. 서버 인증 및 키 교환
  3. 클라이언트 인증 및 키 교환
  4. 협상한 보안 파라미터를 적용하여 메시지 교환
* Change cipher spec 프로토콜 : 협상한 보안 파라미터를 이후부터 적용함을 알리기 위한 프로토콜
* Alert 프로토콜 : 통신 과정에서 발생하는 오류를 통보하기 위한 프로토콜
* Application Data 프로토콜 : 응용 계층의 데이터를 전달하기 위한 프로토콜
* Record 프로토콜 : 상위 계층 프로토콜 데이터의 전달 및 적용된 보안 파라미터를 이용하여 애플리케이션 데이터에 대한 단편화 및 재조합, 암호화 및 복호화, 압축 및 압축해제, 메시지 인증 코드(MAC) 생성 및 검증 등을 제공하는 프로토콜
  1. 단편화 : 애플리케이션 데이터를 일정 크기로 단편화한다.
  2. 압축 : 단편화된 데이터를 압축 알고리즘으로 압축한다.
  3. MAC : MAC 값을 계산하여 추가한다.
  4. 암호화 : 압축된 데이터와 MAC 값을 암호 알고리즘으로 암호화한 후 Record 헤더를 추가하여 전송한다.

### SSH (Secure Sheel)
* 인터넷에서 원격으로 호스트를 관리하는 안전한 암호통신 터미널 프로그램
* 한 컴퓨터에서 다른 컴퓨터로 파일을 옮김
* 안전하지 않은 채널 사이의 강력한 인증기능 제공
* rlogin, rsh, telnet, ftp와 같은 프로그램을 안전하게 대체
* 22번 포트를 사용한다.

### 라우터
* Unicast RPF (Receive Path Forwarding) 패킷 필터링 기법
  * 라우팅 테이블을 확인하여 출발지 주소, 목적지 주소가 있는지 확인하여 차단한다.
* 정적/동적 라우팅 개념
  * 정적 라우팅 : 관리자가 직접 라우팅 테이블을 설정하는 방식으로 관리자가 설정해준 경로로만 전달되기 때문에 정확하고 라우터 간의 정보 교환이 필요하지 않아 트래픽 낭비를 막을 수 있지만 규모가 큰 네트워크의 경우 관리의 어려움이 있다.
  * 동적 라우팅 : 라우팅 프로토콜을 이용하여 자동으로 경로를 탐색하고 패킷을 전달하는 방법으로 프로토콜 설정만 해주면 관리자가 일일이 경로를 설정해야 하는 수고를 덜 수 있다.
* 라우팅 프로토콜 분류
  * IGP (interior Gateway Protocol) : 자율 시스템(AS) 내부에서 사용하는 라우팅 프로토콜, 자율 시스템은 조직/기관 내부에서 직접 관리하는 라우터 집합을 말한다.
    * 거리 벡터 : RIP, RIPv2, IGRP
    * 링크 상태 : IS-IS, OSPF
    * 하이브리드 : EIGRP
  * EGP (Exterior Gateway Protocol) : 자율 시스템 간에 사용하는 라우팅 프로토콜
    * 경로 벡터 : BGP 
* Ingress 필터링 : Standard 또는 Extended Access-List를 활용하여 라우터 내부로 즉, 사내 네트워크로 유입되는 패킷의 출발지 IP 주소를 점검하여 허용 또는 거부하도록 하는 것이다.
* Egress 필터링 : 내부에서 라우터 외부로 나가는 패킷의 출발지 IP 주소를 검사하여 허용 또는 거부하도록 하는 것이다.
* 블랙홀 필터링 : 특정한 목적지 IP 주소 또는 IP 주소 대역에 대해서 null이라는 가상의 인터페이스로 보내도록 함으로써 패킷의 통신이 되지 않도록 하는 것이다.
* access-list rule
  * access-liust acl번호 [permit(허용) 또는 deny(차단)] 프로토콜 출발지 [출발지-wildcard] 목적지 [목적지-wildcard] [목적지 포트]
  * (예시 1) access-list 150 deny tcp 192.168.1.0 0.0.0.255 host 100.100.100.1 eq 80
    * 출발지 IP가 192.168.1.0/24 대역이고 목적지 IP가 100.100.100.1(특정 IP 지정 시 host 키워드 명시)이고 목적지 포트가 80(eq는 equal)인 TCP 패킷에 대해 모두 차단한다.
    * 모든 IP 주소를 명시할 경우 any 키워드 사용
  * (예시 2) access-list 150 deny udp host 192.168.2.5 100.100.100.0 0.0.0.255 range 100 200
    * 출발지 IP가 192.168.2.5이고 목적지 IP가 100.100.100.0/24 대역이고 목적지 목적지 포트가 100~200(range를 통해 포트 범위 지정)인 UDP 패킷에 대해 모두 차단한다.
* Cisco IOS 
  * config terminal ->[config] no snmp-server (SNMP 서비스를 비활성화)
  * config terminal ->[config] interface FastEthernet 0/0 ->[config-if] no IP directed-broadcast (directed broadcast를 거부한다. 스머프, 여러 증폭/반사 를 방어)

### 네트워크 통신 스니핑을 탐지할 수 있는 다양한 방법
#### ICMP 스니핑을 탐지 방법 (PING)
* 의심스러운 호스트에 해당 네트워크에 존재하지 않는 MAC 주소로 위조한 ping(ICMP Echo Request 메시지)을 보내면 다음과 같은 결과를 확인할 수 있다.
* ICMP Echo Reply가 오는 경우 : 이 경우는 해당 호스트가 스니핑을 하는 것이다. 왜냐하면 존재하지 않는 MAC 주소로 ping을 했는데 무차별 모드로 스니핑을 하고 있지 않다면 이 요청을 볼 수 없기 때문이다.
* ICMP Echo Reply가 오지 않는 경우 : 이 경우는 해당 호스트가 요청 패킷을 정상적으로 폐기한 것이므로 스니핑을 하지 않는 정상적인 호스트이다.

#### ARP 스니핑 탐지 방법 
* ping과 유사한 방법으로 존재하지 않는 MAC 주소로 위조된 non-broadcast ARP Request를 보냈을 때 ARP Response가 오면 상대방 호스트가 무차별 모드로 설정되어 스니핑하고 있음을 확인할 수 있다.

#### DNS 스니핑 탐지 방법
* 일반적으로 스니핑 프로그램은 사용자의 편의를 위해 스니핑한 시스템의 IP 주소를 inverse(reverse) dns lookup을 수행한다. 따라서 대상 네트워크에 ping sweep을 보내고 들어오는 inverse lookup 패킷을 감사하여 스니퍼를 탐지한다. ping sweep은 해당 네트워크의 모든 호스트에게 ping을 날리는 방식을 의미한다. 

#### 유인(Decoy)을 이용한 방법
* 스니핑 공격의 주요 목적은 계정과 패스워드를 획득하는 것이다. 따라서 보안관리자는 가짜 계정과 패스워드를 네트워크에 계속 뿌린다. 공격자는 이 계정을 이용해 접속을 시도하는 시스템을 탐지함으로써 스니퍼를 탐지한다.

#### ARP watch
* 초기 MAC 주소와 IP 주소의 매칭값을 저장하고 ARP 트래픽을 모니터링하여 변화가 있는 ARP 패킷을 탐지하는 도구이다. 대부분의 스니핑 공격기법이 ARP Spoofing을 사용하기 떄문에 이를 탐지할 수 있다.

### CIDR (Classless InterDomain Routing)
* 기존의 클래스(A, B, C, D) 기반 주소 체계를 대체하여 클래스 구분 없이 IPv4 전체 bit에 대해 네트워크 ID 와 호스트 ID를 설정하는 주소 할당 방식이다.

### TCP 프로토콜
* 제어 플래그
  * SYN : 연결 설정
  * FIN : 연결 종료
  * RST : 연결 중단
  * ACK : 정상 수신 응답
  * URG : 긴급 데이터로 설정하여 순서와 상관없이 긴급 처리
  * PSH : 수신 버퍼의 데이터를 상위 계층으로 즉시 전달

### TCP Syn Cookie
* TCP 표준에 명시된 클라이언트의 유효성을 확인하기 위한(클라이언트를 인증하기 위한) 기술이다.
* 클라이언트 SYN 요청에 대한 응답으로 SYN+ACK를 전송할 때 Sequence Number 필드에 ISN(Initial Sequence Number) 대신 알고리즘을 통해 생성한 Cookie 값을 설정하여 전송한다. 정상적인 클라이언트라면 SYN+ACK에 대한 응답에 Cookie +1 값을 Acknowledgment Number 필드에 설정하여 응답하게 된다. 응답에 포함된 Cookie 값을 검증하여 정상적인 클라이언트인지 판단하게 된다.
* 클라이언트의 유효성이 확인될 때까지 서버 측에서 'Backlog Queue(연결요청대기큐)'에 연결요청 정보를 저장하지 않기 때문에 TCP SYN Flooding 공격에 효과적으로 대응할 수 있다.
* 서버에 직접 TCP SYN Cookie 기능을 활성화하면 Cookie 생성 및 검증에 대한 부하가 크기 때문에 서버 앞단에 있는 별도의 장비(디도스 대응 장비, L4-Switch 등)를 이용하여 적용하는 경우가 일반적이다.
* SYN Cookie 생성 알고리즘 : 일반적으로 Local IP, Local Port, Foreign IP, Foreign Port, Timestamp 등 동일 클라이언트의 요청 여부를 식별할 수 있는 값을 조합 및 해시하여 32bit 해시값을 생성, SYN Cookie 값으로 사용한다.

* 유닉스/리눅스 Syn Cookie 커널 파라미터 설정하기(0: 미설정, 1: 설정)
  1. ```sysctl -w net.ipv4.tcp_syncookies=1```
  2. ```echo 1> /proc/sys/net/ipv4/tcp_syncookies``` 
