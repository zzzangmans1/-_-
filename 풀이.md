
### 허브 
* 한 포트에서 수신한 신호를 모든 포트로 전달할 뿐 트래픽을 조작하거나 검사하지 않는다.

### 브로드캐스트 주소 구하는 방법
* MAC은 ```FF:FF:FF:FF:FF:FF```
* IP는 예를 들어 161.134.4.0/22 의 브로드캐스트 주소를 구하면
  1) 서브넷 마스크 11111111 11111111 11111100 00000000 2진수를 구한다
  2) 호스트 주소 00000000 00000000 00000011 11111111 2진수를 구한다.
  3) 161.134.4.0 OR 호스트 주소를 한다.
  4) 161.134.7.255 가 브로드캐스트 주소이다.
 
### 데이터 링크 계층 2계층
* 데이터 링크 계층은 두 개의 서브 계층으로 구분한다. 하위 MAC(Media Access Control) 계층과 상위 LLC(Logical Link Control) 계층이 위치한다.
  * 하위 MAC 계층 : 장비 간 공유 매체에 대한 다중 접근 제어를 담당(CSMA/CD)
  * 하위 LLC 계층 : 장비 간 논리적 연결을 수립하고 제어하는 역할 담당(회선제어, 흐름제어, 오류제어 등)
* 단위는 프레임을 사용하고, 대표적인 장비로 스위치, 브릿지 등이 있으며 보안 프로토콜로 PPTP, L2F, L2TP 등이 있다.
* MAC 주소는 48bit, 6byte로 이루어지며, IP주소를 ARP 프로토콜을 사용하면 MAC 주소를 알 수 있다.

* 스위치, 허브는 단일 Network 구간에서 사용된다.

### 스위치(L2-Switch)
* 한 포트에서 수신한 신호를 목적지 포트로만 전달한다. 확장 제한이 없으며, 이중화시 **스패닝 트리 프로토콜**을 이용하여 무한 루핑을 방지할 수 있다.
  1. Store-and-Firward 방식 : 수신된 전체 프레임을 버퍼에 저장하고 CRC 등의 오류 검사 수행 후 목적지 전송
  2. Fragment-Free 방식 : 수신된 프레임의 첫 64byte를 버퍼에 저장하고 충돌 등의 오류 검사 수행 후 목적지 전송
  3. Cut-Throuth 방식 : 수신된 프레임의 첫 6byte를 읽어 도착 MAC 주소를 검사 수행 후 목적지 전송

### 포트 미러링
* 스위치 환경에서 모니터링과 트래픽 분석을 위해 특정 포트로 전달되는 패킷 또는 VLAN의 모든 패킷을 다른 모니터링 포트로 복제하여 전달

### 네트워크 계층 3계층
* 송신 측으로부터 수신 측까지 데이터를 안전하게 전달하기 위해 논리적 링크를 설정하고 상위 계층 데이터를 작은 크기의 패킷으로 분할하여 전송하는 역할
* 단위로 패킷을 사용하고, 경로 설정에 사용할 논리적 주소를 제공하며 대표적인 장비로는 라우터가 있고 대표적인 보안 프로토콜로 IPsec이 있다.

### 라우터
* 가장 핵심적인 기능은 패킷의 경로를 결정하는 것과 결정된 경로에 따라 패킷을 전송하는 기능이다.
* VLAN 간에 통신을 가능하게 하고, 기본적인 보안 기능과 QoS 관련 기능 지원

### 전송 계층 4계층
* 종단 노드 간의 신뢰성 있는 데이터 전송을 담당한다.
* 단위로 세그먼트를 사용하고, 대표적인 보안 프로토콜로 SSL/TLS가 있다.

### 표현 계층 (Presentation Layer) 6계층 / TCP/IP 계층에서는 4계층 응용 계층
* 송수신 자가 데이터를 이해할 수 있도록 표현방식의 변환을 담당하는 계층이다.
* 데이터 압축/압축해제, 암호화/복호화, 인코딩/디코딩 등을 담당

### OSI 7계층 PDU (Protocol Data Unit)
1. 응용프로그램 계층
2. 표현 계층
3. 세션 계층        - 응용까지 데이터
4. 전송 계층        - 세그먼트
5. 네트워크 계층    - 패킷
6. 데이터 링크 계층 - 프레임
7. 물리 계층        - 비트

### 1. VLAN
* **데이터링크 계층에서 브로드캐스트 도메인을 나누기 위해 사용하는 기술**로 물리적인 네트워크 구조의 변경 없이 스위치에서 제공하는 기능을 통해 **논리적으로 서브넷을 구성**할 수 있다.
* VLAN을 통해 가상의 브로드캐스트 도메인을 생성함으로써 **브로드캐스트 트래픽을 제한하여 전체 네트워크 서비스의 성능향상**을 기대할 수 있다.
* 서로 다른 VLAN에 대해 **서로 다른 보안 정책(네트워크 자원 접근 제한)을 적용할 수 있으므로 보안성**을 높일 수 있다.
* 예를 들어, 인사 부서가 강화된 보안을 요구한다면 관리자는 정책을 개발하고 모든 인사 부서 사용자들을 특정 VLAN에 추가하고 강화된 보안 정책을 인사 부서 VLAN에만 적용할 수 있다.

### 2. VLAN 종류
1. **Port 기반 VLAN** : 스위치 포트를 각 VLAN에 할당하는 것으로 같은 VLAN에 속한 포트에 연결된 호스트들 간에만 통신이 가능한 VLAN이다. 이러한 VLAN이 가장 일반적이고 많이 사용되는 구성이다.
2. **MAC 기반 VLAN** : 호스트들의 MAC 주소를 VLAN에 등록하여 같은 VLAN에 속한 MAC 주소의 호스트들 간에만 통신이 가능한 VLAN이다. 이 VLAN은 호스트들의 MAC 주소를 전부 등록하고 관리해야 하는 어려움이 있다.
3. **네트워크 주소 기반 VLAN** : 네트워크 주소별로 VLAN을 구성하여 같은 네트워크에 속한 호스트들 간에만 통신할 수 있도록 구성한 VLAN이다. 주로 IP 네트워크 VLAN을 사용한다.
4. **프로토콜 기반 VLAN** : 같은 통신 프로토콜(TCP/IP, IPX/SPX, Netview 등)을 가진 호스트들 간에만 통신할 수 있도록 구성한 VLAN이다.


### ARP 프로토콜
* 로컬 네트워크의 모든 호스트에게 대상 IP를 가진 호스트의 MAC 주소를 질의하는 요청 메시지를 만들어 브로드캐스트로 요청하고 대상 IP가 설정된 호스트는 자신의 MAC 주소를 담은 응답 메시지를 만들어 요청한 호스트에게 유니캐스트로 응답한다.
* 따라서 요청 메시지를 전송할 때는 이더넷 프레임의 목적지 MAC 주소 필드에 브로드캐스트 주소인 ```FF:FF:FF:FF:FF:FF```가 설정된다.
* **ARP 스푸핑** : MAC 주소를 속이는 공격으로 로컬에서 통신하고 있는 서버와 클라이언트의 IP 주소에 대한 2계층 MAC 주소를 공격자의 MAC 주소로 속임으로써 클라이언트에서 서버로 가는 패킷의 흐름을 왜곡시킨다.
* **스위치 재밍** : 스위치는 맥 주소 테이블이 꽉차면 네트워크 패킷 브로드캐스트를 한다. 이러한 특징을 이용해 임의의 ARP 패킷의 MAC 주소가 스위치의 MAC 주소 테이블을 오버플로우 시켜 특정 수신자에게 가야할 패킷을 브로드캐스트 시켜 공격자는 패킷을 스니핑 할 수 있다.

### ICMP (Internet Control Message Porotol) 프로토콜
* IP 프로토콜의 비 신뢰적인 특성을 보완하기 위해 프로토콜로 IP 패킷 전송 중 에러 발생 시 에러 발생 원인을 알려주거나 네트워크 상태를 진단해주는 기능을 제공해준다.
* ech, timestamp, redirects 등 다양한 작업의 Type 메시지 제공
* ICMP Redirect 메시지는 일반적으로 라우터가 보내는 패킷으로 이를 수신한 호스트 또는 라우터는 자신의 라우팅 테이블에 특정 목적지로 나가는 Gateway 주소를 변경한다. 보안상의 이유로 대부분의 OS에서는 IMCP Redirect 옵션 해제

### IGMP (Internet Group Management Protocol) 프로토콜
* 멀티캐스트를 지원하는 라우터가 멀티캐스트 그룹에 가입한 네트워크 내의 호스트를 관리하기 위해 사용하는 프로토콜이다.
* IGMP는 ICMP와 마찬가지로 IP 상위 계층에 존재하며 IP 패킷으로 캡슐화되어 전송된다.

### IP 단편화 
* ```flag id:size@offset[+] 단편ID:IP 헤더를 제외한 단편 크기(byte)@단편의 상대위치이고 추가 단편이 있음(+)을 의미한다.```
* 예를 들어 MTU가 1500바이트로 설정된 Ethernet을 통해 4,000 바이트의 ping 패킷을 보내려고 한다. 실제 크기는 20byte를 뺀 1480 바이트가 크기가 된다.

### IPv6
* **듀얼스택** : IPv4와 IPv6 프로토콜을 동시에 설정하여 통신 상태에 따라 선택적으로 사용할 수 있도록 하는 방식
* **터널링** : IPv4 네트워크를 경유하여 IPv6 네트워크 간 통신을 위한 방식으로 IPv4 네트워크를 통과하는 가상의 경로(터널)를 만들어 통신하는 방식
* **주소/헤더 변환** : 변환 헤더를 추가하여 IPv4 -> IPv6, IPv6 -> IPv4

### 소켓
* 호스트/프로세스 간에 통신을 위한 소프트웨어 모듈을 의미한다.
* 특정 IP 주소와 포트 번호의 조합으로서 같은 IP의 동일한 시스템이 동시에 특정 클라이언트의 복수 개의 응용 프로그램에 정확하게 통신할 수 있게 해준다.

### 포트
* 상위 애플리케이션/서비스/소켓을 식별하기 위한 식별자로 IANA 기구를 통해 관리되고 있다.
  1. well-known port(0~1023)
     |프로토콜|포트번호|설명|
     |:-:|:-:|:-|
     |FTP, Data|20|파일 전송 프로토콜의 데이터채널|
     |FTP, Control|21|파일 전송 프로토콜의 제어채널|
     |TELNET|23|터미널 네트워크|
     |SMTP|25|간단한 메일 전송 프로토콜|
     |DNS|53|도메인 네임 시스템|
     |BOOTP|67|부트스트랩 프로토콜|
     |HTTP|80|하이퍼텍스트 전송 프로토콜|
  2. Regstered Port(1024~49151)
      * 제조사가 IANA에 용도를 등록해서 사용하는 포트로 일반 사용자가 서버 프로세스를 실행하기 위해 사용하는 포트이다.
  3. Dynamic Port(49152~65535)
      * 서버/클라이언트 환경에서 클라이언트 접속 시 사용하는 임시 포트

### 세션 하이재킹
* 공격자가 인증이 완료된 정상적인 사용자 세션을 중간에 가로채서 별도의 인증작업 없이 정상적인 사용자로 위장하여 가로챈 세션으로 통신하는 행위이다.
  * **TCP 세션 하이재킹** : TCP의 세션 관리 정보(출발지 IP/Port, Sequence Number 등)를 위조하여 TCP 세션을 가로채는 행위
    * TCP 세션 하이재킹은 케빈 미트닉이 시모무라 쓰토무의 컴퓨터 시스템을 공격할 때 사용했던 공격 방식으로 TCP 사용자 정보(IP/Port, Sequence Number)로 위조하여 IP 스푸핑으로 세션 취 
  * **HTTP 세션 하이재킹** : 사용자의 HTTP 세션 ID를 탈취하여 정상 사용자로 위장하여 서버에 접근하는 공격

### netbios (Network Basic Input/Output System) 
* IBM PC를 위한 네트워크 인터페이스 체계로 네임, 세션, 데이터그램의 세 가지 서비스를 제공하고 있다.
* 차단하려면 tcp/udp 135~139 포트 차단

### SMB (Server Message Block)
* 윈도우 운영체제 환경에서 사용되는 파일, 프린터, 직렬 포트 등에 대한 공유 프로토콜로 유닉스/리눅스 운영체제에서는 삼바 소프트웨어를 설치하면 SMB를 이용한 유닉스/리눅스와 윈도우 컴퓨터 간 공유가 가능하다.
* 초기 SMB는 NetBios API에서 동작했으며 TCP 139번 포트를 사용
* 윈도우 2000 이후 SMB 기능을 확장하여 **CIFS(Common Internt FIle System)라는 이름으로 변경, TCP 445번 포트 사용
* 여러 보안 취약점으로 인해 컨피커 웜 바이러스, 워너크라이 랜섬웨어, 워너마인 암호화폐 채굴 악성코드 등에 악용
* tcp 445 포트 차단

### PING
* ICMP Echo Request 메시지를 특정 호스트에 송신하여, 이에 대한 ICMP Echo reply를 수신함으로써 호스트의 활성화 여부를 검사하고 요청과 응답에 대한 경과 시간 RTT(Round Trip Time)를 알아볼 때 사용한다.

### netstat
* 시스템의 네트워크 관련 다양한 상태정보를 확인할 수 있는 유닉스/리눅스/윈도우 시스템의 내장 명령어이다. 네트워크 인터페이스에 대한 정보, 라우팅 테이블 정보, 소켓 상태정보, 프로토콜별 통계 정보 등 지정 옵션에 따라서 다양한 네트워크 관려 정보 제공
* 현재 시스템과 통신하고 있는 네트워크 상태 출력
* -a : 모든 상태의 소켓 정보 출력
* -n : 네트워크 주소(IP, Port)를 숫자 형식으로 출력
* -t 또는 -u 옵션 : TCP, UDP 소켓 정보만 출력
* -p 옵션 : 해당 소켓의 PID/프로세스명 정보 출력

### tracerout
* 종단 노드 사이에 있는 여러 중계 노드(L3장비/라우터) 각 구간에 대한 네트워크 상태를 관리하기 위한 명령어로 최종 목적지 노드에 도달하는데 경유하는 중계 노드(라우터)의 개수, IP 주소, 응답시간 등을 파악할 수 있다.
* 최초 IP 패킷의 TTL 필드값이 1인 UDP 패킷은 첫 번째 라우터에서 TTL이 감소하여 0으로 되고 해당 패킷이 폐기되었음을 알리는 ICMP Time Exceeded 메시지가 최초 출발지로 전송된다. 두 번째 TTL 필드값이 2인 .....

### 포트 스캐닝
* 공격자가 침입 전 대상 시스템에 어떤 포트(서비스)가 열려있는지 확인하는 작업으로 대상 서버의 동작 여부와 제공하는 서비스 등을 확인할 수 있다.
* SYN Connect 스캔 (nmap -sT) : SYN 보냄. 포트가 닫혔을 때 RST/ACK 응답, 포트가 열린 경우 SYN/ACK 응답
* Decoy Scan(유인 스캔) : 스캔을 당하는 타겟 호스트에서 스캐너 주소를 식별하기 어렵게 하려고 실제 스캐너 주소 외에도 다양한 위조된 주소로 스캐하는 방식
* FIN SCAN (nmap -sF) : FIN 보냄. 포트가 열을 때 응답 X, 포트가 닫힌 경우 RST/ACK 응답
* XMAS SCAN (nmap -sX) : ACK, FIN, RST, SYN, URG 보냄. 포트가 열렸을 때 응답 X, 포트가 닫힌 경우 RST/ACK 응답
* NULL SCAN (nmap -sN) : NULL 보냄. 포트가 열렸을 떄 응답 X, 포트가 닫힌 경우 RST/ACK 응답
* TCP Half SCAN (nmap -sS) : SYN 보냄. 포트가 열렸을 떄 SYN/ACK 패킷이 오면 수신하고 즉시 RST 패킷 보내어 연결 종료, 포트가 닫힌 경우 RST/ACK 응답

### 스니핑
* 랜카드를 무차별 모드(Promiscuous Mode)로 설정한 후 연결된 회신에 흐르는 모든 IP 패킷을 가로채는 공격을 말한다.
* 대표적으로 **스위치 재밍**, **SPAN 포트 태핑 등이 있다.

### 스푸핑
* 포트 주소, IP 주소, MAC 주소 등을 조작하여 네트워크 트래픽 흐름을 왜곡하고 시스템 권한 탈취 등의 행위를 수행하는 공격을 말한다.
* **ARP Spoofing**, **IP Spoofing**, **DNS SPoofing** 공격이 있다.

### 스누핑 
* 네트워크 트래픽상의 정보를 획득하는 공격 행위를 말한다.

### 도스/디도스
* 네트워크 대역을 고갈시키는 등의 공격을 말한다. 대표적으로 TCP SYN Flooding, HTTP Flooding, HTTP CC 등의 공격기법이 있다. 해당 공격이 발생하면 공격 대상 사이트의 서비스 가용성에 심각한 영향을 미친다.

### LAND Attack
* 출발지 IP와 목적지 IP가 동일한 공격이다.

### Fragment Overlap
* 공격자는 공격용 IP 패킷을 위해 두 개의 단편(Fragment)을 생성한다. 첫 번째 단편에서는 패킷 필터링 장비에서 허용하는 HTTP와 같은 포트 번호를 설정한다. 그리고 두 번째 포트 단편에서는 offset을 조작해서 재조합될 때 첫 번째 단편의 일부분을 덮어쓰여 공격자가 원하는 포트로 연결이 된다.

### Tiny Fragment
* 패킷 필터링 장비나 IDS는 필터링을 결정하기 위해 포트 번호를 확인하는데, 포트 번호가 포함되지 않을 정도로 아주 작게(Tiny) 쪼개진 첫 번째 단편을 그냥 통과시킨다. 실제 포트 번호가 포함된 두 번째 단편은 첫 번째 단편이 허용되었으므로 통과하여 공격자가 원하는 포트로 연결이 된다.

### Teardrop
* 공격자가 헤더가 조작된 일련의 IP 패킷 조각들을 전송함으로써 패킷을 재조합하는 과정에서 부하가 걸리게 하는 공격 방법이다.

### Ping Of Death
* 아주 크게 만든 ICMP 패킷을 전송함으로써 공격 네트워크에 도달하는 동안 아주 작은 조각이 되어 공격 대상 시스템이 조각화된 패킷을 모두 처리해야 함으로써 성능을 떨어뜨리는 공격이다.

### Smurf 
* 출발지 IP 주소를 공격대상의 IP 주소로 위조한 ICMP Echo Request 를 브로드캐스트하여 다수의 ICMP Echo Reply 패킷을 공격대상에게 전달되어 서비스 거부 상태 유발 공격
* **대응방법** : 자신의 네트워크로 들어오는 Directed Broadcast 패킷을 막도록 라우터 설정, IP Broadcast Address로 온 ICMP Request 패킷 응답 X
