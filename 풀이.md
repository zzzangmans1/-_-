
utmp : 현재 사용중인 사용자 정보 = who, w, finger, user, whodo
wtmp : 로그인/로그아웃 부팅 정보 = last
acct/pacct : history 정보 = lastcomm, acctcomm
btmp : 로그인 실패 정보 = lastb
lastlog : 마지막 로그인 성공 정보 = lastlog

### 브로드캐스트 주소 구하는 방법
* MAC은 ```FF:FF:FF:FF:FF:FF```
* IP는 예를 들어 161.134.4.0/22 의 브로드캐스트 주소를 구하면
  1) 서브넷 마스크 11111111 11111111 11111100 00000000 2진수를 구한다
  2) 호스트 주소 00000000 00000000 00000011 11111111 2진수를 구한다.
  3) 161.134.4.0 OR 호스트 주소를 한다.
  4) 161.134.7.255 가 브로드캐스트 주소이다.
 
### OSI 7계층 PDU (Protocol Data Unit)
1. 응용프로그램 계층
2. 표현 계층
3. 세션 계층        - 응용까지 데이터
4. 전송 계층        - 세그먼트
5. 네트워크 계층    - 패킷
6. 데이터 링크 계층 - 프레임
7. 물리 계층        - 비트

### 물리 계층 1계층
* 물리적 장치의 전기적, 전자적 연결에 대한 명세
* 장비 더미 허브, 리피터

### 허브 
* 한 포트에서 수신한 신호를 모든 포트로 전달할 뿐 트래픽을 조작하거나 검사하지 않는다.

### 데이터 링크 계층 2계층
* 데이터 링크 계층은 두 개의 서브 계층으로 구분한다. 하위 MAC(Media Access Control) 계층과 상위 LLC(Logical Link Control) 계층이 위치한다.
  * 하위 MAC 계층 : 장비 간 공유 매체에 대한 다중 접근 제어를 담당(CSMA/CD)
  * 하위 LLC 계층 : 장비 간 논리적 연결을 수립하고 제어하는 역할 담당(회선제어, 흐름제어, 오류제어 등)
* 단위는 프레임을 사용하고, 대표적인 장비로 스위치, 브릿지 등이 있으며 보안 프로토콜로 PPTP, L2F, L2TP 등이 있다.
* MAC 주소는 48bit, 6byte로 이루어지며, IP주소를 ARP 프로토콜을 사용하면 MAC 주소를 알 수 있다.
* **PPTP (Point to Point Tunnel Protocol)**
  * MS사에서 개발한 프로토콜
  * 하나의 터널에 하나의 연결만을 지원하여 일대일 통신만 가능하다.
* **L2F (Layer 2 Forwarding)**
  * 시스코사에서 개발한 프로토콜
  * 하나의 터널에 여러 개의 연결을 지원하여 다자간 통신이 가능하다.
* **L2TP (Layer 2 Tunneling Protocol)**
  * MS사와 시스코사에서 개발한 프로토콜
  * L2F에 기반을 두고 PPTP와의 호환성을 고려하여 만들어진 터널링 프로토콜   
* 스위치, 허브는 단일 Network 구간에서 사용된다.

### 스위치(L2-Switch)
* 필터링 기능 : 목적지 포트 외에는 프레임을 전송하지 않는다.
* 학습 기능 : 특정 포트로 유입된 프레임의 출발지 MAC 주소를 기반으로 MAC Address Table을 생성하여 포트별 연결된 장비의 MAC 주소를 식별한다.
* 플러딩 기능 : MAC Address Table에 등록되지 않은 목적지 MAC 주소의 프레임은 더미 허브와 동일하게 모든 포트로 프레임을 전송한다.
* 전달 기능 : 생성된 MAC Address Table을 참조하여 전송할 프레임의 MAC 주소의 포트로 프레임을 전달한다.
* 스위치 환경에서 스니핑 방법
  * **Switch Jamming / MAC Flooding** : Switch의 MAC Address Table을 모두 채워서 스위치가 허브처럼 동작하게 강제적으로 만들어 패킷을 스니핑 하는 기법. MAC Address Table을 채우기 위해 ARP Reply 패킷을 계속 전송한다.
  * **ARP Spoofing / ARP Cache Poisoning** : 공격자가 특정 호스트의 MAC 주소를 자신의 MAC 주소로 위조한 ARP Reply 패킷을 만들어 희생자에게 지속해서 전송하면 희생자의 ARP Cache table에 특정 호스트의 MAC 주소가 공격자의 MAC 주소로 변조된다. 이를 통해서 희생자로부터 특정 호스트로 나가는 패킷을 공격자가 스니핑하는 기법이다.
  * ARP Cache Table 을 보는 명령어는 ```apr -a``` 명령어로 확인가능하다.
  * **ARP Spoofing / ARP Cache Poisoning** 대응 방안 : ARP Cache Table 을 정적으로 설정한다. ```arp -s IP MAC```
  * **ARP Redirect** : 공격자가 자신이 라우터인 것처럼 MAC 주소를 위조한 ARP Reply 패킷을 해당 네트워크에 브로드캐스트하면 해당 네트워크에 연결된 모든 호스트의 ARP Cache table에 라우터의 MAC 주소가 공격자의 MAC 주소로 변조도니다. 이를 통해서 희생자로부터 외부 네트워크로 나가는 패킷을 공격자가 스니핑하는 기법이다.
  * **ICMP Redirect** : ICMP Redirect 메시지는 라우터에서 호스트 또는 라우터 간에 라우팅 경로를 재설정하기 위해 전송하는 메시지이다. 공격자는 이를 악용하여 특정 IP 또는 대역으로 나가는 라우팅 경로를 자기 주소로 위조한 ICMP Redirect 메시지를 생성하여 희생자에게 전송함으로써 희생자의 라우팅 테이블에 공격자로 향하는 경로를 생성한다. 이를 통해서 특정 IP 또는 대역으로 나가는 패킷을 공격자가 스니핑하는 기법이다.
  * **ICMP Redirect 대응 방안** : 호스트의 라우팅 테이블 정보가 ICMP Redirect 메시지에 의해 변경되지 않도록 호스트의 ICMP Redirect 옵션을 해제한다.
  * **Switch의 Span/Monitor Port를 이용** : 원래 Monitor Port란 스위치를 통과하는 모든 트래픽을 볼 수 있는 포트로 네트워크 관리 목적이지만 공격자가 트래픽들을 스니핑하는 좋은 장소를 제공한다.
* 한 포트에서 수신한 신호를 목적지 포트로만 전달한다. 확장 제한이 없으며, 이중화시 **스패닝 트리 프로토콜**을 이용하여 무한 루핑을 방지할 수 있다.
  1. Store-and-Forward 방식 : 수신된 전체 프레임을 버퍼에 저장하고 CRC 등의 오류 검사 수행 후 목적지 전송
  2. Fragment-Free 방식 : 수신된 프레임의 첫 64byte를 버퍼에 저장하고 충돌 등의 오류 검사 수행 후 목적지 전송
  3. Cut-Throuth 방식 : 수신된 프레임의 첫 6byte를 읽어 도착 MAC 주소를 검사 수행 후 목적지 전송
* 허브와의 차이점은 스위치는 MAC Address Table을 참조해 목적지 MAC 주소에만 전달하기 때문에 허브보다 상대적으로 스니핑에 안전하다.

### 포트 미러링
* 스위치 환경에서 모니터링과 트래픽 분석을 위해 특정 포트로 전달되는 패킷 또는 VLAN의 모든 패킷을 다른 모니터링 포트로 복제하여 전달

### 네트워크 계층 3계층
* 송신 측으로부터 수신 측까지 데이터를 안전하게 전달하기 위해 논리적 링크를 설정하고 상위 계층 데이터를 작은 크기의 패킷으로 분할하여 전송하는 역할
* 단위로 패킷을 사용하고, 경로 설정에 사용할 논리적 주소를 제공하며 대표적인 장비로는 라우터가 있고 대표적인 보안 프로토콜로 IPsec이 있다.
* **IPSEC**
  * 터널링 : 송신자와 수신자 사이의 전송로에 외부로부터의 침입을 막기 위한 일종의 파이프를 구성하는 기술
  * IKE : IPsec의 보안연관(SA) 생성을 위한 협상에 사용되는 키 교환 프로토콜로 500/udp 포트를 사용한다.
  * 전송모드 : 종단 호스트 사이에서 터널이 생성되는 것으로 IP 헤더를 제외한 부분에 대해서 보안 서비스를 제공하고 트래픽 흐름 분석에 취약할 수 있다. **보호 구간은 종단 노드구간**
  * 터널모드 : 터널 게이트웨이 사이에서 터널이 생성되는 것으로 IP 헤더를 포함한 패킷 전체에 대해서 보호 서비스를 제공한다. **보호 구간은 양쪽 터널 게이트구간 끝과 끝**
  * 보안 서비스 제공 6가지
    * 기밀성 : 대칭키 암호화를 사용하여 기밀성(AH는 X, ESP는 O)
    * 비연결형 무결성 : MAC을 이용하여 무결성 인증
    * 데이터 원천 인증 : 메시지 인증 코드(MAC)을 이용하여 송신자 보장
    * 재전송 공격 방지 : 패킷별 순서번호를 이용하여 재전송 공격 방지
    * 접근제어 : 보안 정책(SP)을 통해 중요 정보 및 시스템 접근 제한
    * 제한적 트래픽 흐름의 기밀성 : 터널모드가 적용된 ESP 는 전체 패킷을 암호화하여 기밀성 보장
  * **AH (Authentication Header)**
    * 메시지 인증 코드(MAC)를 이용하여 '비연결성 무결성'과 '데이터 원천 인증' 서비스를 제공하고, 기밀성 서비스 제공하지 않는다.
    * 순서번호를 통해 재전송 공격 방지한다.
    * 51번 포트를 사용한다.
    * **AH + 전송모드** : [ OriIP + AH_H + Payload , 변경가능한 헤더 제외 패킷 전체 인증 ] 
    * **AH + 터널모드** : [ NewIP + AH_H + OriIP + Payload , 변경 가능한 헤더 제외 패킷 전체 인증 ]
  * **ESP (Encapsulating Security Payload)**
    * 메시지 인증 코드(MAC)를 이용하여 '비연결성 무결성' 과 '데이터 원천 인증' 서비스를 제공하고, 대칭키 암호화를 통해 기밀성 서비스 제공한다.
    * 순서번호를 통해 재전송 공격 방지한다.
    * 50번 포트를 사용한다.
    * **ESP + 전송모드** : IP_H + [ ESH_H + Payload + ESH_T ] + ESP Auth (암호화는 전송모드는 payload + ESH_T 까지 암호화)
    * **ESP + 터널모드** : NewIP + [ ESH_H + OriIP + Payload + ESH_T ] + ESP Auth (암호화 터널모드는 OriIP + payload + ESH_T 까지 암호화)
### 라우터
* 가장 핵심적인 기능은 패킷의 경로를 결정하는 것과 결정된 경로에 따라 패킷을 전송하는 기능이다.
* VLAN 간에 통신을 가능하게 하고, 기본적인 보안 기능과 QoS 관련 기능 지원
* 인터페이스에 ```no ip unreachables``` 설정하는 이유는 전송할 수 없는 패킷이 들어와도 ICMP Unreachable 메시지 응답을 보내지 않는다.
* 보안관점에서 필요한 이유는 차단하지 않으면 악의적인 대량의 패킷을 통해 ICMP Unreachable 메시지 응답에 따른 라우터의 부하 유발, ICMP Unreachable 메시지 응답이 공격자의 포트스캐닝 공격 시 중요한 정보로 사용되기 때문이다.
### 전송 계층 4계층
* 종단 노드 간의 신뢰성 있는 데이터 전송을 담당한다.
* 단위로 세그먼트를 사방

### IGMP (Internet Group Management Protocol) 프로토콜
* 멀티캐스트를 지원하는 라우터가 멀티캐스트 그룹에 가입한 네트워크 내의 호스트를 관리하기 위해 사용하는 프로토콜이다.
* IGMP는 ICMP와 마찬가지로 IP 상위 계층에 존재하며 IP 패킷으로 캡슐화되어 전송된다.

### IP 단편화 
* ```flag id:size@offset[+] 단편ID:IP 헤더를 제외한 단편 크기(byte)@단편의 상대위치이고 추가 단편이 있음(+)을 의미한다.```
* 예를 들어 MTU가 1500바이트로 설정된 Ethernet을 통해 4,000 바이트의 ping 패킷을 보내려고 한다. 실제 크기는 20byte를 뺀 1480 바이트가 크기가 된다.

### IPv6
* **듀얼스택** : IPv4와 IPv6 프로토콜을 동시에 설정하여 통신 상태에 따라 선택적으로 사용할 수 있도록 하는 방식
* **터널링** : IPv4 네트워크를 경유하여 IPv6 네트워크 간 통신을 위한 방식으로 IPv4 네트워크를 통과하는 가상의 경로(터널)를 만들어 통신하는 방식
* **주소/헤더 변환** : 변환 헤더를 추가하여 IPv4 -> IPv6, IPv6 -> IPv4

### 소켓
* 호스트/프로세스 간에 통신을 위한 소프트웨어 모듈을 의미한다.
* 특정 IP 주소와 포트 번호의 조합으로서 같은 IP의 동일한 시스템이 동시에 특정 클라이언트의 복수 개의 응용 프로그램에 정확하게 통신할 수 있게 해준다.

### 포트
* 상위 애플리케이션/서비스/소켓을 식별하기 위한 식별자로 IANA 기구를 통해 관리되고 있다.
  1. well-known port(0~1023)
     |프로토콜|포트번호|설명|
     |:-:|:-:|:-|
     |FTP, Data|20|파일 전송 프로토콜의 데이터채널|
     |FTP, Control|21|파일 전송 프로토콜의 제어채널|
     |TELNET|23|터미널 네트워크|
     |SMTP|25|간단한 메일 전송 프로토콜|
     |DNS|53|도메인 네임 시스템|
     |BOOTP|67|부트스트랩 프로토콜|
     |HTTP|80|하이퍼텍스트 전송 프로토콜|
     |SNMP|161|심플 네트워크 매니지먼트 프로토콜|
  3. Regstered Port(1024~49151)
      * 제조사가 IANA에 용도를 등록해서 사용하는 포트로 일반 사용자가 서버 프로세스를 실행하기 위해 사용하는 포트이다.
  4. Dynamic Port(49152~65535)
      * 서버/클라이언트 환경에서 클라이언트 접속 시 사용하는 임시 포트

### 세션 하이재킹
* 공격자가 인증이 완료된 정상적인 사용자 세션을 중간에 가로채서 별도의 인증작업 없이 정상적인 사용자로 위장하여 가로챈 세션으로 통신하는 행위이다.
  * **TCP 세션 하이재킹** : TCP의 세션 관리 정보(출발지 IP/Port, Sequence Number 등)를 위조하여 TCP 세션을 가로채는 행위
    * TCP 세션 하이재킹은 케빈 미트닉이 시모무라 쓰토무의 컴퓨터 시스템을 공격할 때 사용했던 공격 방식으로 TCP 사용자 정보(IP/Port, Sequence Number)로 위조하여 IP 스푸핑으로 세션 취 
  * **HTTP 세션 하이재킹** : 사용자의 HTTP 세션 ID를 탈취하여 정상 사용자로 위장하여 서버에 접근하는 공격

### netbios (Network Basic Input/Output System) 
* IBM PC를 위한 네트워크 인터페이스 체계로 네임, 세션, 데이터그램의 세 가지 서비스를 제공하고 있다.
* 차단하려면 tcp/udp 135~139 포트 차단

### SMB (Server Message Block)
* 윈도우 운영체제 환경에서 사용되는 파일, 프린터, 직렬 포트 등에 대한 공유 프로토콜로 유닉스/리눅스 운영체제에서는 삼바 소프트웨어를 설치하면 SMB를 이용한 유닉스/리눅스와 윈도우 컴퓨터 간 공유가 가능하다.
* 초기 SMB는 NetBios API에서 동작했으며 TCP 139번 포트를 사용
* 윈도우 2000 이후 SMB 기능을 확장하여 **CIFS(Common Internt FIle System)라는 이름으로 변경, TCP 445번 포트 사용
* 여러 보안 취약점으로 인해 컨피커 웜 바이러스, 워너크라이 랜섬웨어, 워너마인 암호화폐 채굴 악성코드 등에 악용
* tcp 445 포트 차단

### PING
* ICMP Echo Request 메시지를 특정 호스트에 송신하여, 이에 대한 ICMP Echo reply를 수신함으로써 호스트의 활성화 여부를 검사하고 요청과 응답에 대한 경과 시간 RTT(Round Trip Time)를 알아볼 때 사용한다.

### netstat
* 시스템의 네트워크 관련 다양한 상태정보를 확인할 수 있는 유닉스/리눅스/윈도우 시스템의 내장 명령어이다. 네트워크 인터페이스에 대한 정보, 라우팅 테이블 정보, 소켓 상태정보, 프로토콜별 통계 정보 등 지정 옵션에 따라서 다양한 네트워크 관려 정보 제공
* 현재 시스템과 통신하고 있는 네트워크 상태 출력
* -a : 모든 상태의 소켓 정보 출력
* -n : 네트워크 주소(IP, Port)를 숫자 형식으로 출력
* -t 또는 -u : TCP, UDP 소켓 정보만 출력
* -p : 해당 소켓의 PID/프로세스명 정보 출력
* -o : 연결의 소유자 프로세스 ID 출력
* -r : 라우팅 정보 출력
* -i : 네트워크 인터페이스 정보 출력
* -s : 네트워크 프로토콜에 대한 통계 출력

### tcpdump
* 네트워크 인터페이스를 거치는 패킷을 캡처해주는 도구이다. 일반적으로 패킷 캡처용 도구를 패킷 스니퍼라고 한다.
* 자신의 컴퓨터로 들어오는 모든 패킷의 내용을 도청할 수 있으며, 공격자를 추적 및 공격 유형 분석을 위한 패킷 분석 시에 활용할 수 있는 도구이다.
* tcpdump는 유닉스 계열에서 설치, 활용이 가능하며 윈도우 용으로는 windump가 있으며 활용 방법은 유사하다.
* tcpdump 옵션 [BPF]
  * -i : 인터페이스 정보 명시 ex) -i eth0
  * -nn : 출력 시 reverse lookup 수행하지 않는다. 즉, 출력 시 호스트명과 서비스명으로 변환하지 않고 IP와 Port 번호 형식으로 출력하라는 의미이다.
  * -v, -vv, -vvv : 패킷 헤더부까지 상세하게 출력한다.
  * -X, -XX : 패킷의 헤더부 출력과 함께 패킷데이터를 HEX-ASCII 포맷으로 출력한다.
  * -w : 출력할 파일명. 일반적으로 pcap 확장자 사용
  * -r : 읽어올 파일명
  * BPF는 Berkely Packet Filter를 말한다. 이는 대부분의 패킷 스니퍼 프로그램에서 지원하는 방식으로 원하는 패킷만을 스니핑하기 위한 룰을 지정하는 부분이다.
  * BPF 사용 예제
    * ```tcpdump -i eth1 -nn "tcp port 80"```
      * 80번 포트를 출바지 또는 목적지로 하는 tcp 패킷을 캡처한다.
      * 방향성을 지정하려면 src port, dst port와 같이 설정한다.
    * ```tcpdump -i eth1 -nn "tcp and host 192.168.197.1"```
      * 192.168.197.1 주소를 출발지 또는 목적지로 하는 tcp 패킷을 캡처한다. 
      * 방향성을 지정하려면 src host, dst host와 같이 설정한다.
    * ```tcpdump -i eth1 -nn "tcp and net 192.168.197.0 mask 255.255.255.0"```
      * 192.168.7.0/24 대역의 모든 패킷을 캡쳐한다. net 192.168.197.0/24와 같이 CIDR 표기법으로 명시해도 된다.
    * ```tcpdump -i eth1 -nn "tcp port 80 and host 192.168.197.1"```
      * 출발지 또는 목적지 주소가 192.168.197.1이고, 출발지 또는 목적지 포트가 80인 tcp 패킷을 캡처한다.
      * 논리연산을 위해 and, or, and not 등을 지원한다.
    * ```tcpdump -i eth0 -nn "tcp port 80 and not host 192.168.197.1"```
      * 출발지 또는 목적지 포트가 80이고 출발지 또는 목적지 주소가 192.168.197.1 이 아닌 패킷을 캡처한다.

      
        

### tracerout
* 종단 노드 사이에 있는 여러 중계 노드(L3장비/라우터) 각 구간에 대한 네트워크 상태를 관리하기 위한 명령어로 최종 목적지 노드에 도달하는데 경유하는 중계 노드(라우터)의 개수, IP 주소, 응답시간 등을 파악할 수 있다.
* 최초 IP 패킷의 TTL 필드값이 1인 UDP 패킷은 첫 번째 라우터에서 TTL이 감소하여 0으로 되고 해당 패킷이 폐기되었음을 알리는 ICMP Time Exceeded 메시지가 최초 출발지로 전송된다. 두 번째 TTL 필드값이 2인 .....

### 포트 스캐닝
* 공격자가 침입 전 대상 시스템에 어떤 포트(서비스)가 열려있는지 확인하는 작업으로 대상 서버의 동작 여부와 제공하는 서비스 등을 확인할 수 있다.
* TCP Half SCAN이 응답이 없으면 필터링되거나 방화벽으로 차단되는 것으로 판단한다.
* SYN Connect 스캔 (nmap -sT) : SYN 보냄. 포트가 닫혔을 때 RST/ACK 응답, 포트가 열린 경우 SYN/ACK 응답
* Decoy Scan(유인 스캔) : 스캔을 당하는 타겟 호스트에서 스캐너 주소를 식별하기 어렵게 하려고 실제 스캐너 주소 외에도 다양한 위조된 주소로 스캐하는 방식
* FIN SCAN (nmap -sF) : FIN 보냄. 포트가 열을 때 응답 X, 포트가 닫힌 경우 RST/ACK 응답
* XMAS SCAN (nmap -sX) : FIN, PSH, URG 보냄. 포트가 열렸을 때 응답 X, 포트가 닫힌 경우 RST/ACK 응답
* NULL SCAN (nmap -sN) : NULL 보냄. 포트가 열렸을 떄 응답 X, 포트가 닫힌 경우 RST/ACK 응답
* TCP Half SCAN (nmap -sS) : SYN 보냄. 포트가 열렸을 떄 SYN/ACK 패킷이 오면 수신하고 즉시 RST 패킷 보내어 연결 종료, 포트가 닫힌 경우 RST/ACK 응답
* TCP ACK SCAN (nmap -sA) : ACK 보냄. 방화벽 필터링 정책을 테스트하기 위한 스캔이다. RST 응답이 오면 방화벽 정책에 의해 허용되고, 응답이 없으면 방화벽 정책에 의해 차단되고 있는 것으로 판단한다.
* PING SCAN (nmap -sP) : ping 스캔(imcp, icmp echo 스캔)
* OS SCAN (nmap -O) : 대상 호스트의 운영체제 정보 출력
* (nmap -p) : 대상 호스트의 포트 지정
* (nmap -b hostname) : 호스트에 대한 FTP 바운스 스캔을 할 수 있다.

### 스니핑
* 랜카드를 무차별 모드(Promiscuous Mode)로 설정한 후 연결된 회신에 흐르는 모든 IP 패킷을 가로채는 공격을 말한다.
* 대표적으로 **스위치 재밍**, **SPAN 포트 태핑 등이 있다.

### 스푸핑
* 포트 주소, IP 주소, MAC 주소 등을 조작하여 네트워크 트래픽 흐름을 왜곡하고 시스템 권한 탈취 등의 행위를 수행하는 공격을 말한다.
* **ARP Spoofing**, **IP Spoofing**, **DNS SPoofing** 공격이 있다.

### 스누핑 
* 네트워크 트래픽상의 정보를 획득하는 공격 행위를 말한다.

### 도스/디도스
* 네트워크 대역을 고갈시키는 등의 공격을 말한다. 대표적으로 TCP SYN Flooding, HTTP Flooding, HTTP CC 등의 공격기법이 있다. 해당 공격이 발생하면 공격 대상 사이트의 서비스 가용성에 심각한 영향을 미친다.

### LAND Attack
* 출발지 IP와 목적지 IP가 동일한 공격이다.

### Fragment Overlap
* 공격자는 공격용 IP 패킷을 위해 두 개의 단편(Fragment)을 생성한다. 첫 번째 단편에서는 패킷 필터링 장비에서 허용하는 HTTP와 같은 포트 번호를 설정한다. 그리고 두 번째 포트 단편에서는 offset을 조작해서 재조합될 때 첫 번째 단편의 일부분을 덮어쓰여 공격자가 원하는 포트로 연결이 된다.

### Tiny Fragment
* 패킷 필터링 장비나 IDS는 필터링을 결정하기 위해 포트 번호를 확인하는데, 포트 번호가 포함되지 않을 정도로 아주 작게(Tiny) 쪼개진 첫 번째 단편을 그냥 통과시킨다. 실제 포트 번호가 포함된 두 번째 단편은 첫 번째 단편이 허용되었으므로 통과하여 공격자가 원하는 포트로 연결이 된다.

### Teardrop
* 공격자가 헤더가 조작된 일련의 IP 패킷 조각들을 전송함으로써 패킷을 재조합하는 과정에서 부하가 걸리게 하는 공격 방법이다.

### Ping Of Death
* 아주 크게 만든 ICMP 패킷을 전송함으로써 공격 네트워크에 도달하는 동안 아주 작은 조각이 되어 공격 대상 시스템이 조각화된 패킷을 모두 처리해야 함으로써 성능을 떨어뜨리는 공격이다.

### Smurf 
* 출발지 IP 주소를 공격대상의 IP 주소로 위조한 ICMP Echo Request 를 브로드캐스트하여 다수의 ICMP Echo Reply 패킷을 공격대상에게 전달되어 서비스 거부 상태 유발 공격
* **대응방법** : 자신의 네트워크로 들어오는 Directed Broadcast 패킷을 막도록 라우터 설정, IP Broadcast Address로 온 ICMP Request 패킷 응답 X

### DRDoS 공격
* 공격자가 출발지 IP를 공격 대상 IP로 위조하여 다수의 반사 서버(Reflector)로 요청정보를 전송하면 공격 대상은 반사 서버로부터 대량의 응답을 받아 서비스 거부 상태가 되는 공격 형태이다.

## DDoS 공격
* Attack : C&C 서버에 공격 명령을 실행하는 공격자 컴퓨터
* Target : 공격 대상 되는 피해 시스템
* C&C 서버(Master) : 공격자로부터 직접 공격 명령을 전달받는 시스템을 말하며 전달받은 명령은 관리하는 다수의 좀비 PC/Device에 전달
* 좀비 PC/Device(Slave) : C&C 서버로부터 전달받은 명려을 실행하여 공격 대상에 실제 공격을 수행하는 시템
### 트리누 (Trinoo)
* 미네소타 대학, 솔라리스 2.x에서 최초 발견
* UDP Flooding DDoS 공격을 유발하는 데 사용되었으며 Attacker, Master, Zombie로 공격 네트워크를 구성
* rpc.statd, rpc.cmds, rpc.ttdserverd 데몬의 취약점을 이용
* 접속 포트
  * Attack -> Master : 27665/tcp
  * Master -> Zombie : 27444/udp
  * Zombie -> Master : 31335/udp
  * Zombie -> Victim : udp 공격
#### Trino 공격 실습
* Master 데몬을 통한 공격
  1. telnet을 통한 Master 데몬 접속(27665/udp)
     * 원격 접속 시 패스워드 사용(password : betaalmostdone)
  2. bcast 명령 : Zombie PC 리스트 확인
  3. doc 공격 대상 IP 명령 : 공격 대상 IP로 공격 개시(192.168.8.11)
     * dos 192.168.8.11
  4. mdie killme : 공격 중지
   
### TFN (Tribe Flood Network)
* Trinoo처럼 rpc.statd, rpc.cmds, rpc.ttdserverd 데몬의 취약점을 이용
* Attacker가 Master에 명령 시 패스워드를 쓰지 않고 ICMP echo request 패킷에 명령어를 전송
* TCP, UDP, ICMP 등을 복합적으로 사용하여 TCP Syn Flooding, UDP Flooding, ICMP Flooding, Smurf 공격 수행

### Stacheldracht
* Trinoo와 TFN의 발전된 형태로 TCP Syn Flooding, UDP Flooding, ICMP Flooding, Smurf 공격 등을 수행
* Master에 새로운 Agent가 자동으로 갱신되는 특징이 있다.
* 접속 포트
  * Attack -> Master : 16660/tcp
  * Master -> Zombie : 65000/tcp
  * Zombie -> Master : ICMP Echo Reply
  * Zombie -> Victim : TCP Syn, UDP Flooding, ICMP Flooding, Smurf

### TFN2K
* TFN의 발전된 형태로 통신에 특정 포트가 사용되지 않고 암호화되어 있음
* TCP, UDP, ICMP 등을 복합적으로 사용하여 TCP Syn Flooding, UDP Flooding, ICMP Flooding, Smurf 공격 등을 수행
* UDP 패킷의 헤더는 정상적인 UDP 패킷보다 3byte 크고 TCP 패킷의 헤더 길이는 항상 0이다.

### P2P 봇넷
* 분산형 명령/제어 방식
* 참여 멤버(좀비/봇) 모두 C&C 역할을 하므로 별도의 도메인과 C&C 서버가 불필요하다.
* 대표적인 봇넷으로 Strom, Peacomm 등이 있다.

### DGA (Domain Generation Algorithm) 기법
* 새로운 C&C서버 도메인을 동적으로 다수 생성해 C&C 서버가 노출되는 것을 숨기는 기법으로 도메인 기반으로 탐지하는 보안장비를 우회하기 위한 목적
* 약속된 규칙 도메인명을 생성하기 때문에 C&C 서버를 운영하는 공격자는 해당 규칙에 따라 생성될 수 있는 도메인명 중 하나를 DNS 서버에 새롭게 등록하는 방식으로 운영

### HTTP Get Flooding
* 공격자가 동일한 동적 컨텐츠(/index.php)에 대한 HTTP GET 요청을 대량으로 발생시켜 공격 대상 웹서버가 해당 요청을 처리하기 위해 서버 자원을 과도하게 사용하도록 하여 정상적인 요청을 처리하지 못하도록 하는 서비스 거부 공격이다.

### Slow HTTP Header Dos 
* HTTP 프로토콜을 이용한 서비스 거부 공격으로 정상적인 HTTP 패킷의 헤더는 Carriage Return & Line Feed(개행문자)가 두 번 나타나지만, 해당 공격이 발생하면 헤더의 마지막에 개행문자를 하나만 전송하여 웹서버와의 다수 연결 상태를 장시간 지속시킴으로써 웹서버의 자원을 잠식하게 되는 공격
* 임계치를 설정하여 동일한 출발지 IP에서 동시 연결 개수 제한
* 클라와 웹서버 간 세션에 대한 연결 타임아웃을 설정한다.

### Slow HTTP POST DoS(RUDY)
* 다수의 HTTP POST 요청 시 Content-Length 헤더를 매우 크게 설정한 후 매우 작은 데이터를 천천히 지속해서 전송함으로써 웹서버와의 연결을 장시간 지속시켜 연결 자원을 모두 소진시키는 DoS 공격을 말한다.
* 임계치를 설정하여 동일한 출발지 IP에서 동시 연결 개수 제한
* 클라와 웹서버 간 세션에 대한 연결 타임아웃을 설정한다.

### Slow HTTP Read DoS
* 다수의 HTTP 요청에 대한 서버 응답에 대해 조작된 'TCP Zero Window 패킷'을 천천히 지속해서 전송하여 HTTP 응답 데이터 수신을 지연시킴으로써 웹서버와의 연결을 장시간 지속시켜 연결자원을 모두 소진시키는 형태의 DOS 공격을 말한다.
* 임계치를 설정하여 동일한 출발지 IP에서 동시 연결 개수 제한
* 클라와 웹서버 간 세션에 대한 연결 타임아웃을 설정한다.

### TCP SYN Flooding
* 정상적인 TCP 연결이라면 클라이언트로부터 SYN+ACK에 대한 ACK 응답을 받아 연결 설정이 완료되지만 'TCP SYN Flooding 공격'의 경우 공격자가 출발지 IP를 위조하여 다수의 요청을 발생시키고 위조된 출발지 주소이기 떄문에 SYN+ACK에 대한 정상 ACK 응답이 발생하지 않는다.
* 공격 대상 서버의 제한된 **Backlog Queue(연결요청대기큐)** 를 모두 소진시키는 형태의 공격이다.
* 따라서 netstat -an 명령을 수행하여 서버 측에서 다수의 SYN_RECV의 연결 설정 중인 소켓을 확인할 수 있다.
* TCP SYN Flooding 대응방안
  1. Backlog Queue(연결요청대기큐) 의 크기를 늘린다.
  2. 보안장비를 이용해 임계치 기반의 차단을 수행한다.
  3. TCP SYN Cookie 설정한다. -> ```sysctl -w net.ipv4.tcp_syncookies=1```

### ngrep 
* tcpdump/wirewhark 와 같이 패킷을 캡처하고 분석할 수 있는 도구이다. 일반적으로 Ascii 형식으로 패킷의 데이터를 보고자 할 때 유용하게 사용할 수 있다.
* -I : pcap 파일을 read
* -t : 타임스탬프를 출력
* -W byline : 패킷을 라인 단위로 출력한다.

### DNS 증폭 공격
* 악용하는 질의 방식으로 DNS Record 질의 타입을 ANY, TXT로 지정하면 요청한 도메인에 대한 모든 레코드 타입의 응답이 반환되기 때문에 응답이 증폭되는 효과가 있다.
* tcpdump 패킷을 보면 ID+ 형태는 질의 ID* 형태는 응답을 의미한다.
* 내부 사용자용 DNS 서버라면 내부 사용자 주소만 Recursive Query가 가능하도록 제한한다.
* 보안장비를 사용하여 특정 Byte 이상의 DNS 응답을 차단하거나 동일 출발지 IP에 대해 단위 시간당 요청개수 임계치 설정
* 이 기법을 사용하는 이유는 반사 공격이라 공격자를 찾기 쉽지 않고, 큰 크기를 보내 트래픽 효율성이 좋다.

### 멤캐시드 (Memcached)
* 오픈소스 메모리 캐싱 시스템(메모리를 사용해 캐시 서비스를 제공해주는 데몬)으로 11211/tcp 와 11211/udp 포트를 기본 포트로 사용한다.
* 별도의 인증과정 없이 접근을 허용해주기 때문에 공격자가 멤캐시드 서버 IP 주소의 기본 포트인 11211번 포트로 희생자의 IP 주소로 위조한 특정 명령(state, set/get 명령 등)의 UDP 패킷을 전송하면 멤캐시드 서버가 희생자 IP로 패킷보다 증폭된 패킷을 반사하게 된다.

### WSD (또는 WS-Discovery)
* 웹 서비스 디스커버리의 준말로 자동으로 장비를 검색해주는 기술이다.
* UDP 3702번 포트를 기반으로 한 멀티캐스트 통신을 사용한다.
* 윈도우 기반 기기들이 네트워크 프린터 등을 자동으로 찾아서 연결 설정을 완료하는데 사용되는 서비스로 내부 네트워크망에서 사용되지만, 인터넷망에 노출되면 디도스 공격으로 악용될 수 있다.
* **WSD 증폭/반사** 공격은 요청 시 악의적으로 XML 오류 응답 메시지를 반복적으로 유발하는 명령을 요청하고 위조된 피해자의 IP로 대규모의 증폭된 응답이 가게 만드는 공격기법이다.

### ARMS (Apple Remote Management Service)
* 애플 기기들의 원격제어 기능을 활성화할 때 사용되는 데스크톱 원격제어 프로토콜이다.
* TCP/UDP 3283번 포트를 사용한다.
* **ARMS 증폭/반사** 공격은 피해자 IP로 출발지 IP를 위조한 후 취약한 애플 MAC 컴퓨터를 대상으로 원격 접속 요청을 보내 증폭된 응답이 가게 만드는 공격기법이다.

### CoAP (Constrained Application Protocol)
* 불안정한 네트워크상의 저전력 IoT 기기들을 위한 일종의 애플리케이션 프로토콜로 주로 중국의 모바일 폰과 사물인터넷 장비들 사이에서 사용된다.
* uDP 5683번 포트를 사용한다.
* 피해자 IP로 스푸핑한 출발지 IP에서 외부 노출된 IoT 기기 및 모바일 장치들을 대상으로 변조된 Get Request를 보내 증폭된 응답이 가게 만드는 공격기법이다.

### WEP (Wired Equivalent Privacy)
* 랜덤하게 생성되는 24bit 초기벡터(IV)와 고정된 40Bit(WEP-40) 또는 104Bit(WEP-104)의 WEP 공유키를 조합하여 WEP 암호키를 생성한 후 RC4 암호 알고리즘을 기반으로 한 난수발생기에 입력하여 스트림 암호를 위한 키스트림을 생성한다.
* 평문의 무결성을 보장하기 위해 CRC-32 알고리즘을 이용하여 무결성 체크값(ICV)을 생성한 후 평문과 조합하여 키스트림과 XOR 연산을 수행, 암호문을 생성한다.
* 무선 AP와 무선 단말기 사이에 사전에 서로 동일하게 설정된 공유키를 이용하여 인증과 데이터 암호화 기능을 제공하지만, 해당 무선랜을 사용하는 모든 장비(무선 AP와 무선 단말기)가 하나의 고정된 공유키를 사용하기 때문에 외부에 노출될 가능성이 크며 이를 통해 많은 보안 문제가 발생할 수 있다.
*  암호 알고리즘 : RC4
* WEP 암호 방식의 문제점
  1. 짧은 길이의 초기벡터 사용으로 IV 값 재사용
  2. 불완전한 RC4 알고리즘 사용으로 인한 암호키 노출
  3. 짧은 길이의 암호키 사용으로 인한 공격
  4. 암호키 노출로 인한 무선 전송 데이터 노출
  
### WPA
* WEP와 동일한 RC4 알고리즘을 기반으로 하며 48bit 확장된 IV를 사용하는 TKIP 암호화 방식을 사용한다.
* 암호 알고리즘 : RC4-TKIP

### WPA 2
* WPA와 키 관리의 유사성을 가지고 있지만 AES 기반의 128bit 대칭키를 사용하고 블록암호모드로 CCM 모드를 사용하는 CCMP 암호화 방식을 사용한다.
* EAP (Extensible Authentication Protocol) : 다양한 종류의 인증방식을 캡슐화해서 전송하는 역할을 하는 인증 프로토콜이다.
* 암호 알고리즘 : AES-CCMP

### SSID (Service Set Identifier)
* 무선랜을 구분하기 위한 32byte 이름으로 서로 다른 무선랜을 식별하기 위한 용도로 사용한다.
* 무선 장비에서 Wi-Fi를 활성화했을 때 나오는 무선랜 목록이 바로 SSID를 의미한다.
* 보안상의 목적으로 무선랜 접속을 제한하기 위해 와이파이 공유기에 설정하는 옵션으로 "SSID 브로드캐스트를 사용하지 않도록(disable)" 설정한다.

### NAT (Network Address Translation)
* 내부 네트워크에서 사용하는 사설IP(Private IP)와 인터넷에서 사용하는 공인 IP(Public IP) 간의 변환 기술을 말한다.
* 부족한 공인 IP를 절약할 수 있고, 외부에서 사설 IP를 사용하는 내부 호스트로 직접 접근이 불가능하므로 내부 네트워크(사설망)를 보호할 수 있는 보안상의 장점이 있다.
### 워 드라이빙
* 무선랜 해킹과 관련하여 해커가 무선 네트워크를 찾기 위해 무선 장치를 가지고 주위의 AP를 찾는 것
* 임의의 번호를 추출해 원하는 모뎀을 찾아냄으로써 컴퓨터에 대한 해킹을 시도하는 것이다.

### SSL / TLS
* 넷스케이프사가 처음으로 만들었으며 이 프로토콜은 신뢰할 수 있는 종단-대-종단의 안전한 서비스를 제공하기 위해 TCP를 이용하도록 설계하였으며, 인증 및 암호화 기능을 제공한다. 웹 브라우저와 웹서버 간에 서로 상대의 신원을 확인하는 기능이 있다.
* 443/tcp 포트를 사용한다.
* 인터펫기술표준화기구(IETF)에서 SSL을 기반으로 표준화한 TLS가 있으며, 무선환경에서는 WTLS가 사용된다.
* TLS 1.3 버전에서 강화된 보안과 빨라진 성능을 특징으로 하고 있다.
  * TLS 1.2 이하 버전에서는 최초 세션 연결 시 2-RTT를 거쳐야 했으나 TLS 1.3에서는 이과정을 1-RTT로 단축하여 성능 향상
  * 세션 재연결 시에도 TLS 1.2 이하 버전에서는 1-RTT을 거쳐야 했으나 TLS 1.3에서는 공유된 암호키를 로컬에 저장하여 바로 요청 메시지에 해당 키를 사용하는 방식의 0-RTT를 지원한다.
* SSL/TLS 취약성 이용한 공격
  * BEAST (Browser Exploit Against SSL?TLS) 공격 : 사용자 브라우저의 취약점을 이용하여 HTTPS 쿠키를 훔쳐서 HTTPS 세션을 가로챌 수 있는 공격
  * CRIME (Compression Ration Info-Mass Exploitation) 공격 : HTTPS의 압축에 따른 취약점을 이용하여 HTTPS 쿠키를 훔쳐서 HTTPS 세션을 가로챌 수 있는 공격
* Handshake 프로토콜 : 종단 간에 보안 파라미터를 협상하기 위한 프로토콜
  1. 협상 단계
  2. 서버 인증 및 키 교환
  3. 클라이언트 인증 및 키 교환
  4. 협상한 보안 파라미터를 적용하여 메시지 교환
* Change cipher spec 프로토콜 : 협상한 보안 파라미터를 이후부터 적용함을 알리기 위한 프로토콜
* Alert 프로토콜 : 통신 과정에서 발생하는 오류를 통보하기 위한 프로토콜
* Application Data 프로토콜 : 응용 계층의 데이터를 전달하기 위한 프로토콜
* Record 프로토콜 : 상위 계층 프로토콜 데이터의 전달 및 적용된 보안 파라미터를 이용하여 애플리케이션 데이터에 대한 단편화 및 재조합, 암호화 및 복호화, 압축 및 압축해제, 메시지 인증 코드(MAC) 생성 및 검증 등을 제공하는 프로토콜
  1. 단편화 : 애플리케이션 데이터를 일정 크기로 단편화한다.
  2. 압축 : 단편화된 데이터를 압축 알고리즘으로 압축한다.
  3. MAC : MAC 값을 계산하여 추가한다.
  4. 암호화 : 압축된 데이터와 MAC 값을 암호 알고리즘으로 암호화한 후 Record 헤더를 추가하여 전송한다.

### SSH (Secure Sheel)
* 인터넷에서 원격으로 호스트를 관리하는 안전한 암호통신 터미널 프로그램
* 한 컴퓨터에서 다른 컴퓨터로 파일을 옮김
* 안전하지 않은 채널 사이의 강력한 인증기능 제공
* rlogin, rsh, telnet, ftp와 같은 프로그램을 안전하게 대체
* 22번 포트를 사용한다.

### 라우터
* Unicast RPF (Receive Path Forwarding) 패킷 필터링 기법
  * 라우팅 테이블을 확인하여 출발지 주소, 목적지 주소가 있는지 확인하여 차단한다.
* 정적/동적 라우팅 개념
  * 정적 라우팅 : 관리자가 직접 라우팅 테이블을 설정하는 방식으로 관리자가 설정해준 경로로만 전달되기 때문에 정확하고 라우터 간의 정보 교환이 필요하지 않아 트래픽 낭비를 막을 수 있지만 규모가 큰 네트워크의 경우 관리의 어려움이 있다.
  * 동적 라우팅 : 라우팅 프로토콜을 이용하여 자동으로 경로를 탐색하고 패킷을 전달하는 방법으로 프로토콜 설정만 해주면 관리자가 일일이 경로를 설정해야 하는 수고를 덜 수 있다.
* 라우팅 프로토콜 분류
  * IGP (interior Gateway Protocol) : 자율 시스템(AS) 내부에서 사용하는 라우팅 프로토콜, 자율 시스템은 조직/기관 내부에서 직접 관리하는 라우터 집합을 말한다.
    * 거리 벡터 : RIP, RIPv2, IGRP
    * 링크 상태 : IS-IS, OSPF
    * 하이브리드 : EIGRP
  * EGP (Exterior Gateway Protocol) : 자율 시스템 간에 사용하는 라우팅 프로토콜
    * 경로 벡터 : BGP 
* Ingress 필터링 : Standard 또는 Extended Access-List를 활용하여 라우터 내부로 즉, 사내 네트워크로 유입되는 패킷의 출발지 IP 주소를 점검하여 허용 또는 거부하도록 하는 것이다.
* Egress 필터링 : 내부에서 라우터 외부로 나가는 패킷의 출발지 IP 주소를 검사하여 허용 또는 거부하도록 하는 것이다.
* 블랙홀 필터링 : 특정한 목적지 IP 주소 또는 IP 주소 대역에 대해서 null이라는 가상의 인터페이스로 보내도록 함으로써 패킷의 통신이 되지 않도록 하는 것이다.
* access-list rule
  * access-liust acl번호 [permit(허용) 또는 deny(차단)] 프로토콜 출발지 [출발지-wildcard] 목적지 [목적지-wildcard] [목적지 포트]
  * (예시 1) access-list 150 deny tcp 192.168.1.0 0.0.0.255 host 100.100.100.1 eq 80
    * 출발지 IP가 192.168.1.0/24 대역이고 목적지 IP가 100.100.100.1(특정 IP 지정 시 host 키워드 명시)이고 목적지 포트가 80(eq는 equal)인 TCP 패킷에 대해 모두 차단한다.
    * 모든 IP 주소를 명시할 경우 any 키워드 사용
  * (예시 2) access-list 150 deny udp host 192.168.2.5 100.100.100.0 0.0.0.255 range 100 200
    * 출발지 IP가 192.168.2.5이고 목적지 IP가 100.100.100.0/24 대역이고 목적지 목적지 포트가 100~200(range를 통해 포트 범위 지정)인 UDP 패킷에 대해 모두 차단한다.
  * (예시 3) (config) ip route 211.1.1.1 255.255.255.255 Null 0
    * Null 0 이라는 가상의 인터페이스로 211.1.1.1을 목적지로 하는 IP 패킷을 보낸다(블랙홀 필터링).
    * 단점이 있는데 Null 인터페이스로 보내질 때마다 최초 출발지로 패킷 차단에 따른 ICMP Unreachable 메시지를 발송하게 되는데, 만약 필터링하는 패킷이 많으면 라우터에 과부하를 유발할 수 있다. 이를 위해서 (config-if) # no ip unreachables
* Cisco IOS
  * en(enable) -> Privileged Mode 로 진입
  * enable secret "패스워드" -> Privileged Mode로 진입할 때 패스워드 설정
  * snmp-server community [String] ro 50 -> snmp-server를 활성화 하고 community string을 String으로 설정하고 read only ACL 50번을 적용
    * communiy String은 snmp-server 와 클라이언트가 데이터를 교환하기 전에 인증을 위해 사용하는 일종의 패스워드로, 초기값으로 public, private 설정되어 있다.
  * conf t(config terminal) -> config 모드 진입
  * int (인터페이스) -> 인터페이스 설정
  * ip access-group 150 in -> 인바운드에 150번 규칙 트래픽에 적용
  * logging on -> 로그 기능 활성화
  * logging trap debugging -> 로깅 수준을 디버깅 설정
  * logging 192.168.10.13. -> 로그를 남길 원격지 로그 서버의 IP를 192.168.10.13
  * line vty 0 : vty(virtual terminal) 포트는 원격지에서 텔넷 등을 접속하는 가상 터미널 포트
  * config terminal ->[config] no snmp-server (SNMP 서비스를 비활성화)
  * config terminal ->[config] interface FastEthernet 0/0 ->[config-if] no IP directed-broadcast (directed broadcast를 거부한다. 스머프, 여러 증폭/반사 를 방어)
  * access-list 100 permit udp 192.168.1.0 0.0.0.255 any -> 출발지 192.168.1.0/24 에서 오는 udp 패킷을 허용하고 acl 100번 저장
  * interface FastEthernet 0/0
  * ip directed-broadcast 100 -> 해당 인터페이스에 ip directed-broadcast 적용
  * access-list 100 permit tcp 192.168.1.0 0.0.0.255 any eq 23 -> 23번 Telnet 에 192.168.1.0/24 대역에 오면 허용해주고 acl 100번 저장
  * access-list 100 permit udp host 192.168.2.5 any range 100 150
  * access-list 100 permit tcp any any eq 80
  * access-list 100 permit udp any any eq 53
  * access-list 100 permit tcp any any eq 53
  * access-list 100 deny ip any any
  * interface Serial 0
  * ip access-group 100 in
  * Access-List를 작성할 때 Permit을 항상 매 아래에 둔다.
  * service password-encryption -> 패스워드 암호화 활성화
  * enable secret -> 패스워드를 암호화해서 저장하기 위한 설정
  * enable password -> 패스워드를 평문으로 저장하기 위한 설정
  * conf t -> configuration terminal 설정
  * enable secret dkfrltk12#$ -> dkfrltk12#$ 로 패스워드 설정
  * logging on -> 로그 서비스 활성화
  * logging 192.168.0.10 -> 원격 로그 서버 192.168.0.10 지정정

### 네트워크 통신 스니핑을 탐지할 수 있는 다양한 방법
#### ICMP 스니핑을 탐지 방법 (PING)
* 의심스러운 호스트에 해당 네트워크에 존재하지 않는 MAC 주소로 위조한 ping(ICMP Echo Request 메시지)을 보내면 다음과 같은 결과를 확인할 수 있다.
* ICMP Echo Reply가 오는 경우 : 이 경우는 해당 호스트가 스니핑을 하는 것이다. 왜냐하면 존재하지 않는 MAC 주소로 ping을 했는데 무차별 모드로 스니핑을 하고 있지 않다면 이 요청을 볼 수 없기 때문이다.
* ICMP Echo Reply가 오지 않는 경우 : 이 경우는 해당 호스트가 요청 패킷을 정상적으로 폐기한 것이므로 스니핑을 하지 않는 정상적인 호스트이다.

#### ARP 스니핑 탐지 방법 
* ping과 유사한 방법으로 존재하지 않는 MAC 주소로 위조된 non-broadcast ARP Request를 보냈을 때 ARP Response가 오면 상대방 호스트가 무차별 모드로 설정되어 스니핑하고 있음을 확인할 수 있다.

#### DNS 스니핑 탐지 방법
* 일반적으로 스니핑 프로그램은 사용자의 편의를 위해 스니핑한 시스템의 IP 주소를 inverse(reverse) dns lookup을 수행한다. 따라서 대상 네트워크에 ping sweep을 보내고 들어오는 inverse lookup 패킷을 감사하여 스니퍼를 탐지한다. ping sweep은 해당 네트워크의 모든 호스트에게 ping을 날리는 방식을 의미한다. 

#### 유인(Decoy)을 이용한 방법
* 스니핑 공격의 주요 목적은 계정과 패스워드를 획득하는 것이다. 따라서 보안관리자는 가짜 계정과 패스워드를 네트워크에 계속 뿌린다. 공격자는 이 계정을 이용해 접속을 시도하는 시스템을 탐지함으로써 스니퍼를 탐지한다.

#### ARP watch
* 초기 MAC 주소와 IP 주소의 매칭값을 저장하고 ARP 트래픽을 모니터링하여 변화가 있는 ARP 패킷을 탐지하는 도구이다. 대부분의 스니핑 공격기법이 ARP Spoofing을 사용하기 떄문에 이를 탐지할 수 있다.

### CIDR (Classless InterDomain Routing)
* 기존의 클래스(A, B, C, D) 기반 주소 체계를 대체하여 클래스 구분 없이 IPv4 전체 bit에 대해 네트워크 ID 와 호스트 ID를 설정하는 주소 할당 방식이다.

### TCP 프로토콜
* 연결 설정 3-way handshake
  1. SYN 을 보낸다. (seq.Num =0, ack.Num)
  2. SYN+ACK 을 보낸다. (seq.Num=3, ack.Num=1)
  3. ACK 을 보낸다. (seq.Num=1, ack.Num=4)
* 연결 종료 4-way handshake
  1. ACK+FIN 을 보낸다. (seq.Num=1234, ACK.Num=6789)
  2. ACK 을 보낸다. (seq.Num=6789, ack.Num=1235)
  3. ACK+FIN 을 보낸다. (seq.Num=6789, ack.Num=1235)
  4. ACK 을 보낸다. (seq.Num=1235, ack.Num=6790 
* 제어 플래그
  * SYN : 연결 설정
  * FIN : 연결 종료
  * RST : 연결 중단
  * ACK : 정상 수신 응답
  * URG : 긴급 데이터로 설정하여 순서와 상관없이 긴급 처리
  * PSH : 수신 버퍼의 데이터를 상위 계층으로 즉시 전달

### TCP Syn Cookie
* TCP 표준에 명시된 클라이언트의 유효성을 확인하기 위한(클라이언트를 인증하기 위한) 기술이다.
* 클라이언트 SYN 요청에 대한 응답으로 SYN+ACK를 전송할 때 Sequence Number 필드에 ISN(Initial Sequence Number) 대신 알고리즘을 통해 생성한 Cookie 값을 설정하여 전송한다. 정상적인 클라이언트라면 SYN+ACK에 대한 응답에 Cookie +1 값을 Acknowledgment Number 필드에 설정하여 응답하게 된다. 응답에 포함된 Cookie 값을 검증하여 정상적인 클라이언트인지 판단하게 된다.
* 클라이언트의 유효성이 확인될 때까지 서버 측에서 'Backlog Queue(연결요청대기큐)'에 연결요청 정보를 저장하지 않기 때문에 TCP SYN Flooding 공격에 효과적으로 대응할 수 있다.
* 서버에 직접 TCP SYN Cookie 기능을 활성화하면 Cookie 생성 및 검증에 대한 부하가 크기 때문에 서버 앞단에 있는 별도의 장비(디도스 대응 장비, L4-Switch 등)를 이용하여 적용하는 경우가 일반적이다.
* SYN Cookie 생성 알고리즘 : 일반적으로 Local IP, Local Port, Foreign IP, Foreign Port, Timestamp 등 동일 클라이언트의 요청 여부를 식별할 수 있는 값을 조합 및 해시하여 32bit 해시값을 생성, SYN Cookie 값으로 사용한다.

* 유닉스/리눅스 Syn Cookie 커널 파라미터 설정하기(0: 미설정, 1: 설정)
  1. ```sysctl -w net.ipv4.tcp_syncookies=1```
  2. ```echo 1> /proc/sys/net/ipv4/tcp_syncookies``` 

### TCP/IP 커널 파라미터 보안 설정
#### 1) 개요
* sysctl 명령은 리눅스 커널 파라미터를 확인하거나 설정할 때 사용하는 명령어로 사용 방법은 다음과 같다.
  * 파라미터 확인 : ```sysctl -n <parameter>```를 통해 특정 파라미터를 확인하거나 ```sysctl -a``` 명령을 통해 현재 모든 커널 파라미터를 확인할 수 있다.
  * 파라미터 설정 : ```sysctl -w <parameter>=<value>```
* ndd 명령은 유닉스(솔라리스)의 네트워크 관련 커널 파라미터를 확인하거나 설정할 때 사용하는 명령어로 사용 방법은 다음과 같다.
  * 파라미터 확인 : ```ndd /dev/<driver> <parameter>```
  * 파라미터 설정 : ```ndd -set /dev/<driver> <parameter> <value>```
  * TCP/IP 커널에 대하여 <driver>는 ARP, IP, TCP, UDP가 해당한다.
#### 2) 스머프 공격 대응 설정
1. 개요
  * 스머프 공격은 출발지 IP를 공격대상 IP로 위조한 후 증폭 네트워크로 ICMP Echo Request 메시지를 브로드캐스트함으로써 대량의 ICMP Echo Reply 메시지가 공격대상에게 전달되어 서비스 거부를 유발시키는 공격기법을 말한다.
2. 공격 대응 방안
  * 증폭 네트워크로 사용되는 것을 막기 위해 **다른 네트워크로부터 자신의 네트워크로 들어오는 directed broadcast 패킷을 허용하지 않도록 라우터 설정**을 한다.
  * **브로드캐스트 주소로 전송된 ICMP Echo Request 메시지에 대해 응답하지 않도록 시스템 설정**을한다.
3. 리눅스 시스템 설정
  * ```sysctl -w net.ipv4.icmp_echo_ignore_broadcasts=1``` : 브로드캐스트 주소로 전송된 ICMP Echo Request 메시지 수신 시 이를 무시한다(1은 true를 의미).
4. 유닉스 시스템 설정
  * ```ndd -set /dev/ip ip_respond_to_echo_broadcast 0``` : 브로드캐스트 주소로 전송된 ICMP Echo Request 메시지 수신 시 응답하지 않는다(0은 false를 의미).
  * ```ndd -set /dev/ip ip_forward_directed_broadcast 0``` : directed broadcasts IP 패킷을 포워딩하지 않는다(0은 false를 의미).
#### 3) TCP SYN Flooding 공격 대응 설정
1. 개요
  * TCP SYN Flooding 공격은 출발지 IP 주소를 위조한(IP Spoofing) 다수의 SYN 패킷을 공격 대상 호스트로 전송하여 공격 대상 호스트의 TCP 연결 자원(Backlog Queue)을 모두 소진시켜 서비스 거부 상태를 유발시키는 공격을 말한다.
2. 공격 대응 방안
  * **시스템 설정을 통해 Backlog Queue(연결요청대기큐)의 크기를 늘린다.** Backlog Queue는 제한된 시스템 자원으로 무한정 크게 늘릴 수 없는 한계가 있다.
  * **보안장비(디도스 대응 장비, 방화벽 등)를 이용한 임계치 기반의 차단**을 수행한다.
  * **First SYN Drop 기능**을 이용한다.
  * **TCP SYN Cookie 기능**을 이용한다. TCP SYN Cookie 기능은 TCP 클라이언트의 유효성을 확인하기 위한 기능으로 클라이언트의 유효성이 확인될 때까지 서버 측에서 Backlog Queue에 연결요청 정보를 저장하지 않는 특성을 이용한 방어 기법이다.
3. 리눅스 시스템 설정
  * ```sysctl -w net.ipv4.tcp_max_syn_backlog=1024``` : TCP Backlog Queue의 크기를 늘린다(예, 1024)
  * ```sysctl -w net.ipv4.tcp_syncookies=1``` : TCP SYN Cookie 기능을 활성화한다(1은 true를 의미).
4. 유닉스(Solaris) 시스템 설정
  * ```ndd -set /dev/tcp tcp_conn_req_max_q0 1024``` : TCP Backlog Queue의 크기를 늘린다(예, 1024)

#### 4) ICMP Redirect 공격 대응 설정
1. 개요
  * ICMP Redirect 공격은 ICMP Redirect 메시지를 공격자가 원하는 형태로 만들어 특정 목적지로 가는 패킷을 공격자가 스니핑하는 기법이다.
2. 공격 대응 방안
  * ICMP Redirect 메시지 수신 시 이를 무시하고, ICMP Redirect 메시지를 전송하지 않도록 시스템(커널 파라미터) 설정을 한다.
3. 리눅스 시스템 설정
  * ```sysctl -w net.ipv4.conf.all.accept_redirects=0``` : ICMP Redirect 메시지 수신 시 라우팅 테이블 변경을 허용하지 않는다(0은 false를 의미).
  * ```sysctl -w net.ipv4.conf.default.send_redirect=0``` : ICMP Redirect 메시지를 전송하지 않는다(0은 false를 의미).
4. 유닉스(Solaris) 시스템 설정
  * ```ndd -set /dev/ip ip_ignore_redirect 1``` : ICMP Redirect 메시지 수신 시 라우팅 테이블을 변경하지 않고 무시한다(1은 true를 의미).
  * ```ndd -set /dev/ip ip_send_redirects 0``` : ICMP Redirect 메시지를 전송하지 않는다(0은 false를 의미).

#### 5) IP Source Routing 기능 비활성화
1. 개요
  * IP Source Routing 기능은 IP 옵션 헤더를 이용하여 호스트나 라우터에 설정된 라우팅 경로를 이용하지 않고 출발지에서 직접 경로를 지정하는 방식으로 외부에서 직접 접근이 불가능한 내부 시스템에 우회하여 접근할 수 있는 보안상 문제점이 있다.
2. 공격 대응 방안
  * IP Source Routing 기능을 이용하는 IP 패킷 수신 시 이를 허용하지 않도록 시스템(커널 파라미터) 설정을 한다.
3. 리눅스 시스템 설정
  * ```sysctl -w net.ipv4.conf.all.accept_source_route=0``` : 소스 라우팅 IP 패킷 수신 시 이를 허용하지 않는다(0은 false를 의미).
4. 유닉스(Solaris) 시스템 설정
  * ```ndd -set /dev/ip ip_forward_src_routed 0``` : 소스 라우팅 IP 패킷 수신 시 이를 포워딩 하지 않는다(0은 flase를 의미).
5. 라우터 설정
  * ```no ip source-route```

#### 6) IP Forwarding 기능 비활성화 설정
1. 개요
  * IP Forwarding 기능은 호스트가 라우터처럼 동작하여 자신이 목적지가 아닌 IP 패킷에 대해 라우팅 테이블을 참조하여 해당 목적지로 전송해주는 기능을 말한다.
  * IP Forwarding 기능이 설정되어 있으면 이를 악용하여 다른 서버로 패킷 전송이 가능하므로 라우터 역할을 하는 서버가 아니라면 IP Forwarding 기능을 비활성화하도록 시스템(커널 파라미터) 설정을 한다.
2. 리눅스 시스템 설정
  * ```sysctl -w net.ipv4.ip_forward=0``` : IP 포워딩 기능을 비활성화한다(0은 false를 의미).
3. 유닉스 시스템 설정
  * ```ndd -set /dev/ip ip_forwarding 0``` : IP 포워딩 기능을 비활성화한다(0은 false를 의미).

### 안전한 무선랜 구축을 위해 무선 AP에 적용할 보안 설정
1. 무선 AP의 도난 및 공격자의 접근으로부터 보호할 수 있도록 보호 케이스 설치, AP 리셋 버튼 차단 등 **물리적 보안대책**을 확보한다.
2. 무선 AP 관리자 모드 **접속 비밀번호를 설정**하고 주기적으로 변경하여 공격자가 AP 관리자 모드로 접속하는 것을 방지한다.
3. **SSID를 초기 설정값이 아닌 새로운 값으로 변경**하여 공격자가 쉽게 인지하지 못하도록 한다.
4. **SSID를 브로드캐스트하지 않고 숨김 모드로 설정**하여 공격자에게 노출되는 것을 최소화한다.
5. 공격자의 접속 방지 및 무선 구간에서의 데이터 기밀성과 무결성을 유지하기 위해 무선 AP에서 제공하는 **안전한 인증 및 암호화 방식을 적용**한다.
6. 무선 AP 접속을 허용할 무선 단말기 리스트를 등록하여(**MAC 필터링**) 임의 사용자 접근 차단.

### 무선랜 보안
#### MAC 기반 필터링
* MAC 주소를 구성하는 48비트(6바이트) 크게 두 부분으로 구성된다. 처음 3바이트는 제조사 식별자, 뒤에 3바이트는 제조사 부여 일련번호
* MAC Address Filtering : 무선랜 접속을 허용할 단말의 MAC 주소를 무선 AP에 사전 등록하여 인증
  * 장점 : 접근 제어 방식이 간단하고 기본적인 공격을 효과적으로 방어
  * 단점 : 정상 단말의 MAC 주소를 획득하면 쉽게 무력화
* MAC Address FIltering 보안 기능 우회 : 정상 사용자와 무선 AP 간의 트래픽을 분석하여 MAC 주소 획득하여 무선 AP 접속

### HTTP, Telnet
* HTTP를 사용하지 않고 HTTPS를 사용하고, Telnet을 사용하지 않고 SSH를 사용을 권장한다. 이유는 평문으로 통신을 하기 때문에 MITM(중간자 공격에)취약하다.
* HTTPS, SSH 는 암호화 하여 통신을 하기 때문에 기밀성을 보장

### promiscuous mode
* 무차별 모드로 목적지 주소와 무관하게 모든 패킷을 수신하는 동작 모드이다.
* ifconfig로 해결하려면 ```ifconfig eth0 -promisc``` 명령어를 주면 된다.
* 스니핑 모드를 로그를 보려면 /var/log/messages 를 확인하여 발생 시점을 찾는다.

### iptables
* ```iptables -A INPUT -p TCP --dport 80 --syn -m limit --limit 10/s -j ACCEPT``` 목적지 포트가 80번인 syn에 대해 1초에 10번 허용하고 이를 초과하면 차단
* ```iptables -A INPUT -p TCP --dport 80 --syn -j DROP```

### WPA 해킹
* ```airodump-ng -c 3 --bassid 00:18:E7:CC:C8:CF -w wpa mon0``` --bassid 00\:18\:E7\:CC\:C8\:CF 은 타겟 AP 주소
* ```aireplay-ng -0 1 -a 00:18:E7:CC:C8:CF -c BB:53:2E:01:03:04 mon0``` -c BB\:53\:2E\:01\:03\:04 은 타겟 AP 에 연결된 스테이션
* ```aircrack-ng -w pw.lst -b 00:18:E7:CC:C8:CF *.cap``` -w pw.lst 는 패스워드 크래킹 위한 사전 파일 -b 00\:18\:E7\:CC\:C8\:CF 는 타겟 AP의 맥주소

## 어플리케이션 보안
### DNS
* 도메인 이름과 IP를 변환하여 주는 거대한 분산 데이터베이스(네이밍) 시스템으로 해당 도메인에 대한 정보는 위임받은 서버의 Zone 파일에 저장된다.
* DNS 서비스는 53번 포트를 사용하고 tcp/udp 프로토콜을 사용하며 DNS 서버에 빈번하게 반복적인 질의를 요청하여 부하가 발생하는 것을 막기 위해 Cache를 사용하고 그 유효기간을 TTL이라고 한다.
* Cache DNS 서버 : DNS 질의에 응답 결과를 캐시에 일정 시간 저장하고 있다가 같은 DNS 질의가 오면 저장해 둔 정보를 이용하여 응답
* Authoritative DNS 서버 : 관리하는 도메인에 대해서만 응답해주는 DNS 서버
* /etc/named.conf -> version "unknown" : DNS 서버 설정 파일에서 버전 정보를 보여주지 않기 위해 설정
```
zone "관리 도메인 이름" IN {
  type master; // 마스터 네임서버 타입으로 지정
  file "도메인 이름.zone"; 도메인 존 파일 지정
  allow-transfer {IP}; 슬레이브 네임서버 IP를 설정하여 존 전송 허용
}
```
* 존 정보 : 해당 DNS 서버가 위임받은 도메인에 대한 리소스 레코드 정보를 말한다.
  * allow-transfer {IP} 옵션을 named.conf 설정파일에 추가하면 존 전송을 허용
```
named.conf 파일 설정
master 설정
zon "algisa.com" IN{
  type:단
User-agent: Googlebot-image
Disallow: /admin/
Disallow: /*.pdf$
```

## 침해사고 분석 및 대응
### 침입 탐지 시스템 (IDS : Instruction Detection System)
#### (1) 개요
1. 침입탐지시스템(IDS)은 사전에 등록한 알려진 공격 패턴, 임계치 등을 기반으로 공격 행위를 탐지하는 보안장비를 말한다.
2. 방화벽 장비와의 차이점을 살펴보면 방화벽은 프로토콜, IP 주소, Port 번호 등을 이용하여 정해진 정책에 따라 패킷 필터링을 수행하는 '차단 장비'이지만 침입탐지시스템은 패킷의 컨텐츠나 시스템 로그 등을 분석하여 악의적인 공격여부를 판단하는 '탐지 장비'이다.
3. 침입 탐지 방식에 따라 오용 탐지(false negative) 방식과 이상 탐지(false positive) 방식으로 구분할 수 있다.
4. 탐지할 데이터 수집원에 따라 호스트 기반(HIDS)와 네트워크 기반(NIDS)로 구분할 수 있다.
5. 탐지 장비들의 공격 행위 탐지 결과는 정탐 뿐만 아니라 오탐 및 미탐이 발생할 수 있다. 탐지 결과의 심각성 관점에서 볼 때 오탐보다 미탐이 더 심각한 상황이므로 미탐을 줄이는 것이 매우 중요하다.
  * 정탐(true positive) : 공격 행위를 정확히 탐지
  * 오탐(false positive) : 공격 행위가 아닌 것을 공격 행위로 탐지하는 판정 오류
  * 미탐(false negative) : 공격 행위를 탐지하지 못하는 판정 오류

#### (2) 침입 탐지 방식에 의한 분류
1. 오용 탐지
   * 사전에 등록한 알려진 공격 패턴을 기반으로 공격 행위를 탐지하는 방식으로 지식 기반 탐지 또는 시그니처 기반 탐지라고도 한다.
   * 알려진 공격 패턴을 기반으로 탐지하기 때문에 지속적인 공격 패턴 업데이트가 매우 중요하다.
   * 장단점으로 알려진 공격 패턴을 기반으로 탐지하므로 상대적으로 오탐률이 낮은 장점이 있지만 새로운 공격에 대해서는 탐지할 수 없으므로 미탐률이 높다.
2. 이상 탐지
   * 정량적이고 평균적인 상태를 기준으로 이를 벗어난 행위를 공격 행위로 탐지하는 방식으로 행위 기반 탐지 또는 통계 기반 탐지라고도 한다.
   * 정략적이고 통계적인 분석을 통해 측정한 정상 행위와 비정상 행위를 구분할 수 있는 임계치를 기반으로 탐지하는 방식
   * 장단점으로 알려지지 않은 새로운 공격도 탐지할 수 있으므로 상대적으로 미탐률이 낮은 장점이 있지만 정상 행위와 비정상 행위를 구분하는 임계치 설정의 어려움으로 인하여 상대적으로 오탐률이 높은 단점이 있다.

#### (3) 탐지할 데이터 수집원에 의한 분류
1. 호스트 기반 IDS
   * 호스트에 설치되어 호스트 정보를 수집하여 탐지활동을 수행하는 IDS를 말한다.
   * 대표적인 오픈소스 HIDS로 '트립와이어'가 있다. 트립와이어는 호스트 파일 시스템의 파일 무결성을 점검하는 도구로 사용된다.
   * HIDS의 경우 다음과 같이 세분화할 수 있다.
     * 단일 호스트 기반 : 단일 호스트로부터 정보 수집 탐지
     * 다중 호스트 기반 : 여러 호스트로부터 정보 수집 탐지
2. 네트워크 기반 IDS
   * 네트워크 트래픽을 수집하여 탐지 활동을 수행하는 IDS를 말한다.
   * 대표적인 오픈소스 NIDS '스노트'와 스노트의 단점을 보완한 '수리타카'가 있다.
   * 수리카타 : OISF 단체에서 오픈소스 프로젝트로 개발한 IDS/IPS로 2010년 발표하였다. 기존 스노트의 단일 스레드 방식을 개선하여 대용량 트래픽을 실시간으로 처리할 수 있도록 멀티 코어/멀티 스레드를 지원하며 기존 스노트와도 완벽하게 호환하는 장점
   * NIDS는 주로 미러링 모드를 설치한다. 그 이유는 실제 트래픽에 대한 실시간 차단이 아닌 탐지 목적의 장비이기 때문에 일반적으로 물리적 네트워크 구성 변경이 불필요하고 전체 네트워크 가용성에 영향을 주지 않으면서 복제된 트래픽을 이용하여 탐지 활동을 수행할 수 있는 미러링 모드로 설치한다.

### 침입 차단 시스템 (IPS : Instruction Prevention System)
#### (1) 개요
* 침입차단시스템(IPS)은 사전에 등록한 알려진 공격 패턴, 임계치 등을 기반으로 공격 행위를 탐지하고 실시간 차단까지 수행하는 보안장비를 말한다.
* 공격 행위 탐지 후 통보라는 수동적인 방어 개념의 침입탐지시스템(IDS)과 달리 공격 행위가 탐지되면 이를 능동적으로 차단하는 보안장비이다.
* IPS는 주로 인라인 모드로 설치한다. 그 이유는 실제 트래픽에 대한 탐지뿐만이 아니라 실시간 차단 목적의 장비이기 때문에 일반적으로 실제 트래픽이 장비를 통과하도록 구성하는 인라인 모드로 설치한다.

### 스노트 (snort)
* 1988년 SourceFire사의 최고기술경영자(CTO) Martin Roesch에 의해 발표된 오픈소스 침입탐지시스템으로 오늘날까지 침입탐지시스템의 대명사로 사용되고 있다. 이 시스템의 패턴 매칭 방법은 바이너리 방법과 텍스트 비교 방법이 있으며, 텍스트는 바이너리에 비해 속도가 느리지만 유연한 패턴 매칭을 제공한다.
* 스노트는 패킷 로거, 스니퍼, 네트워크 침입 탐지 모드로 동작할 수 있으며 그 중 스니퍼 모드는 단순히 네트워크에서 패킷을 읽어서 콘솔에 출력한다.
* ```alert tcp $EXTERNAL_NET any -> $HOME_NET any (msg:"TEST"; content:|FFFF|; offset:9; depth:2; sid:1000001;)``` 0xFFFF 값이 10번째 2바이트가 인지 검사

### iptabls 
* 리눅스 커널에 내장된 넷필터 기능을 관리하기 위한 툴로 rule 기반의 패킷 필터링 기능 등을 제공한다.
* 주요 기능은 다음과 같다.
  * 상태 검사 기능 제공
  * NAT(네트워크 주소 변환) 기능 제공
  * 패킷 레벨에서의 로깅 기능 제공
  * 확장 모듈을 통한 다양한 추가 기능 제공
 
### 패킷 필터링
* 방화벽의 가장 기본적인 기능으로, 설정된 규칙에 따라 패킷의 통과 여부를 결정하고 외부 침입에 대한 일차적 방어 수단으로 활용된다. OSI 모델에서 네트워크 계층과 전송 계층에서 패킷의 출발지 및 목적지 IP 주소 정보, 각 서비스의 포트 번호, TCP SYN 비트 등을 이용한 접속 제어를 한다.

### 침입 차단 시스템의 Stateful Inspection(상태 검사) 기능
* 이스라엘 보안업체 체크포인트사에서 최초로 개발한 기능으로 오늘날 대부분 방화벽에서 기본적으로 제공하는 기능이다.
* 메모리상에 상태 흐름 테이블을 생성하여 모든 송수신 패킷의 연결 상태 정보를 일정 시간 동안 유지함으로써 보다 빠르고 높은 보안성을 제공한다.
* 장점 : 효율적인 방화벽 정책 설정과 연결된 상태의 패킷인 것처럼 위조한 패킷의 접근을 차단할 수 있으므로 보안상의 장점도 있으며 연결된 상태의 패킷에 대해서는 추가적인 정책 검사를 수행하지 않으므로 성능상의 장점도 있다.
* 쉽게 설명하면 패킷을 연결하기 전에 정책을 통과하면 연결하여 연결된 패킷의 정보를 저장한다. 그래서 다음에 올 때는 이미 정책을 통과한 패킷이기 때문에 추가 정책 검사 없이 바로 연결되어 성능 상승

### 침입차단시스템(방화벽)은 구축 방식에 따라 다음과 같이 구분
#### 베스천 호스트
* 침입 차단 소프트웨어가 설치되어 내부와 외부 네트워크 사이에서 일종의 게이트웨이 역할을 하는 호스트로 네트워크 보안에 가장 중요한 방화벽 호스트이다.
* 중요한 만큼 관리자의 중점 관리가 필요하며 응용 게이트웨이 또는 회선 게이트웨이 방화벽이 설치된 안전성과 성능이 보장된 호스트를 말한다.
* 게이트웨이 역할을 하는 방화벽 중점 관리하는 호스트이다.

#### 스크리닝 라우터 방식
* 패킷 필터링 기능을 이용해 방화벽 기능을 함께 수행하는 라우터를 말한다. 일반적으로 외부 네트워크와 내부 네트워크 경계에 있는 경계 라우터로 주로 이용한다.

#### 듀얼 홈드 게이트웨이 방식
* 두 개의 네트워크 인터페이스가 설치된 베스천 호스트로 하나의 인터페이스는 외부 네트워크와 연결되고 다른 하나의 인터페이스는 내부 네트워크에 연결되어 내부와 외부 사이의 접근 제어를 수행한다.
* 스크리닝 라우터 방식과는 달리 라우팅 기능은 존재하지 않음

#### 스크린드 호스트 게이트웨이 방식
* 스크리닝 라우터와 싱글 또는 듀얼 홈드 게이트웨이를 조합하여 구성한 방식으로 외부 네트워크에서 내부 네트워크로 들어오는 트래픽은 일차로 스크리닝 라우터에서 필터링하고 이를 통과한 트래픽에 대해 이차로 싱글 또는 듀얼 홈드 게이트웨이에서 필터링하는 방식이다.

#### 스크린드 서브넷 게이트웨이 방식
* 스크리닝 라우터들 사이에 사이에 듀얼 홈드 게이트웨이를 조합하여 구성한 방식으로 외부 네트워크와 내부 네트워크 사이에 DMZ이라는 네트워크 완충지역 역할을 하는 서브넷을 운영하는 방식이다.

### NAC (Network Access Control)
* 솔루션은 단말기가 네트워크에 접속을 시도할 때 이를 제어하고 통제하는 기능을 제공하는 네트워크 보안 장비(솔루션)을 말한다. 대표적인 오픈소스 솔루션으로 PacketFence, FreeNAC 등이 있다.
* 과거 IP 관리 시스템에서 네트워크에 대한 통제 기능을 더욱 강화한 보안 솔루션
* 단말기가 내부 네트워크에 접속을 시도할 때 이를 제어하고 통제하는 기능을 제공하는 솔루션으로 네트워크 제어 및 통제 기능을 통해 내부 네트워크가 바이러스나 웜 등의 보안 위협으로부터 안전한 단말기들로 이루어질 수 있도록 강제하는 역할을 수행

### SSO (Single Sign On) 
* 한 번의 사용자 인증으로 여러 시스템에 접근할 수 있는 통합 인증 솔루션으로 단일 인증을 통해 여러 시스템에 접근함으로써 사용자 편의성이 증대한다.

### EAM (Extranet Access Management)
* 모든 사용자에 대한 통합 인증(SSO)과 사용자별/그룹별 접근권한 통제를 담당하는 권한 관리 솔루션을 말한다.

### IMA (Identity and Access Management)
* EAM을 보다 포괄적으로 확장한 보안 솔루션으로 조직이 필요로 하는 보안 정책을 수립하고 자동으로 사용자에게 계정을 만들어주며, 사용자는 자신의 직무에 따라 적절한 계정 및 권한을 부여받을 수 있을 뿐만 아니라 사용자 정보의 변경과 삭제도 실시간으로 반영할 수 있다.

### 웹방화벽
* 상용 웹 방화벽부터 공개 웹 방화벽까지 다양한 제품들이 있으며 대표적인 공개 웹 방화벽에는 KISA의 캐슬, AQTRONIX사의 WebKnight, Trustwave사의 ModSecurity 등이 있다.
#### CASTLE(캐슬)
* 한국인터넷진흥원에서 제공하는 공개 웹 방화벽

#### WebKnight(웹나이트)
* AQTRONIX사에서 개발한 마이크로소프트사의 IIS 웹서버에 동작하는 공개 웹 방화벽
* ISAPI 필터 형태로 동작하며, IIS 웹서버 앞단에 위치하여 모든 웹 요청에 대해 필터 정책에 따라 웹 공격을 탐지 및 차단해주는 기능 제공

#### ModSecurity
* Trustwave사의 SpiderLabs에 의해 개발된 Apache, IIS 등의 웹서버에서 동작하는 공개 웹방화벽
* 웹 애플리케이션 공격에 대한 탐지 및 차단 기능뿐만이 아니라 웹 애플리케이션에 대한 실시간 모니터링 및 로그 분석 기능을 제공
* 일반적으로 OWASP의 RuleSet 또는 Truswave사의 SpiderLabs 상용 RuleSet 적용이 가능

### EDR (Endpoint Detection and Response) 솔루션
* 엔드포인트(종단)에서 발생하는 악성 행위를 실시간으로 감지하고 이를 분석 및 대응하여 피해확산을 막는 솔루션을 말한다. 엔드포인트에서 동작하는 프로세스들의 모든 행위를 감지하여 악성으로 의심되는 행위를 판단하고 이를 담당자에게 보고하여 분석 및 대응하도록 함으로써 알려지지 않은 보안 위협에 대한 사전 대응과 보안 담당자에게 엔드포인트에 대한 가시성을 제공한다.
* 백신과의 차이점은 EDR은 행위기반 필터라 오탐률이 높고, 백신은 시그니처기반 필터라 미탐이 높다.

### 통합보안시스템 (UTM : Unified Threat Management)
* 방화벽, IDS/IPS, VPN, 안티바이러스, 웹/이메일 필터링 등 다양한 보안 기능을 하나의 장비로 통합적으로 제공하고 있는 보안장비
* 경제성과 보안 관리 및 운영을 편리하게 할 수 있는 장점이 있지만 장애 발생 시 모든 보안 기능에 영향을 미치는 단점이 있다.

### 트러스트 존
* 암사에서 개발한 하드웨어 기반 보안기술로 하드웨어 장치에 분리된 두 개의 환경을 제공하여 보안이 필요한 정보를 격리된 환경에서 안전하게 보호하는 기술이다.
* 일반 구역과 보안구역으로 분할하여 모니터 모드로 관리한다. 보안이 필요하지 않은 작업은 일반 구역에서 실행되고 보안이 필요한 작업은 보안 구역에서 실행되어 중요한 정보와 응용프로그램을 외부 공격에서 노출하지 않고 안전하게 보호할 수 있다.

### 디지털 저작권 관리 (DRM : Digital Right Management)
* 디지털 콘텐츠 저작권을 보호하기 위해 저작권자가 배포한 디지털 자료나 하드웨어의 사용을 제어하고 이를 의도한 용도로만 사용하도록 제한하는데 사용되는 모든 기술을 말한다.
* **식별자** : 컨텐츠 식별 식별자
* **메타데이터** : 컨텐츠 생명 주기 내에서 저작권 관리 필요한 정보(저작권자 정보, 유통 정보 등)
* **패키저** : 컨텐츠를 메타데이터와 함께 배포할 수 있도록 패키징하여 시큐어 컨테이너 포맷 구조를 만드는 프로그램
* **시큐어 컨테이너** : 배포된 컨텐츠를 안전하게 유통하기 위해 전자적 보안 장치로 유통되는 컨텐츠의 배포 단위
* **DRM 제어기** : 배포된 컨텐츠의 이용 권한을 통제하는 프로그램

### ESM (Enterprise Seucrity Management)
* 보안장비의 수가 늘어난 만큼 관리, 인력 부족 등의 어려움이 생기게 되어 각종 장비의 보안 정보를 하나의 장비로 모아서 통합 관리
* 콘솔을 통해 방화벽, IDS, IPS 등 연동한 장비의 보안 정보를 통합하여 보여주므로 상호연관분석과 대응이 수월하다.
* **ESM 에이전트** : 이벤트, 로그를 수집하여 ESM 매니저로 전달하는 기능
* **ESM 매니저** : 이벤트, 로그를 저장하고 분석 결과를 ESM 에게 전달하는 기능
* **ESM 콘솔** : 이벤트, 로그 분석 결과를 시각화, 조회, 리포팅 등의 기능과 ESM 에이전트/매니저 제어 기능

### SIEM (Security Information & Event Management)
* 점점 더 지능화되고 장기간 지속해서 이루어지는 보안(사이버) 위협에 대응하기 위해 보안장비뿐만이 아니라 서버 장비, 네트워크 장비, 엔드포인트, 애플리케이션 등 다양한 원천으로부터 보안 정보를 수집하고, 빅데이터 기반의 상관관계 분석을 통해 보안 위협을 예측해내는 보안관제 솔루션이다.
* 빅데이터 기반의 데이터 통합 및 상관관계 분석 솔루션
* **정보(로그) 수집** : 관리 대상 장비에 설치된 에이전트 또는 SNMP, syslog 방식 등을 이용하여 정보(로그) 수집
* **정보(로그) 변환** : 다양한 정보(로그) 표현형식을 표준 형식으로 변환하는 과정
* **정보(로그) 분류** : 이벤트 발생 누적 횟수 등 유사한 정보를 기준으로 그룹핑하여 단일 정보로 취합하는 과정
* **정보(로그) 분석** : 여러 개의 정보 간 연관성을 분석하는 과정

### 사이버 위협 인텔리전 (CTI: Cyber Threat Intelligence) 또는 위협 인텔리전(TI)
* 단순한 위협 정보가 아닌 지능적 위협 정보를 말한다.
* 다양한 내외부 조직에서 경험한 보안 위협 정보를 전문가 집단이 수집 및 분석하여 만들어 내는 증거 기반 위협 정보로 공격자, 공격 절차, 공격 방법, 업무 영향도, 공격 탐지 및 대응 방법 등 다양한 정보를 포함한다.
* SIEM, SOAR 등의 보안관제 솔루션에서 '사이버 위협 인텔리전스'와 연동하여 보안 위협의 분석 대응에 활용한다.

### 보안관제 모니터링
* 보안장비 모니터링 : 위협관리시스템(TMS), 침입차단시스템(Firewall), 침입탐지시스템(IDS) 등 네트워크 상황에 대한 실시간 감시 기능을 이용하여 실시간 공격 정보, 네트워크 트래픽 상황을 확인
* 서버 모니터링 : 주요 시스템에 대한 Health Check 모니터링 결과를 종합상황판에 표시하여 정기적으로 가용성을 확보
* 트래픽 모니터링 : 인터넷 주요 구간의 패킷에 대한 흐름 상태를 종합상황판에 제공하여 상태를 관리

### 보안 관제 및 대응
1. IDS 및 IPS 등 보안장비를 이용하여 실시간 트래픽 현황과 공격 탐지 로그의 추이를 파악
2. 최초 이상 징후가 발생하면 관제 담당자에게 보고하고 각각의 장비별 공격 탐지지표 현황을 비교, 분석하여 공격 탐지 여부를 결정
3. 해당 정보보호시스템 및 장비를 이용하여 공격에 대한 초동 조치 시행
4. 장비별 공격 탐지지표에 해당하는 정보를 수집하여 장비 간 상호 연관성 및 피해 내용 등을 고려하여 공격 유형을 식별하고 피해 범위를 분석
5. 해당 공격에 대하여 공격유형 및 대응 매뉴얼에 따라 차단을 적용

### 보안 솔루션 취약점 유형
1. 계정 관리
   * 보안장비 기본 계정 변경 취약점
   * 보안장비 기본 계정 패스워드 변경 취약점
   * 보안장비 계정별 권한설정 취약점
   * 보안장비 계정관리 취약점
2. 접근 관리
   * 보안장비 원격관리 접근 통제 취약점 : IP에 대한 접근 통제
   * 보안장비 보안 접속 취약점 : SSH, HTTPS 보안 접속
   * 세션 타임아웃 설정 취약점 : 세션 타임아웃 설정을 하지 않으면 자리 비운 사이에 악의적인 행위

### 국가사이버안전센터 (NCSC : National Cyber Security Center) 규정에 따른 위기 경보 발령 단계
* **정상 단계** : 전 분야 정상적인 활동 단계
* **관심 단계** : 해외 사이버공격 피해가 확산하여 국내 유입이 우려되며 웜바이러스, 해킹 등에 의한 피해 발생 가능성이 증가하고 있는 상황으로 사이버 위협 징후에 대한 탐지 활동 강화가 필요한 단계
* **주의 단계** : 침해사고가 일부 기관에서 발생했거나 다수 기관으로 확산할 가능성이 증가하고 있는 상황으로 국가 정보시스템 전반에 보안 태세 강화가 필요한 단계
* **경계 단계** : 침해사고가 다수 기관에서 발생했거나 대규모 피해로 발전될 가능성이 증가하고 있는 상황으로 다수 기관의 공조 대응이 필요한 단계
* **심각 단계** : 침해사고가 전국적으로 발생했거나 피해 규모가 대규모인 사고가 발생한 상황으로 국가적 차원에서 공동 대처가 필요한 단

### Wireshark
* DNS 프로토콜의 flag 비트를 필터링하기 위한 주요 필터 구문은 다음과 같다.
  * dns.flags.response==1 <- 0 이면 query, 1이번 response
  * dns.flags.authoritative==1 <- 0 이면 recursive 네임 서버 캐시 저장된 응답, 1이면 authoritative 네임 서버로부터의 응답
  * dns.flags.recdesired==1 <- 0 이면 반복 질의/응답, 1이면 재귀 질의/응답
  * 

### 퍼징 (Fuzzing)
* 소프트웨어 보안 테스트 기법으로 프로그램 실행 시 무작위 데이터를 입력하여 그 결과로 애플리케이션에 오류 등이 발생하면 보안 취약점이 존재할 가능성이 크다고 판단하는 테스트이다. 테스트 분야에 따라 웹 퍼징, 네트워크 프로토콜 퍼징, 파일 포맷 퍼징, 메모리 퍼징 등으로 구분한다.
* 애플리케이션의 보안취약점을 찾아내기 위한 도구로 목표 애플리케이션에 대한 다양한 데이터를 입력함으로써 소프트웨어 오류를 유발해 보안취약점을 찾아내는 목적으로 사용한다.

### 트립와이어 (Tripwire) 
* 파일시스템의 무결성을 점검한느 대표적인 도구로 오픈소스 도구

### 네너스 (Nessus)
* 미국 테너블사가 개발 배포하는 취약점 점검 도구(스캐너)로 로컬 또는 원격지에서 다양한 방법을 통해 시스템, 네트워크, 웹 애플리케이션 등의 알려진 취약점에 대한 점검을 수행하며 점검을 통해 취약점의 내용과 해결 방법을 상세하게 제공한다.

### 닉토 (Nikto)
* 웹서버 또는 웹 애플리케이션 취약점을 점검할 수 있는 공개 점검 도구(스캐너)로 방대한 취약점 데이터베이스를 이용하여 다양한 형태의 취약점을 스캔할 수 있다.

### proc 파일 시스템
* 유닉스/리눅스 커널이 사용중인 프로세스 자원, 커널 파라미터 등에 대한 상태정보를 파일 형식으로 보관하고 있으며 일반 파일시스템과 달리 디스크 영역이 아닌 메모리 영역에 존재하는 가상 파일시스템으로 부팅 시마다 새롭게 생성된다.

### chattr 
* 리눅스 파일시스템에서 파일 속성을 설정하는 명령어
* chattr +-=[속성] [파일 or 디렉터리], 속성 추가 +, 속성 삭제 -, 속성 설정 =
* chattr +i [파일명] : 읽기 전용 삭제 불가
* chattr +a [파일명] : 추가 전용 삭제 불가
* chattr +A [파일명] : 접근 시간 변경 안함

### strace
* 유닉스/리눅스 시스템에서 특정 프로그램의 시스템 콜, 시그널을 추적하는데 사용하는 디버깅 도구이다.
* -e trace=open ps <- ps 프로그램에 대해 open 시스템 콜을 추적해 출력하도록 하고 있다.

### 악성코드 분석 - 역공학
#### 1) 개요
* 정적 분석, 동적 분석 등 실행파일로부터 원시 코드를 추정하는 각종 기법을 리버싱 엔지니어링이라 한다.
* 악성코드 분석은 S/W 및 H/W에 대해 폭넓고 깊은 이해와 경험이 필요하다.

#### 2) 레지스터
* 레지스터는 처리 중인 데이터나 처리 결과를 임시 보관하는 CPU 내 고속의 기억장치를 말한다.
* 주요 레지스터
  * EAX : 산술 연산 시 변수값 저장, 함수의 반환값 저장 등
  * EBP : 스택 프레임의 시작 주소
  * ESP : 스택 프레임의 최상단 주소, PUSH,POP 명령에 따라 주소가변함
  * EIP : 다음에 실행할 명령어의주소

#### 3) 어셈블리어 명령 형식
* 어셈블리어 명령 형식은 피연산자가 없거나 여러 개의 피연산자로 이루어져 있다.
* 피연산자가 없는 경우 예
  * RET : CALL 명령을 통해 호출된 함수에서 수행을 마치고 원래 호출한 함수로 복귀하기 위해 사용하는 명령으로 ESP 레지스터가 가리키는 값을 EIP에 저장한다.
* 피연산자가 1개인 경우 예
  * PUSH EBP : 스택 포인터를 감소시킨 후 EBP 레지스터의 값을 스택 포인터가 가리키는 스택 영역에 저장한다.
  * POP EBP : 스택 포인터가 가리키는 값을 EBP 레지스터에 저장한 후 스택 포인터를 증가시킨다.
* 피연산자가 2개인 경우 예
  * MOV EBP, ESP : ESP 레지스터 값을 EBP 레지스터에 저장한다.
  * ADD EAX, ECX : EAX 레지스터값과 ECX 레지스터값을 더해서 EAX 레지스터에 저장한다.

### Windows PE(Portable Executable)
* 구조는 PE_HEADER, Section_HEADER, Section으로 이루어진다.
* **.text** : 프로그램 실행 코드를 담고 있는 섹션
* **.data** : 읽기 쓰기가 가능한 데이터 섹션으로 전역변수와 정적변수 등이 위치
* **.rdata** : 읽기 전용 데이터 섹션으로 상수형, 문자열 상수 등이 위치
* **.bss** : 초기화되지 않은 전역변수가 위치
* **.idata** : 임포트할 DLL, API 정보 있는 위치
* **.edata** : 익스포트할 DLL, API 정보 있는 위치
* **.rsrc** : 다이얼로그, 아이콘, 커서 등의 윈도우 애플리케이션 리소스 관련 데이터를 담고 있는 섹션

### 윈도우 레지스트리 최상위 루트키
* **HKCR (HKEY_CLASSES_ROOT)** : 파일 확장명과 응용 프로그램의 연결 정보가 들어있고, 윈도우 시스템에 들어있는 개체들 및 응용 프로그램과 그 자동화에 대한 정보도 들어 있다.
* **HKCU (HKEY_Current_User)** : 현재 로그인 중인 사용자의 환경설정 정보를 가지고 있다.
* **HKLM (HKEY_Local_Machine)** : 시스템 전체에 적용되는 하드웨어와 응용프로그램 설정 데이터 저장
* **HKU (HKEY_USERS)** : 사용자별 존재하는 하이브 파일인 ntuser.data 파일을 로드하여 생성
* **HKCC (HKEY_Current_Config)** : 현재 사용 중인 윈도우의 하드웨어 프로필 정보

### DBD (Drive By Download) 
* 사용자가 홈페이지에 접속만 해도 자신의 의도와 무관하게 악성코드가 다운로드되어 설치되는 공격이다.

### 난독화 (Obfuscation)
* 프로그램 코드를 읽기 어렵게 만드는 기술로 사용자는 소스코드를 읽기 어렵지만, 컴퓨터는 읽고 실행할 수 있는 특징이 있다. 소스코드 난독화는 원래 개발자들이 개발한 소스코드의 기능이나 알고리즘을 다른 개발자로부터 보호하기 위한 목적으로 만들어진 기법이지만 공격자들이 악성코드를 숨기기 위한 악의적인 목적으로 자주 사용하고 있다.

### 랜섬웨어 (Ransomware)
#### (1) 개요
* 랜섬웨어는 이용자의 데이터를 암호화하고 복구를 위한 금전을 요구하는 악성코드를 말한다. 다른 악성코드와 달리 감염된 시스템을 암호화 시키는 특성을 가짐
* 몸값과 소프트웨어의 합성어로 시스템을 사용 불가능한 상태로 변경하거나 데이터를 암호화해 사용할 수 없도록 하고 이를 인질로 금전을 요구하는 특징이 있다. 추적이 어려운 가상화폐로 금전을 요구하는 경우가 대부분이며 지정한 기간 내 요구사항을 받아들이지 않으면 감염 시스템과 암호화된 데이터는 사용할 수 없거나 삭제될 수 있음
* 1989년 최초의 랜섬웨어 AIDS를 시작으로 유행하기 시작했으며 국내의 경우 2015년 크립토락커 한글 버전이 유포되면서 본격적으로 사회문제가 되었다.

#### (2) 랜섬웨어 피해 예방 수칙
* 모든 소프트웨어는 최신 버전으로 업데이트하여 사용한다.
* 백신 소프트웨어를 설치하고 최신 버전으로 업데이트한다.
* 출처가 불명확한 이메일과 URL 링크는 실행하지 않는다.
  * 이메일에 첨부된 MS오피스(doc, xls 등) 파일의 매크로 기능을 허용하지 않음
  * 이메일에 첨부된 스크립트(js, java 등)나 실행파일(exe, scr, vbs)은 실행하지 않음
* 파일 공유 사이트 등에서 파일 다운로드 및 실행에 주의한다.
* 중요 자료는 정기적으로 백업한다.
  * 중요 파일은 PC 외에 외부 저장장치 등을 이용한 2차 백업하거나 보안 백업 SW 등을 통해 쉽게 접근하기 어렵게 설정한다.
